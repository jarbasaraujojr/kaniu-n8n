{
  "nodes": [
    {
      "parameters": {
        "path": "kaniu-viralatinhaz",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2080,
        -208
      ],
      "id": "7344c266-b811-4743-ba49-18bbf34dcdd5",
      "name": "Viralatinhaz",
      "webhookId": "e6ce9671-e9ee-4390-8653-aec05cc30280"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7a4588b-5dc6-4323-a644-d991280bfa27",
              "name": "url",
              "value": "={{ $json.webhookUrl }}",
              "type": "string"
            },
            {
              "id": "052935fa-e0ea-4f3c-bdde-0ec176e58084",
              "name": "host",
              "value": "={{ $json.headers.host }}",
              "type": "string"
            },
            {
              "id": "2b7c7efc-8a80-484d-bd18-d32dd4838a71",
              "name": "query",
              "value": "={{ $json.query }}",
              "type": "object"
            },
            {
              "id": "009f4d06-3e12-4220-a183-265223f206a9",
              "name": "canil_id",
              "value": "={{ $('Viralatinhaz').isExecuted ? 1 : $('ProjetoMeg').isExecuted ? 23 : $('Canil14').isExecuted ? 14 : 0 }}",
              "type": "string"
            },
            {
              "id": "1761e4df-4d37-47ad-b55c-8f435767fce4",
              "name": "animal_id",
              "value": "={{ $json.query.animal_id }}",
              "type": "string"
            },
            {
              "id": "815f5903-96dd-4c48-ba02-9dcf38b7096d",
              "name": "status",
              "value": "={{ $json.query.status || 'Abrigado'}}",
              "type": "string"
            },
            {
              "id": "88df0e20-1c99-42cf-97bb-98283ada0e03",
              "name": "pagina",
              "value": "={{ $json.query?.pagina || \n  ( $json.query?.animal_id ? 'animal' : $json.query?.status ? 'animais' : 'painel' )\n}}",
              "type": "string"
            },
            {
              "id": "07a599af-2608-4746-84e5-731be01ce302",
              "name": "menu",
              "value": "={{ \n  $json.query?.pagina ||\n  ( \n    ($json.query?.animal_id || $json.query?.status) ? \n      'animais' : \n      'painel'\n  ) \n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        -208
      ],
      "id": "5c033c22-f0da-41f6-be98-e254a2b79c08",
      "name": "Vars"
    },
    {
      "parameters": {
        "path": "kaniu-projetomeg",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2080,
        -16
      ],
      "id": "8b252c1d-9eb9-43c4-bbce-c344e0df319d",
      "name": "ProjetoMeg",
      "webhookId": "ee2d79dc-2b49-4283-937a-5d9b5a482aba"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "_n8n_animais_dados",
        "filters": {
          "conditions": [
            {
              "keyName": "animal_id",
              "keyValue": "={{ $('Vars').item.json.query.animal_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        208,
        -256
      ],
      "id": "82c2cc27-249e-4239-a239-603c9ded8785",
      "name": "Get Details",
      "notesInFlow": true,
      "credentials": {
        "supabaseApi": {
          "id": "vfFMnH1cZndqgot0",
          "name": "Viralatinhaz Supabase"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1488,
        -256
      ],
      "id": "6934d837-ed64-4527-a0b1-1550a971ce49",
      "name": "Respond"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "nome"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        624,
        -400
      ],
      "id": "8ba9a00d-5be5-4769-8ca8-b5abd70d28cc",
      "name": "Sort",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fbd341f6-d387-4a05-b02c-be40b9e12524",
              "leftValue": "={{ $json }}",
              "rightValue": 0,
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        -512
      ],
      "id": "a3821584-7985-42e3-9788-96984c5cddf9",
      "name": "Empty"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "animals",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        864,
        -400
      ],
      "id": "7e5b4343-6509-4632-9e78-157a09b9041a",
      "name": "Combine"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fadb7979-539b-42f0-882d-dec4507354b3",
              "name": "status",
              "value": "={{ \n  [ \n    'Abrigado', \n    'Adotado', \n    'Internado', \n    'Desaparecido', \n    'Falecido'\n  ] \n}}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -208,
        -512
      ],
      "id": "d2830598-36f4-415c-b3d9-7f70a0e56e7e",
      "name": "Animal Statuses"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "  {\n    \"vacina\": \"syringe\",\n    \"acidente\": \"heart-crack\",\n    \"observacao\": \"comment-dots\",\n    \"animal\": \"paw\",\n    \"casa\": \"house\",\n    \"usuario\": \"user\",\n    \"canil\": \"shield-dog\",\n    \"info\": \"circle-info\",\n    \"adotado\" : \"house-heart\",\n    \"internado\": \"hospital\",\n    \"desaparecido\": \"map-location-dot\",\n    \"falecido\": \"tombstone\",\n    \"todos\": \"globe\",\n    \"animais\": \"paw\",\n    \"canil\": \"house\",\n    \"animais\": \"paw\",\n    \"lixeira\": \"trash\",\n    \"realizado\": \"square-check\",\n    \"concluido\": \"calendar-check\",\n    \"agendado\": \"alarm-clock\",\n    \"agenda\": \"calendar-days\"\n  }",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1344,
        -208
      ],
      "id": "cefaf26f-a4b6-4580-bb37-63616df7b173",
      "name": "Icons"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "25a0b953-d8c5-4d02-b97c-609d88eb0022",
              "name": "img_logo",
              "value": "https://viralatinhaz.uzd6db.easypanel.host/assets/kaniu-logo-blue.png",
              "type": "string"
            },
            {
              "id": "6ddb1ed1-4e1c-469e-ace0-014a2d906a49",
              "name": "fav_icon",
              "value": "https://viralatinhaz.uzd6db.easypanel.host/assets/kaniu-fav-icon-blue.png",
              "type": "string"
            },
            {
              "id": "0f28499b-2cb0-4a7d-a827-0435c5e410f1",
              "name": "dog_font",
              "value": "https://viralatinhaz.uzd6db.easypanel.host/assets/fonts/GoodDog.ttf",
              "type": "string"
            },
            {
              "id": "30b05b97-95a1-4c9e-9cfc-252a58a0f9bf",
              "name": "filter_satus",
              "value": "={{ $json.query.status }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1568,
        -208
      ],
      "id": "6034029e-f40e-41fa-a57b-e6222d483a97",
      "name": "Constants",
      "notesInFlow": true
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu\n/* Sistema de gestão de abrigos de animais\n/* Página do animal\n/**********************************************/\n\n// Variáveis de trabalho\nconst animal = $('Get Details').first().json;\nconst especies = JSON.stringify($('Get Tables').first().json.especies);\nconst racas = JSON.stringify($('Get Tables').first().json.racas);\nconst generos = JSON.stringify($('Get Tables').first().json.generos);\nconst portes = JSON.stringify($('Get Tables').first().json.portes);\nconst cores = JSON.stringify($('Get Tables').first().json.cores);\nconst pelagens = JSON.stringify($('Get Tables').first().json.pelagens);\nconst imunizantes = JSON.stringify($('Get Tables').first().json.imunizantes);\nconst imunizacao_tipo = JSON.stringify($('Get Tables').first().json.imunizacao_tipo);\nconst icones = $('Icons').first().json;\nconst canil_id = $('Vars').first().json.canil_id;\nconst sidebar_html = $('Sidebar Html').first().json.html;\nconst sidebar_script = $('Sidebar Script').first().json.script;\n\nconst app_url = $('Vars').first().json.url.split('webhook/')[1];\nconst img_logo = $('Constants').item.json.img_logo;\n\n// Código para obter o arquivo de estilo\nconst estilo = $('Details Style').first().json;\n\n// Função para converter boolean para \"Sim\" ou \"Não\"\nconst formatBoolean = (value) => value ? 'Sim' : 'Não';\n\n// Função para checar por valores nulos ou 0\nconst formatValue = (value) => value === null || value === 0 || value === undefined ? '' : value;\n\n// Função para calcular idade completa em anos, meses e dias\nconst calculateAge = (birthDate) => {\n    const today = new Date();\n    const dob = new Date(birthDate);\n\n    let years = today.getFullYear() - dob.getFullYear();\n    let months = today.getMonth() - dob.getMonth();\n    let days = today.getDate() - dob.getDate();\n\n    if (days < 0) {\n        months--;\n        const prevMonth = new Date(today.getFullYear(), today.getMonth(), 0);\n        days = today.getDate() + (prevMonth.getDate() - dob.getDate());\n    }\n\n    if (months < 0) {\n        years--;\n        months = 12 + months;\n    }\n\n    let txt_anos = years == 0 ? '' : years == 1 ? '1 ano' : years + ' anos';\n    let txt_meses = months == 0 ? '' : months == 1 ? '1 mês' : months + ' meses';\n    let txt_e = (txt_anos == '' || txt_meses == '') ? '' : ' e ';\n\n    return txt_anos+txt_e+txt_meses;\n};\n\n// Calcula a idade do animal\nconst ageString = calculateAge(animal.nascimento);\n\n// Função para retornar um ícone\nfunction getIcon(icon_name) {\n    const iconValue = icones[icon_name];\n\n    if (!iconValue) {\n        return '<i class=\"fa-solid fa-notdef\"></i>'; // error icon\n    }\n\n    return '<i class=\"fa-solid fa-' + iconValue + '\"></i>';\n}\n\n// Função para construir a url completa usando o host de trabalho\nfunction makeURL(endpoint) {\n  const url = $('Vars').first().json.host;\n  return url+endpoint;\n}\n\n// Função para gerar o HTML dos ícones com base nas propriedades do animal\nfunction animalStatusIcons(animal) {\n    let iconsHtml = '';\n\n    // Verifica se o animal está castrado e adiciona o ícone se for verdade\n    if (animal.castrado) {\n        iconsHtml += '<div class=\"img-button-wrapper\"><i class=\"fa-solid fa-scissors\"></i><span class=\"tooltip\">Castrado</span></div>';\n    }\n\n    // Verifica se o animal está vacinado\n    if (animal.vacinado) {\n        iconsHtml += '<div class=\"img-button-wrapper\"><i class=\"fa-solid fa-syringe\"></i><span class=\"tooltip\">Vacinado</span></div>';\n    }\n\n    // Verifica se o animal está vermifugado\n    if (animal.vermifugado) {\n        iconsHtml += '<div class=\"img-button-wrapper\"><i class=\"fa-solid fa-pills\"></i><span class=\"tooltip\">Vermifugado</span></div>';\n    }\n\n    // Verifica se o animal está desparasitado\n    if (animal.desparasitado) {\n        iconsHtml += '<div class=\"img-button-wrapper\"><i class=\"fa-solid fa-bug-slash\"></i><span class=\"tooltip\">Desparasitado</span></div>';\n    }\n\n    return iconsHtml;\n}\n\nfunction animalPhoto(especie = \"Vazio\") {\n  const pic_url = {\n    \"Cachorro\": \"https://i.ibb.co/Z6dPncCH/pic-dog.png\",\n    \"Gato\": \"https://i.ibb.co/9dWLkZs/pic-cat.png\",\n    \"Vazio\": \"https://i.ibb.co/KpVTx4vK/pic-none.png\"\n  };\n\n  // Retorna a imagem correspondente ou a de \"Vazio\" como fallback\n  return pic_url[especie] || pic_url[\"Vazio\"];\n}\n\n// Gera o html dos ícones indicando o status do animall\nconst iconesAnimal = animalStatusIcons(animal);\nconst isAnimalDisponivel = (() => {\n    if (typeof animal.disponivel === 'boolean') {\n        return animal.disponivel;\n    }\n    if (typeof animal.abrigado === 'boolean') {\n        return !animal.abrigado;\n    }\n    if (typeof animal.status === 'string') {\n        return animal.status.toLowerCase() !== 'abrigado';\n    }\n    return true;\n})();\nconst initialStatusMap = {\n    adotado: !!animal.adotado,\n    desaparecido: !!animal.desaparecido,\n    internado: !!animal.internado,\n    falecido: !!animal.falecido,\n    indisponivel: !isAnimalDisponivel\n};\n\n// =========================================================================\n// O Código DO N8N TERMINA AQUI. A PARTIR DAQUI VEM O HTML E O JAVASCRIPT\n// QUE SERÃO EXECUTADOS NO NAVEGADOR.\n// =========================================================================\n\n// Gera o html principal da página\nconst html = `\n<!DOCTYPE html>\n<html lang=\"pt-br\">\n\n${estilo.style}\n\n<!------------------------------------- Carregar script de gráficos locais ------------------------------------->\n<script src=\"https://viralatinhaz.uzd6db.easypanel.host/assets/js/chart.js\"></script>\n<script src=\"https://viralatinhaz.uzd6db.easypanel.host/assets/js/chartjs-adapter-date-fns\"></script>\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Kaniu :: ${animal.nome}</title>\n    \n    <!------------------------------------- Carregar fontes locais ------------------------------------->\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/fontawesome.css\" rel=\"stylesheet\" />\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/solid.css\" rel=\"stylesheet\" />\n</head>\n\n<body>\n  <div class=\"app-shell\">\n  \n    <!------------------------------------- Carregar sidebar  ------------------------------------->\n    ${sidebar_html}\n\n    <!------------------------------------- Conteúdo principal da página ------------------------------------->\n    <div class=\"main-with-sidebar\">\n        <main>\n            <div class=\"content-grid\">\n        <header class=\"app-header\">\n          <div class=\"header-content\">\n            <div class=\"animal-header\">\n              <div class=\"animal-photo-wrapper\">\n                <input type=\"file\" id=\"animal-photo-upload-input\" class=\"animal-photo-input\" accept=\"image/*\" style=\"display: none;\" />\n                <img class=\"animal-photo\" id=\"animal-photo\"\n                     src=\"${animal.foto || animalPhoto(animal.especie)}\"\n                     alt=\"Foto de ${animal.nome}\" title=\"Clique para alterar a foto\" />\n              </div>\n        \n              <div class=\"animal-title\">\n                <h1>${animal.nome || ''}</h1>\n                <div class=\"animal-subline\">\n                  <button class=\"chip is-action\" id=\"open-especie-menu\">${animal.especie || 'Definir espécie'}</button>\n                  <button class=\"chip is-action\" id=\"open-genero-menu\">${animal.sexo || 'Definir gênero'}</button>\n                  <button class=\"chip is-action\" id=\"open-porte-menu\">${animal.porte || 'Definir porte'}</button>\n                  <button class=\"chip is-action\" id=\"open-raca-menu\">${animal['raça'] || 'Definir raça'}</button>\n                  <button class=\"chip is-action\" id=\"open-pelagem-menu\">Pelo ${animal.pelagem || 'Definir pelagem'}</button>\n                  <button class=\"chip is-action\" id=\"open-cor-menu\">${animal.cor || 'Definir cor'}</button>\n                  <button class=\"chip is-action\" id=\"open-nascimento-menu\">\n                    ${animal.nascimento ? animal.nascimento : 'Definir nascimento'}\n                  </button>\n                  ${ageString ? `<button class=\"chip\">${ageString}</button>` : ''}\n                  ${animal.faixa_etaria ? `<button class=\"chip\">${animal.faixa_etaria}</button>` : ''}\n                  ${formatValue(animal.peso) ? `<button class=\"chip\">${formatValue(animal.peso)} kg</button>` : ''}\n                </div>\n              </div>\n            </div>\n        \n            <!-- Botão de listar animais -->\n            <button class=\"quick-action\" id=\"open-animals-popup\" title=\"Listar animais\" aria-label=\"Listar animais\">\n              <i class=\"fa-solid fa-bars\"></i>\n            </button>\n          </div>\n        </header>\n                <div class=\"tab-nav\">\n                    <button class=\"tab-btn active\" data-tab=\"resumo\">\n                        <i class=\"fa-solid fa-chart-pie\"></i>\n                        Painel\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"eventos\">\n                        <i class=\"fa-solid fa-clock-rotate-left\"></i>\n                        Histórico\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"avaliacoes\">\n                        <i class=\"fa-solid fa-stethoscope\"></i>\n                        Avaliação\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"pesagens\">\n                        <i class=\"fa-solid fa-weight-scale\"></i>\n                        Pesagem\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"imunizacoes\">\n                        <i class=\"fa-solid fa-syringe\"></i>\n                        Imunização\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"tratamentos\">\n                        <i class=\"fa-solid fa-prescription-bottle-medical\"></i>\n                        Tratamento\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"arquivos\">\n                        <i class=\"fa-solid fa-paperclip\"></i>\n                        Arquivos\n                    </button>\n                </div>\n\n                <div class=\"card tab-container\">\n                    <div class=\"tab-content-area\">\n                        <div id=\"tab-resumo\" class=\"tab-content\">\n                    <div class=\"resume-sections\">\n                        <div class=\"resume-section resume-actions\">\n                            <h3 class=\"resume-title\">Ações</h3>\n                            <div class=\"resume-card\">\n                                <div class=\"resume-action-item\">\n                                    <div\n                                        class=\"resume-action-icon\"\n                                        data-caracteristica=\"adotado\"\n                                        data-tooltip-inactive=\"Marcar como adotado\"\n                                        data-tooltip-active=\"Marcar como não adotado\"\n                                        role=\"button\"\n                                        tabindex=\"0\">\n                                        <i class=\"fa-solid fa-home\"></i>\n                                        <span class=\"resume-action-tooltip\">Marcar como adotado</span>\n                                    </div>\n                                    <div\n                                        class=\"resume-action-icon\"\n                                        data-caracteristica=\"desaparecido\"\n                                        data-tooltip-inactive=\"Marcar como desaparecido\"\n                                        data-tooltip-active=\"Marcar como não desaparecido\"\n                                        role=\"button\"\n                                        tabindex=\"0\">\n                                        <i class=\"fa-solid fa-magnifying-glass-location\"></i>\n                                        <span class=\"resume-action-tooltip\">Marcar como desaparecido</span>\n                                    </div>\n                                    <div\n                                        class=\"resume-action-icon\"\n                                        data-caracteristica=\"internado\"\n                                        data-tooltip-inactive=\"Marcar como internado\"\n                                        data-tooltip-active=\"Marcar como não internado\"\n                                        role=\"button\"\n                                        tabindex=\"0\">\n                                        <i class=\"fa-solid fa-hospital\"></i>\n                                        <span class=\"resume-action-tooltip\">Marcar como internado</span>\n                                    </div>\n                                    <div\n                                        class=\"resume-action-icon\"\n                                        data-caracteristica=\"falecido\"\n                                        data-tooltip-inactive=\"Marcar como falecido\"\n                                        data-tooltip-active=\"Marcar como não falecido\"\n                                        role=\"button\"\n                                        tabindex=\"0\">\n                                        <i class=\"fa-solid fa-cross\"></i>\n                                        <span class=\"resume-action-tooltip\">Marcar como falecido</span>\n                                    </div>\n                                    <div\n                                        class=\"resume-action-icon\"\n                                        data-caracteristica=\"indisponivel\"\n                                        data-target=\"disponivel\"\n                                        data-invert=\"true\"\n                                        data-label=\"Indisponível\"\n                                        data-tooltip-inactive=\"Marcar como indisponível\"\n                                        data-tooltip-active=\"Marcar como disponível\"\n                                        role=\"button\"\n                                        tabindex=\"0\">\n                                        <i class=\"fa-solid fa-ban\"></i>\n                                        <span class=\"resume-action-tooltip\">Marcar como indisponível</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div id=\"resume-empty-message\" class=\"resume-empty-message\">\n                            Nenhum dado de resumo disponível.\n                        </div>\n\n                        <div class=\"resume-section\">\n                            <h3 class=\"resume-title\">Saúde Geral</h3>\n                            <div class=\"resume-card\">\n                                <div id=\"saude-geral-list\" class=\"resume-list\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"resume-section\">\n                            <h3 class=\"resume-title\">Vacinação</h3>\n                            <div class=\"resume-card\">\n                                <div id=\"vacinacao-list\" class=\"resume-list\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"resume-section\">\n                            <h3 class=\"resume-title\">Controle de Parasitas</h3>\n                            <div class=\"resume-card\">\n                                <div id=\"parasitas-list\" class=\"resume-list\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"resume-section\">\n                            <h3 class=\"resume-title\">Avaliação e Peso</h3>\n                            <div class=\"resume-card\">\n                                <div id=\"peso-list\" class=\"resume-list\">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                        <div id=\"tab-eventos\" class=\"tab-content\"></div>\n                        <div id=\"tab-avaliacoes\" class=\"tab-content\"></div>\n                        <div id=\"tab-pesagens\" class=\"tab-content\"></div>\n                        <div id=\"tab-imunizacoes\" class=\"tab-content\"></div>\n                        <div id=\"tab-tratamentos\" class=\"tab-content\"></div>\n                        <div id=\"tab-arquivos\" class=\"tab-content\"></div>\n                    </div>\n                </div>\n            </div>\n        </main>\n    </div>\n\n    <!------------------------------------------ SEÇÃO DE POPUPS ---------------------------------------------->\n\n    <div id=\"overlay\" class=\"overlay\"></div>\n    <div id=\"pop-up-animais\" class=\"pop-up-menu pop-up-animais\">\n        <span class=\"pop-up-close\" onclick=\"closeAnimaisPopup()\">&times;</span>\n        <h2>Lista de Animais</h2>\n        <div class=\"animals-filters\" id=\"animals-filters\"></div>\n        <div id=\"animals-list-container\" class=\"animals-list-container\">\n            <p class=\"animals-list-placeholder\">Selecione um filtro para visualizar os animais.</p>\n        </div>\n    </div>\n    <div id=\"pop-up-menu\" class=\"pop-up-menu\">\n        <span class=\"pop-up-close\" onclick=\"closeMenu()\">&times;</span>\n        <h2>Selecione a Espécie</h2>\n        <div id=\"pop-up-options-container\" class=\"pop-up-options-container\">\n        </div>\n    </div>\n\n    <div id=\"pop-up-nascimento\" class=\"pop-up-menu\" style=\"width: 280px; padding: 15px;\">\n        <span class=\"pop-up-close\"\n            onclick=\"document.getElementById('pop-up-nascimento').style.display='none'; document.getElementById('overlay').style.display='none';\">&times;</span>\n        <h2 id=\"nascimento-popup-title\">Alterar Data de Nascimento</h2>\n        <div class=\"pop-up-options-container\" style=\"align-items: center; width: 100%; box-sizing: border-box;\">\n            <input type=\"date\" id=\"nascimento-input\" class=\"date-input\" style=\"width: 100%;\" />\n        </div>\n        <div class=\"pop-up-actions\" style=\"margin-top: 5px;\">\n            <button id=\"confirm-nascimento\" class=\"detail-button\"\n                style=\"background-color: var(--primary-color); color: var(--card-background); flex: 1; max-width: 100px;\">Salvar</button>\n            <button id=\"cancel-nascimento\" class=\"detail-button\" style=\"flex: 1; max-width: 100px;\">Cancelar</button>\n        </div>\n    </div>\n\n    <div id=\"alert-popup\" class=\"alert-popup\">\n        <span id=\"alert-message\"></span>\n    </div>\n\n    <div id=\"pop-up-pesagem\" class=\"pop-up-menu\" style=\"width: 280px; padding: 40px;\">\n        <span class=\"pop-up-close\" onclick=\"closePesagemPopup()\">&times;</span>\n        <h2>Pesagem</h2>\n        <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 5px;\">\n            <input type=\"hidden\" id=\"pesagem-id\" />\n\n            <label style=\"font-size: 0.8rem; color: var(--text-dark);\">Data da Medição</label>\n            <input type=\"date\" id=\"pesagem-data-input\" class=\"date-input\" />\n\n            <label style=\"font-size: 0.8rem; color: var(--text-dark);\">Peso (kg)</label>\n            <input type=\"number\" step=\"0.1\" id=\"pesagem-peso-input\" class=\"date-input\" placeholder=\"Ex: 5.2\" />\n        </div>\n        <div class=\"pop-up-actions\" style=\"margin-top: 5px;\">\n            <button id=\"cancel-pesagem\" class=\"cancel-button\" style=\"flex: 1; max-width: 100px;\">Cancelar</button>\n            <button id=\"confirm-pesagem\" class=\"confirm-button\" flex: 1; max-width: 100px;\">Salvar</button>\n        </div>\n    </div>\n\n    <div id=\"delete-confirmation-popup\" class=\"pop-up-menu\" style=\"width: 280px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"cancelDelete()\">&times;</span>\n        <h2 style=\"margin-bottom: 10px;\">Confirmar exclusão</h2>\n        <p style=\"font-size: 0.9rem; text-align: center; margin-bottom: 15px;\">\n            Tem certeza que deseja excluir este registro? Esta ação NÃO poderá ser desfeita.\n        </p>\n        <div class=\"pop-up-actions\" style=\"margin-top: 10px; display: flex; gap: 10px;\">\n            <button class=\"cancel-button\" style=\"flex: 1;\" onclick=\"cancelDelete()\">Cancelar</button>\n            <button class=\"delete-button\" style=\"flex: 1;\" onclick=\"executeDelete()\">Excluir</button>\n        </div>\n    </div>\n\n    <div id=\"pop-up-imunizacao\" class=\"pop-up-menu\" style=\"width: 480px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"closeImunizacaoPopup()\">&times;</span>\n        <h2>Imunização</h2>\n\n        <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 12px;\">\n            <input type=\"hidden\" id=\"imunizacao-id\" />\n\n            <div style=\"display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px;\">\n                <div>\n                    <label>Data Programada</label>\n                    <input type=\"date\" id=\"imunizacao-data-prevista\" class=\"date-input\" />\n                </div>\n                <div>\n                    <label>Data Aplicada</label>\n                    <input type=\"date\" id=\"imunizacao-data-realizada\" class=\"date-input\" />\n                </div>\n            </div>\n\n            <div>\n                <label>Tipo de Imunização</label>\n                <select id=\"imunizacao-tipo-select\" class=\"date-input\"></select>\n            </div>\n\n            <div>\n                <label>Imunizante</label>\n                <select id=\"imunizacao-imunizante-select\" class=\"date-input\"></select>\n            </div>\n\n            <div>\n                <label>Veterinário Responsável</label>\n                <select id=\"imunizacao-vet-select\" class=\"date-input\"></select>\n            </div>\n\n            <div>\n                <label>Descrição</label>\n                <textarea id=\"imunizacao-descricao-input\" class=\"date-input\" rows=\"2\" placeholder=\"Resumo da imunização\"></textarea>\n            </div>\n\n            <div>\n                <label>Observações</label>\n                <textarea id=\"imunizacao-observacao-input\" class=\"date-input\" rows=\"3\" placeholder=\"Informações adicionais\"></textarea>\n            </div>\n\n            <div style=\"display: flex; align-items: center; gap: 8px; margin-top: 4px;\">\n                <input type=\"checkbox\" id=\"imunizacao-aplicada-checkbox\" />\n                <label for=\"imunizacao-aplicada-checkbox\" style=\"margin: 0; font-size: 0.85rem;\">Marcar como aplicada</label>\n            </div>\n        </div>\n\n        <div class=\"pop-up-actions\" style=\"margin-top: 10px;\">\n            <button id=\"cancel-imunizacao\" class=\"cancel-button\" style=\"flex: 1; max-width: 100px;\">Cancelar</button>\n            <button id=\"confirm-imunizacao\" class=\"confirm-button\" style=\"flex: 1; max-width: 100px;\">Salvar</button>\n        </div>\n    </div>\n\n    <!-- POP-UP NOVO TRATAMENTO -->\n    <div id=\"pop-up-tratamento\" class=\"pop-up-menu\" style=\"width: 460px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"closeTratamentoPopup()\">&times;</span>\n        <h2>Tratamento</h2>\n\n        <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 12px;\">\n            <input type=\"hidden\" id=\"tratamento-id\" />\n\n            <!-- Linha 1: Veterinário -->\n            <div>\n                <label>Veterinário</label>\n                <select id=\"tratamento-vet-select\" class=\"date-input\" style=\"width: 100%;\"></select>\n            </div>\n\n            <!-- Linha 2: Medicamento e Via -->\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px;\">\n                <div>\n                    <label>Medicamento</label>\n                    <select id=\"tratamento-med-select\" class=\"date-input\"></select>\n                </div>\n                <div>\n                    <label>Via</label>\n                    <select id=\"tratamento-via-select\" class=\"date-input\"></select>\n                </div>\n            </div>\n\n            <!-- Linha 3: Fração, Dosagem e Dose -->\n            <div style=\"display: grid; grid-template-columns: auto 1fr 1fr; gap: 8px; align-items: center;\">\n                <div>\n                    <label>Dosagem</label>\n                    <select id=\"tratamento-dosagem-select\" class=\"date-input\"></select>\n                </div>\n                <div>\n                    <label>Quantidade</label>\n                    <div id=\"tratamento-dose-wrapper\"></div>\n                </div>\n                <div>\n                    <label>&nbsp;</label> <!-- espaço reservado -->\n                    <div style=\"display: flex; align-items: center; gap: 4px;\">\n                        <input type=\"checkbox\" id=\"tratamento-fracao\" />\n                        <label for=\"tratamento-fracao\">Fração</label>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Linha 4: Data início, Horário, Intervalo -->\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;\">\n                <div>\n                    <label>Data Início</label>\n                    <input type=\"date\" id=\"tratamento-inicio-input\" class=\"date-input\" />\n                </div>\n                <div>\n                    <label>Horário</label>\n                    <input type=\"time\" id=\"tratamento-horario-input\" class=\"date-input\" />\n                </div>\n                <div>\n                    <label>Intervalo</label>\n                    <select id=\"tratamento-intervalo-select\" class=\"date-input\"></select>\n                </div>\n            </div>\n\n            <!-- Linha 5: Duração -->\n            <div>\n                <label>Duração</label>\n                <div style=\"display: flex; gap: 12px; align-items: center;\">\n                    <div style=\"display: flex; align-items: center; gap: 4px;\">\n                        <input type=\"checkbox\" id=\"tratamento-continuo\" />\n                        <label for=\"tratamento-continuo\">Uso contínuo</label>\n                    </div>\n                    <div id=\"tratamento-dias-wrapper\">\n                        <input type=\"number\" min=\"1\" id=\"tratamento-dias-input\" class=\"date-input\" placeholder=\"Dias\"\n                            style=\"width: 80px;\" />\n                    </div>\n                </div>\n            </div>\n\n            <!-- Observações -->\n            <div>\n                <label>Observações</label>\n                <textarea id=\"tratamento-observacoes-input\" class=\"date-input\" rows=\"3\"></textarea>\n            </div>\n        </div>\n\n        <!-- Ações -->\n        <div class=\"pop-up-actions\" style=\"margin-top: 10px;\">\n            <button id=\"cancel-tratamento\" class=\"cancel-button\" style=\"flex: 1; max-width: 100px;\">Cancelar</button>\n            <button id=\"confirm-tratamento\" class=\"confirm-button\" style=\"flex: 1; max-width: 100px;\">Salvar</button>\n        </div>\n    </div>\n\n    <div id=\"pop-up-historico\" class=\"pop-up-menu\" style=\"width: 420px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"closeHistoricoPopup()\">&times;</span>\n        <h2>Registro de histórico</h2>\n        <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 12px;\">\n            <input type=\"hidden\" id=\"historico-id\" />\n\n            <div>\n                <label>Data do Evento</label>\n                <input type=\"date\" id=\"historico-data-input\" class=\"date-input\" />\n            </div>\n\n            <div>\n                <label>Tipo</label>\n                <select id=\"historico-tipo-select\" class=\"date-input\"></select>\n            </div>\n\n            <div>\n                <label>Veterinário</label>\n                <select id=\"historico-vet-select\" class=\"date-input\"></select>\n            </div>\n\n            <div>\n                <label>Descrição</label>\n                <textarea id=\"historico-descricao-input\" class=\"date-input\" rows=\"4\"></textarea>\n            </div>\n        </div>\n\n        <div class=\"pop-up-actions\" style=\"margin-top: 10px;\">\n            <button id=\"cancel-historico\" class=\"cancel-button\" style=\"flex: 1; max-width: 100px;\">Cancelar</button>\n            <button id=\"confirm-historico\" class=\"confirm-button\" style=\"flex: 1; max-width: 100px;\">Salvar</button>\n        </div>\n    </div>\n\n    <!-- POP-UP NOVA AVALIAÇÃO -->\n    <div id=\"pop-up-avaliacao\" class=\"pop-up-menu\" style=\"width: 460px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"closeAvaliacaoPopup()\">&times;</span>\n        <h2>Avaliação / Anamnese</h2>\n\n        <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 10px;\">\n            <input type=\"hidden\" id=\"avaliacao-id\" />\n\n            <!-- Linha: Data e Veterinário -->\n            <div style=\"display: grid; grid-template-columns: 32% 1fr; gap: 8px;\">\n                <div>\n                    <label>Data da Avaliação</label>\n                    <input type=\"date\" id=\"avaliacao-data\" class=\"date-input\" />\n                </div>\n                <div>\n                    <label>Veterinário Responsável</label>\n                    <select id=\"avaliacao-vet-select\" class=\"date-input\"></select>\n                </div>\n            </div>\n\n\n            <!-- Linha: Temperatura / Peso / Score -->\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;\">\n                <div>\n                    <label>Temperatura (°C)</label>\n                    <input type=\"number\" step=\"0.1\" min=\"0\" id=\"avaliacao-temp\" class=\"date-input\"\n                        placeholder=\"Ex: 38.5\" />\n                </div>\n                <div>\n                    <label>Peso (kg)</label>\n                    <input type=\"number\" step=\"0.1\" min=\"0\" id=\"avaliacao-peso\" class=\"date-input\"\n                        placeholder=\"Ex: 10.2\" />\n                </div>\n                <div>\n                    <label>Score Corporal</label>\n                    <select id=\"avaliacao-score\" class=\"date-input\">\n                        <option value=\"\">Selecione...</option>\n                        <option value=\"1\">1 - Muito magro</option>\n                        <option value=\"2\">2 - Magro</option>\n                        <option value=\"3\">3 - Abaixo</option>\n                        <option value=\"4\">4 - Pouco abaixo</option>\n                        <option value=\"5\">5 - Ideal</option>\n                        <option value=\"6\">6 - Pouco acima</option>\n                        <option value=\"7\">7 - Sobrepeso</option>\n                        <option value=\"8\">8 - Obeso</option>\n                        <option value=\"9\">9 - Muito obeso</option>\n                    </select>\n                </div>\n            </div>\n\n            <!-- CONDIÇÕES observadas -->\n            <label for=\"condicoes-selecionadas\" style=\"font-size:0.8rem; font-weight:600; color:var(--text-dark); display:block;\">\n              Condições Identificadas\n            </label>\n            <div id=\"avaliacao-condicoes-container\" class=\"condicoes-container\">\n                <div class=\"condicoes-container-inner\" id=\"condicoes-selecionadas\"></div>\n                <button class=\"icon-button\" id=\"add-condicao-button\" title=\"Adicionar condição\">\n                    <i class=\"fa-solid fa-plus\"></i>\n                </button>\n            </div>\n\n            <!-- Observações -->\n            <div>\n                <label>Observações</label>\n                <textarea id=\"avaliacao-observacao\" class=\"date-input\" rows=\"3\"\n                    placeholder=\"Digite aqui as observações...\"></textarea>\n            </div>\n        </div>\n\n        <div class=\"pop-up-actions\" style=\"margin-top: 10px;\">\n            <button id=\"cancel-avaliacao\" class=\"cancel-button\" style=\"flex: 1;\">Cancelar</button>\n            <button id=\"confirm-avaliacao\" class=\"confirm-button\" style=\"flex: 1;\">Salvar</button>\n        </div>\n    </div>\n\n    <!-- POP-UP CONDIÇÕES -->\n    <div id=\"pop-up-condicoes\" class=\"pop-up-menu\"\n        style=\"width: 520px; height: 80vh; min-height: 600px; padding: 20px; display: none;\">\n        <span class=\"pop-up-close\" onclick=\"closeCondicoesPopup()\">&times;</span>\n        <h2>Selecione CONDIÇÕES</h2>\n\n        <div style=\"display: grid; grid-template-columns: 1fr 2fr; gap: 10px; height: calc(80vh - 100px);\">\n            <!-- Coluna esquerda: PARÂMETROS -->\n            <div id=\"parametros-list\" class=\"pop-up-options-container\"\n                style=\"border-right: 1px solid var(--border-color); overflow-y: auto;\">\n            </div>\n\n            <!-- Coluna direita: CONDIÇÕES -->\n            <div id=\"condicoes-list\" class=\"pop-up-options-container\" style=\"overflow-y: auto;\">\n                <p style=\"color: var(--text-light); font-size: 0.85rem;\">Selecione um parâmetro</p>\n            </div>\n        </div>\n    </div>\n\n\n    <!------------------------------------------ SEÇÃO DE SCRIPTS ---------------------------------------------->\n\n    <script>\n        const cachedData = {};\n        const logDetails = (...args) => console.log('[Details]', ...args);\n        const animalUpdateEndpoint = '/webhook/kaniu-animal-update';\n        const statusActionDescriptionMap = {\n            adotado: {\n                on: 'Automático: Animal foi adotado.',\n                off: 'Automático: Adoção cancelada'\n            },\n            desaparecido: {\n                on: 'Automático: Animal marcado como desaparecido',\n                off: 'Automático: Animal marcado como encontrado'\n            },\n            internado: {\n                on: 'Automático: Animal marcado como internado',\n                off: 'Automático: Animal removido da internção'\n            },\n            falecido: {\n                on: 'Automático: Animal marcado como falecido',\n                off: 'Automático: Animal marcado como vivo'\n            },\n            indisponivel: {\n                on: 'Automático: Animal marcado como indisponível',\n                off: 'Automático: Animal marcado como disponível'\n            }\n        };\n        let imunizacaoOptionsLoaded = false;\n        let imunizacaoOptionsPromise = null;\n        let observationTypeId = null;\n        let observationTypeLookupPromise = null;\n        let weightChartResizeHandlerRegistered = false;\n\n        // =========================================================================\n        // FUNÇÕES DE LÓGICA DO POP-UP DE PESAGEM (AS FUNÇÕES DE ABRIR E CLIQUE FORAM REMOVIDAS/SIMPLIFICADAS)\n        // =========================================================================\n\n        // Função de tratamento do clique na linha da tabela.\n        // É esperado que a linha tenha o atributo data-record com o JSON do item.\n        function handlePesagemClick(rowElement) {\n            // 1. Obtém a string JSON com as entidades &quot;\n            const itemDataString = rowElement.getAttribute('data-record');\n\n            // 2. Substitui as entidades &quot; pelas aspas duplas reais (\")\n            const safeJsonString = itemDataString.replace(/&quot;/g, '\"');\n\n            // 3. Faz o parse da string JSON para um objeto\n            const record = JSON.parse(safeJsonString);\n\n            logDetails('handlePesagemClick', { record });\n            // 4. Abre o pop-up com o registro\n            openPesagemPopup(record);\n        }\n\n        function handleAvaliacaoClick(rowElement) {\n            const itemDataString = rowElement.getAttribute('data-record');\n            const safeJsonString = itemDataString.replace(/&quot;/g, '\"');\n            const record = JSON.parse(safeJsonString);\n            logDetails('handleAvaliacaoClick', { record });\n            openAvaliacaoPopup(record);\n        }\n\n        function handleImunizacaoClick(rowElement) {\n            const itemDataString = rowElement.getAttribute('data-record');\n            const safeJsonString = itemDataString.replace(/&quot;/g, '\"');\n            const record = JSON.parse(safeJsonString);\n            logDetails('handleImunizacaoClick', { record });\n            openImunizacaoPopup(record);\n        }\n\n        function handleHistoricoClick(rowElement) {\n            const itemDataString = rowElement.getAttribute('data-record');\n            const safeJsonString = itemDataString.replace(/&quot;/g, '\"');\n            const record = JSON.parse(safeJsonString);\n            logDetails('handleHistoricoClick', { record });\n            openHistoricoPopup(record);\n        }\n\n        // Função para fechar o pop-up da pesagem\n        function closePesagemPopup() {\n            logDetails('closePesagemPopup');\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-pesagem').style.display = 'none';\n            // Limpa a mensagem de erro\n            const errorElement = document.getElementById('pop-up-pesagem').querySelector('.error-message-pesagem');\n            if (errorElement) {\n                errorElement.remove();\n            }\n        }\n\n        // Função para abrir o popup de pesagem (novo ou editar)\n        function openPesagemPopup(record = null) {\n            logDetails('openPesagemPopup', { record });\n            if (record) {\n                // Edição\n                document.getElementById('pesagem-id').value = record.id;\n                document.getElementById('pesagem-data-input').value = record.data;\n                document.getElementById('pesagem-peso-input').value = record.peso;\n            } else {\n                // Novo registro\n                document.getElementById('pesagem-id').value = \"\";\n                const today = new Date().toISOString().split('T')[0]; // pega AAAA-MM-DD\n                document.getElementById('pesagem-data-input').value = today;\n                document.getElementById('pesagem-peso-input').value = \"\";\n            }\n\n            document.getElementById('overlay').style.display = 'block';\n            document.getElementById('pop-up-pesagem').style.display = 'flex';\n        }\n\n        function openHistoricoPopup(record = null) {\n            logDetails('openHistoricoPopup', { record });\n            const overlay = document.getElementById('overlay');\n            const popup = document.getElementById('pop-up-historico');\n            const idInput = document.getElementById('historico-id');\n            const dataInput = document.getElementById('historico-data-input');\n            const tipoSelect = document.getElementById('historico-tipo-select');\n            const vetSelect = document.getElementById('historico-vet-select');\n            const descricaoInput = document.getElementById('historico-descricao-input');\n\n            const defaultTipoOption = tipoSelect?.querySelector('option[value=\"\"]');\n            const defaultVetOption = vetSelect?.querySelector('option[value=\"\"]');\n            if (defaultTipoOption) defaultTipoOption.textContent = 'Selecione...';\n            if (defaultVetOption) defaultVetOption.textContent = 'Selecione...';\n\n            resetFieldBorders('pop-up-historico');\n            logDetails('openHistoricoPopup:resetFieldBorders');\n\n            if (record) {\n                idInput.value = record.id || '';\n\n                if (record.data) {\n                    if (record.data.includes('/')) {\n                        const [dia, mes, ano] = record.data.split('/');\n                        dataInput.value = ano + '-' + mes + '-' + dia;\n                    } else {\n                        dataInput.value = record.data;\n                    }\n                } else {\n                    dataInput.value = '';\n                }\n\n                const tipoId = record.tipo ?? record.tipo_evento_id ?? record.tipo_id;\n                if (tipoId !== undefined && tipoId !== null && tipoId !== '') {\n                    tipoSelect.value = String(tipoId);\n                } else {\n                    tipoSelect.value = '';\n                    if (record.tipo && defaultTipoOption) {\n                        defaultTipoOption.textContent = 'Selecione... (Atual: ' + record.tipo + ')';\n                    }\n                }\n\n                const vetId = record.veterinario_id ?? record.veterinarioId;\n                if (vetId !== undefined && vetId !== null && vetId !== '') {\n                    vetSelect.value = String(vetId);\n                } else {\n                    vetSelect.value = '';\n                    if (record.veterinario_nome && defaultVetOption) {\n                        defaultVetOption.textContent = 'Selecione... (Atual: ' + record.veterinario_nome + ')';\n                    }\n                }\n\n                descricaoInput.value = record.descricao || '';\n            } else {\n                idInput.value = '';\n                const today = new Date().toISOString().split('T')[0];\n                dataInput.value = today;\n                tipoSelect.value = '';\n                vetSelect.value = '';\n                descricaoInput.value = '';\n\n                logDetails('openHistoricoPopup:newRecord');\n            }\n\n            overlay.style.display = 'block';\n            popup.style.display = 'flex';\n        }\n\n        function closeHistoricoPopup() {\n            logDetails('closeHistoricoPopup');\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-historico').style.display = 'none';\n\n            const tipoSelect = document.getElementById('historico-tipo-select');\n            const vetSelect = document.getElementById('historico-vet-select');\n            const defaultTipoOption = tipoSelect?.querySelector('option[value=\"\"]');\n            const defaultVetOption = vetSelect?.querySelector('option[value=\"\"]');\n            if (defaultTipoOption) defaultTipoOption.textContent = 'Selecione...';\n            if (defaultVetOption) defaultVetOption.textContent = 'Selecione...';\n\n            resetFieldBorders('pop-up-historico');\n        }\n\n        // Função para salvar (update ou insert)\n        async function updatePesagemRecord() {\n            const id = document.getElementById('pesagem-id').value;\n            const data = document.getElementById('pesagem-data-input').value;\n            const peso = document.getElementById('pesagem-peso-input').value;\n            logDetails('updatePesagemRecord:start', { id, data, peso });\n\n            const popup = document.getElementById('pop-up-pesagem');\n            const popupActions = popup.querySelector('.pop-up-actions');\n\n            if (!data || !peso || isNaN(parseFloat(peso))) {\n                logDetails('updatePesagemRecord:validationError', { id, data, peso });\n                const errorElement = popup.querySelector('.error-message-pesagem');\n                if (errorElement) errorElement.remove();\n                popupActions.insertAdjacentHTML(\n                    'beforebegin',\n                    '<p class=\"error-message-pesagem\" style=\"color:var(--primary-color); font-size: 0.8rem; text-align:center; margin-bottom: 5px;\">Preencha todos os campos corretamente.</p>'\n                );\n                return;\n            }\n\n            try {\n                let payload = {\n                    table: \"pesagem\",\n                    animal_id: '${animal.animal_id}',\n                    data: data,\n                    valor: parseFloat(peso)\n                };\n\n                let url = \"\";\n                if (id) {\n                    // atualização\n                    payload.id = id;\n                    url = '/webhook/kaniu-atualizar';\n                } else {\n                    // inclusão\n                    url = '/webhook/kaniu-salvar';\n                }\n                logDetails('updatePesagemRecord:request', { url, payload });\n\n                const response = await fetch(url, {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) {\n                    logDetails('updatePesagemRecord:httpError', { status: response.status, statusText: response.statusText });\n                    throw new Error(\"Falha ao salvar o registro de pesagem.\");\n                }\n\n                showAlert(id ? \"Pesagem atualizada com sucesso!\" : \"Pesagem incluída com sucesso!\", \"success\", 2000);\n\n                cachedData['pesagens'] = null;\n                await fetchTabData('pesagens');\n                logDetails('updatePesagemRecord:success', { id });\n\n            } catch (error) {\n                logDetails('updatePesagemRecord:error', { error });\n                showAlert(\"Erro ao salvar a pesagem: \" + error.message, \"error\", 3000);\n            } finally {\n                closePesagemPopup();\n            }\n        }\n\n        // =========================================================================\n\n        function renderizarResumo(resumoData) {\n            const resumoTab = document.getElementById('tab-resumo');\n            const resumoSections = resumoTab ? resumoTab.querySelector('.resume-sections') : null;\n            const sectionIds = ['saude-geral-list', 'vacinacao-list', 'parasitas-list', 'peso-list'];\n            logDetails('renderizarResumo', { hasData: Boolean(resumoData && resumoData.length) });\n\n            if (!resumoSections) {\n                logDetails('renderizarResumo:missingSections');\n                return;\n            }\n\n            if (!resumoData || resumoData.length === 0) {\n                resumoSections.classList.add('resume-empty');\n                sectionIds.forEach(id => {\n                    const container = document.getElementById(id);\n                    if (container) {\n                        container.innerHTML = '';\n                    }\n                });\n                return;\n            }\n\n            resumoSections.classList.remove('resume-empty');\n\n            const dados = resumoData[0];\n\n            const secoes = {\n                'saude-geral-list': [\n                    { label: 'Última avaliação', value: dados[\"Última avaliação\"] || 'N/A' },\n                    { label: 'Score Corporal', value: dados['Score Corporal'] !== null ? dados[\"Score Corporal\"] : 'N/A' },\n                    { label: 'Índice de saúde', value: dados['Índice de saúde'] || 'N/A' },\n                    { label: 'Observações', value: dados['Observações'] || 'N/A' }\n                ],\n                'vacinacao-list': [\n                    { label: 'Última vacinação', value: dados['Última vacinação'] || 'N/A' },\n                    { label: 'Próxima vacinação', value: dados['Próxima vacinação'] || 'N/A' }\n                ],\n                'parasitas-list': [\n                    { label: 'Última vermifugação', value: dados['Última vermifugação'] || 'N/A' },\n                    { label: 'Próxima vermifugação', value: dados['Próxima vermifugação'] || 'N/A' },\n                    { label: 'Última desparasitação', value: dados['Última desparasitação'] || 'N/A' },\n                    { label: 'Próxima desparasitação', value: dados['Próxima desparasitação'] || 'N/A' }\n                ],\n                'peso-list': [\n                    { label: 'Data da Última pesagem', value: dados['Data pesagem'] || 'N/A' },\n                    { label: 'Peso atual', value: dados['Último peso'] !== null ? dados[\"Último peso\"] + ' kg' : 'N/A' },\n                    { label: 'Peso anterior', value: dados['Peso anterior'] !== null ? dados[\"Peso anterior\"] + ' kg' : \"N/A\" },\n                    { label: 'Variação de peso', value: dados['Variação de peso'] || 'N/A' }\n                ]\n            };\n\n            for (const [id, itens] of Object.entries(secoes)) {\n                const container = document.getElementById(id);\n\n                if (container) {\n                    container.innerHTML = ''; // limpa antes\n                    itens.forEach(item => {\n                        const itemHTML = '<div class=\"resume-item\"><span class=\"resume-label\">'+item.label+'</span><span class=\"resume-value\">'+item.value+'</span></div>';\n                        container.innerHTML += itemHTML;\n                    });\n                }\n            }\n            logDetails('renderizarResumo:completed');\n        }\n\n        async function fetchTabData(tabId) {\n            logDetails('fetchTabData:start', { tabId, cached: Boolean(cachedData[tabId]) });\n            if (cachedData[tabId]) {\n                logDetails('fetchTabData:cacheHit', { tabId });\n                return;\n            }\n\n            const tabContentElement = document.getElementById('tab-' + tabId);\n            // tabContentElement.innerHTML = '<div class=\"loading-message\">Carregando...</div>';\n\n            try {\n                const payload = {\n                    tab_name: tabId,\n                    animal_id: '${animal.animal_id}'\n                };\n\n                const response = await fetch('/webhook/kaniu-animal-dados', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) {\n                    throw new Error('Erro na resposta da rede: ' + response.statusText);\n                }\n\n                const data = await response.json();\n                logDetails('fetchTabData:response', { tabId, hasError: Boolean(data?.error), itemCount: Array.isArray(data?.items) ? data.items.length : null });\n\n                // mapeamento de colunas (mantido do original)\n                const columnMappings = {\n                    'eventos': {\n                        'data': 'Data',\n                        'tipo': 'Tipo',\n                        'descricao': 'Descrição',\n                        'veterinario_nome': 'Veterinário'\n                    },\n                    'pesagens': {\n                        'data': 'Data',\n                        'peso': 'Medição',\n                        'variacao': 'Variação'\n                    },\n                    'avaliacoes': {\n                        'data': 'Data',\n                        'observacao': 'Observação',\n                        'veterinario_nome': 'Veterinário',\n                        'temperatura': 'Temp.',\n                        'score': 'Score',\n                        'peso': 'Peso',\n                        'nota': 'Nota'\n                    },\n                    'imunizacoes': {\n                        'data_exibicao': 'Data',\n                        'tipo': 'Tipo',\n                        'nome_imunizante': 'Imunizante',\n                        'veterinario_nome': 'Veterinário',\n                        'aplicada': 'Aplicada'\n                    },\n                    'tratamentos': {\n                    },\n                    'arquivos': {\n                        'data': 'Data',\n                        'nome': 'Nome',\n                        'observacao': 'Observação',\n                        'url': 'Visualizar'\n                    }\n                };\n\n                // Lista fixa de chaves a excluir\n                const excludedKeys = ['id', 'animal_id', 'concluido', 'programado', 'atrasado'];\n\n                // Função para decidir se uma chave deve ser exibida ou NÃO\n                function shouldDisplayKey(key) {\n                    // exclui qualquer chave na lista ou que termine com 'id' (case insensitive)\n                    return !excludedKeys.includes(key) && !key.toLowerCase().endsWith('id');\n                }\n\n                const renderTable = (items, tabId) => {\n                    const currentMapping = columnMappings[tabId] || {};\n                    const headers = Object.keys(items[0]).filter(shouldDisplayKey);\n\n                    let tableHTML = '<table class=\"tab-table\"><thead><tr>';\n\n                    headers.forEach(header => {\n                        const normalizedHeader = header.toLowerCase();\n                        const isLongTextColumn = ['descricao', 'descrição', 'description', 'observacao', 'observação', 'observacoes', 'observações'].includes(normalizedHeader);\n                        const columnClass = isLongTextColumn ? ' class=\"table-col-long\"' : '';\n                        let title;\n                        if (header === '__status__') {\n                            title = 'Status';\n                        } else {\n                            title = currentMapping[header] || header.charAt(0).toUpperCase() + header.slice(1);\n                        }\n                        tableHTML += '<th' + columnClass + '>' + title + '</th>';\n                    });\n\n                    if (tabId !== 'resumo') {\n                        tableHTML += '<th style=\"min-width:40px; width:auto;\"></th>'; // ações\n                    }\n\n                    tableHTML += '</tr></thead><tbody>';\n\n                    items.forEach(item => {\n                        let rowAttributes = '';\n\n                        if (tabId === 'pesagens') {\n                            const safeJson = JSON.stringify(item).replace(/\"/g, '&quot;');\n                            rowAttributes = 'data-record=\"' + safeJson + '\" onclick=\"handlePesagemClick(this)\" style=\"cursor:pointer;\"';\n                        }\n\n                        if (tabId === 'eventos') {\n                            const safeJson = JSON.stringify(item).replace(/\"/g, '&quot;');\n                            rowAttributes = 'data-record=\"' + safeJson + '\" onclick=\"handleHistoricoClick(this)\" style=\"cursor:pointer;\"';\n                        }\n\n                        if (tabId === 'tratamentos') {\n                            const safeJson = JSON.stringify(item).replace(/\"/g, '&quot;');\n                            rowAttributes = 'data-record=\"' + safeJson + '\" onclick=\"handleTratamentoClick(this)\" style=\"cursor:pointer;\"';\n                        }\n\n                        if (tabId === 'avaliacoes') {\n                            const safeJson = JSON.stringify(item).replace(/\"/g, '&quot;');\n                            rowAttributes =\n                                'data-record=\"' + safeJson + '\" onclick=\"handleAvaliacaoClick(this)\" style=\"cursor:pointer;\"';\n                        }\n\n                        if (tabId === 'imunizacoes') {\n                            const safeJson = JSON.stringify(item).replace(/\"/g, '&quot;');\n                            rowAttributes =\n                                'data-record=\"' + safeJson + '\" onclick=\"handleImunizacaoClick(this)\" style=\"cursor:pointer;\"';\n                        }\n\n\n                        tableHTML += '<tr ' + rowAttributes + '>';\n\n                        headers.forEach(header => {\n                            const normalizedHeader = header.toLowerCase();\n                            const isLongTextColumn = ['descricao', 'descrição', 'description', 'observacao', 'observação', 'observacoes', 'observações'].includes(normalizedHeader);\n                            const columnClass = isLongTextColumn ? ' class=\"table-col-long\"' : '';\n\n                            // Demais colunas\n                            let formattedContent = '';\n                            const cellContent = item[header];\n\n                            if (['data', 'data_exibicao'].includes(header) && cellContent) {\n                                const [year, month, day] = cellContent.split('-');\n                                formattedContent = day + '/' + month + '/' + year;\n                            } else if (header === 'peso' && cellContent !== null) {\n                                formattedContent = cellContent + ' kg';\n                            } else if (header === 'medicamentos' && Array.isArray(cellContent)) {\n                                formattedContent = '<ul>' + cellContent.map(med => '<li>' + med + '</li>').join('') + '</ul>';\n                            } else if (header === 'url' && cellContent) {\n                                formattedContent = '<a href=\"' + cellContent + '\" target=\"_blank\">Visualizar</a>';\n                            } else if (typeof cellContent === 'boolean') {\n                                formattedContent = cellContent ? 'Sim' : 'Não';\n                            } else {\n                                formattedContent = cellContent || '';\n                            }\n\n                            tableHTML += '<td' + columnClass + '>' + formattedContent + '</td>';\n                        });\n\n                        // Coluna de ações (somente o deletar aqui)\n                        if (tabId !== 'resumo') {\n                            const ASPAS = String.fromCharCode(39);\n                            const onclick_string = 'event.stopPropagation(); confirmDelete(' + ASPAS + tabId + ASPAS + ',' + ASPAS + item.id + ASPAS + ');';\n                            tableHTML += '<td class=\"action-cell\"><button class=\"icon-button delete-button\" title=\"Excluir\" onclick=\"' + onclick_string + '\"><i class=\"fa-solid fa-trash\"></i></button></td>';\n                        }\n\n                        tableHTML += '</tr>';\n                    });\n\n                    tableHTML += '</tbody></table>';\n                    return '<div class=\"tab-table-wrapper\">' + tableHTML + '</div>';\n                };\n                // --- fim da função substituída ---\n\n\n                // SEMPRE começamos com a faixa \"Novo\" (exceto Resumo)\n                let contentHTML = '';\n                let newButtonHTML = '';\n                if (tabId !== 'resumo') {\n                    const ap = \"'\";\n                    newButtonHTML = '<div class=\"new-button-fixed\"><button class=\"action-button\" onclick=\"handleNewRecord(' + ap + tabId + ap + ')\"><i class=\"fa-solid fa-plus\"></i></button></div>';\n                }\n\n                // Estados possíveis\n                let shouldRenderChart = false;\n                let chartDataBuffer = null;\n\n                if (data.error) {\n                    contentHTML += '<div class=\"no-data-message\">' + data.error + '</div>';\n                    if (newButtonHTML) {\n                        contentHTML += newButtonHTML;\n                    }\n                    tabContentElement.innerHTML = contentHTML;\n                    cachedData[tabId] = true;\n                    return;\n                }\n\n                if (tabId === 'resumo') {\n                    // Resumo NÃO tem botão e usa o renderizador específico\n                    //tabContentElement.innerHTML = '<div class=\"no-data-message\">Carregando resumo...</div>';\n                    renderizarResumo(data.items);\n                    cachedData[tabId] = true;\n                    logDetails('fetchTabData:cached', { tabId, mode: 'resumo' });\n                    return;\n                }\n\n                // Aplica DOM de uma vez só\n                if (newButtonHTML) {\n                    contentHTML += newButtonHTML;\n                }\n\n                // Demais guias:\n                if (!data.items || data.items.length === 0 || data.items[0].id == null) {\n                    // Sem registros - mantém o botão visível e mostra msg\n                    contentHTML += '<div class=\"no-data-message\">Nenhum item encontrado.</div>';\n                    tabContentElement.innerHTML = contentHTML;\n                    cachedData[tabId] = true;\n                    return;\n                }\n                \n                // Com registros - renderiza tabela\n                contentHTML += renderTable(data.items, tabId);\n\n                // Gráfico de Pesagens\n                if (tabId === 'pesagens' && data.chartData) {\n                    contentHTML += '<div class=\"chart-container\"><canvas id=\"weightChart\"></canvas></div>';\n                    shouldRenderChart = true;\n                    chartDataBuffer = data.chartData;\n                }\n\n                tabContentElement.innerHTML = contentHTML;\n\n                // Renderiza o gráfico após existir o canvas no DOM\n                if (shouldRenderChart && chartDataBuffer) {\n                    renderChart(chartDataBuffer);\n                }\n\n                cachedData[tabId] = true;\n                logDetails('fetchTabData:cached', { tabId, mode: 'default' });\n\n            } catch (error) {\n                logDetails('fetchTabData:error', { tabId, error });\n                tabContentElement.innerHTML = '<div class=\"error-message\">Ocorreu um erro ao carregar os dados: ' + error.message + '</div>';\n            }\n        }\n\n\n        function adjustWeightChartContainerHeight() {\n            const tabPesagens = document.getElementById('tab-pesagens');\n            if (!tabPesagens) {\n                return;\n            }\n            const chartContainer = tabPesagens.querySelector('.chart-container');\n            if (!chartContainer) {\n                return;\n            }\n            let availableHeight = tabPesagens.clientHeight;\n            if (!availableHeight) {\n                const rect = tabPesagens.getBoundingClientRect();\n                availableHeight = rect.height || tabPesagens.scrollHeight;\n            }\n            if (!availableHeight) {\n                return;\n            }\n            chartContainer.style.maxHeight = Math.max(0, Math.floor(availableHeight / 2)) + 'px';\n        }\n\n        function renderChart(chartData) {\n            // Converte dados do backend em pontos {x,y}\n            const dataPoints = chartData.map(item => ({\n                x: new Date(item.data),\n                y: item.peso\n            }));\n            logDetails('renderChart', { pointCount: dataPoints.length });\n\n            const maxWeight = Math.max(...dataPoints.map(p => p.y));\n            const maxYValue = Math.ceil(maxWeight / 10) * 10;\n\n            const ctx = document.getElementById('weightChart').getContext('2d');\n\n            // pega primeira e Última data reais do dataset\n            const dates = chartData.map(item => new Date(item.data));\n            const minDate = new Date(Math.min(...dates));\n            const today = new Date();\n\n            // adiciona margem de 15 dias antes da primeira data\n            const paddedMinDate = new Date(minDate);\n            paddedMinDate.setDate(minDate.getDate() - 15);\n\n            new Chart(ctx, {\n                type: 'line',\n                data: {\n                    datasets: [{\n                        label: 'Peso',\n                        data: dataPoints,\n                        borderColor: '#4A90E2',\n                        backgroundColor: 'rgba(74, 144, 226, 0.2)',\n                        fill: true,\n                        tension: 0.3,\n                        pointRadius: 3\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    scales: {\n                        x: {\n                            type: 'time',\n                            time: {\n                                unit: 'month',\n                                displayFormats: {\n                                    month: 'MMM yy' // Exibe Jan 23, Fev 23, etc.\n                                }\n                            },\n                            ticks: {\n                                callback: function (value, index, ticks) {\n                                    const date = new Date(value);\n                                    // Verifica se é o primeiro mês do ano (Janeiro, que é o mês 0)\n                                    if (date.getMonth() === 0) {\n                                        return date.getFullYear(); // Exibe o ano completo\n                                    } else {\n                                        // Retorna a primeira letra do mês\n                                        const month = date.toLocaleString('pt-BR', {\n                                            month: 'short'\n                                        });\n                                        return month.charAt(0).toUpperCase();\n                                    }\n                                },\n                                autoSkip: true,\n                                maxRotation: 0,\n                                minRotation: 0\n                            },\n                            min: paddedMinDate,\n                            max: today,\n                            grid: {\n                                drawTicks: true\n                            }\n                        },\n                        y: {\n                            beginAtZero: true,\n                            suggestedMax: maxYValue\n                        }\n                    },\n                    plugins: {\n                        legend: {\n                            display: false\n                        }\n                    }\n                }\n            });\n\n            requestAnimationFrame(adjustWeightChartContainerHeight);\n            if (!weightChartResizeHandlerRegistered) {\n                weightChartResizeHandlerRegistered = true;\n                window.addEventListener('resize', adjustWeightChartContainerHeight);\n                logDetails('renderChart:registeredResizeHandler');\n            }\n        }\n\n        function handleNewRecord(tabId) {\n            logDetails('handleNewRecord', { tabId });\n            if (tabId === 'pesagens') {\n                openPesagemPopup();\n            } else if (tabId === 'eventos') {\n                openHistoricoPopup();\n            } else if (tabId === 'tratamentos') {\n                openTratamentoPopup();\n            } else if (tabId === 'avaliacoes') {\n                openAvaliacaoPopup();\n            } else if (tabId === 'imunizacoes') {\n                openImunizacaoPopup();\n            } else {\n                showAlert('Abrindo formulário de novo registro em: ' + tabId, 'info', 2500);\n            }\n        }\n\n\n        // Funções para inicializar o sistema de guias, pop-ups e outras funcionalidades\n        function initTabs() {\n            const tabButtons = document.querySelectorAll('.tab-btn');\n            const tabContents = document.querySelectorAll('.tab-content');\n            logDetails('initTabs', { buttonCount: tabButtons.length });\n\n            tabButtons.forEach(button => {\n                button.addEventListener('click', () => {\n                    const tabId = button.getAttribute('data-tab');\n                    logDetails('tabClick', { tabId });\n\n                    tabButtons.forEach(btn => btn.classList.remove('active'));\n                    tabContents.forEach(content => content.classList.remove('active'));\n\n                    button.classList.add('active');\n                    document.getElementById('tab-' + tabId).classList.add('active');\n\n                    fetchTabData(tabId);\n                });\n            });\n        }\n\n        let currentButton = null;\n        let currentType = null;\n\n        function isValidIdValue(value) {\n            return value !== undefined && value !== null && value !== '';\n        }\n\n        const characteristicTypesWithLabelId = new Set(['especie', 'raca', 'genero', 'porte', 'cor', 'pelagem']);\n\n        function shouldUseLabelAsId(type) {\n            if (!type) {\n                return false;\n            }\n            return characteristicTypesWithLabelId.has(type.trim().toLowerCase());\n        }\n\n        function extractOptionLabel(item, labelKey) {\n            if (item === undefined || item === null) {\n                return '';\n            }\n\n            if (typeof item === 'string' || typeof item === 'number') {\n                return String(item);\n            }\n\n            if (labelKey && item[labelKey] !== undefined && item[labelKey] !== null) {\n                return String(item[labelKey]);\n            }\n\n            const fallbackKeys = ['nome', 'label', 'descricao', 'description', 'titulo', 'title'];\n            for (const key of fallbackKeys) {\n                if (item[key] !== undefined && item[key] !== null) {\n                    return String(item[key]);\n                }\n            }\n\n            const firstStringValue = Object.values(item).find(value => typeof value === 'string' && value.trim() !== '');\n            if (firstStringValue) {\n                return String(firstStringValue);\n            }\n\n            return '';\n        }\n\n        function extractOptionId(item, type) {\n            if (!item || typeof item !== 'object') {\n                return null;\n            }\n\n            if ('id' in item && isValidIdValue(item.id)) {\n                return item.id;\n            }\n\n            const normalizedType = typeof type === 'string' ? type.trim().toLowerCase() : '';\n            const camelType = normalizedType\n                ? normalizedType.charAt(0).toUpperCase() + normalizedType.slice(1)\n                : '';\n\n            const candidateKeys = [];\n            if (normalizedType) {\n                candidateKeys.push(normalizedType + '_id');\n                candidateKeys.push(normalizedType + 'Id');\n                candidateKeys.push(normalizedType + 'ID');\n                candidateKeys.push('id_' + normalizedType);\n                candidateKeys.push('id' + camelType);\n                candidateKeys.push(normalizedType + '_uuid');\n                candidateKeys.push(normalizedType + 'Uuid');\n                candidateKeys.push(normalizedType + 'UUID');\n            }\n\n            const fallbackKeys = ['value', 'valor', 'codigo', 'code'];\n            candidateKeys.push(...fallbackKeys);\n\n            for (const key of candidateKeys) {\n                if (!key) continue;\n                if (Object.prototype.hasOwnProperty.call(item, key) && isValidIdValue(item[key])) {\n                    return item[key];\n                }\n            }\n\n            if (normalizedType) {\n                const typeIdKey = Object.keys(item).find(k => {\n                    const lowerKey = k.toLowerCase();\n                    return lowerKey.includes('id') && lowerKey.includes(normalizedType) && isValidIdValue(item[k]);\n                });\n                if (typeIdKey) {\n                    return item[typeIdKey];\n                }\n            }\n\n            const dynamicKey = Object.keys(item).find(k => k.toLowerCase().endsWith('_id') && isValidIdValue(item[k]));\n            if (dynamicKey) {\n                return item[dynamicKey];\n            }\n\n            return null;\n        }\n\n        function openMenu(data, button, type, labelKey) {\n            logDetails('openMenu', { type, labelKey, optionCount: Array.isArray(data) ? data.length : null });\n            currentButton = button;\n            currentType = type;\n\n            const menu = document.getElementById('pop-up-menu');\n            const overlay = document.getElementById('overlay');\n            const optionsContainer = document.getElementById('pop-up-options-container');\n\n            menu.querySelector('h2').textContent = \"Selecione \" + type.charAt(0).toUpperCase() + type.slice(1);\n\n            optionsContainer.innerHTML = '';\n            data.forEach(item => {\n                const option = document.createElement('div');\n                option.classList.add('pop-up-option');\n                const optionLabelRaw = extractOptionLabel(item, labelKey);\n                const optionLabel = optionLabelRaw ?? '';\n                const trimmedOptionLabel = typeof optionLabel === 'string' ? optionLabel.trim() : String(optionLabel).trim();\n                const optionId = extractOptionId(item, type);\n                const defaultedOptionId = isValidIdValue(optionId)\n                    ? optionId\n                    : (shouldUseLabelAsId(type) && trimmedOptionLabel !== '' ? trimmedOptionLabel : null);\n                option.textContent = optionLabel;\n                option.dataset.optionId = defaultedOptionId != null ? defaultedOptionId : '';\n\n                option.onclick = () => selectOption('${animal.animal_id}', defaultedOptionId, optionLabel, item);\n                optionsContainer.appendChild(option);\n            });\n\n            overlay.style.display = 'block';\n            menu.style.display = 'flex';\n        }\n\n        function closeMenu() {\n            logDetails('closeMenu');\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-menu').style.display = 'none';\n        }\n\n        function selectOption(idAnimal, valueId, valueText, rawItem) {\n            const trimmedLabel = typeof valueText === 'string' ? valueText.trim() : (valueText ?? '');\n            const fallbackId = extractOptionId(rawItem, currentType);\n            let resolvedId = isValidIdValue(valueId) ? valueId : null;\n\n            if (!isValidIdValue(resolvedId) && isValidIdValue(fallbackId)) {\n                resolvedId = fallbackId;\n            }\n\n            const canUseLabelAsId = shouldUseLabelAsId(currentType) && trimmedLabel !== '';\n            if (!isValidIdValue(resolvedId) && canUseLabelAsId) {\n                resolvedId = trimmedLabel;\n            }\n\n            logDetails('selectOption', {\n                idAnimal,\n                currentType,\n                capturedId: valueId,\n                fallbackId,\n                labelAsId: canUseLabelAsId,\n                resolvedId,\n                valueText: trimmedLabel || valueText,\n                rawItem\n            });\n            if (currentButton && currentType) {\n                updateCharacteristic(idAnimal, currentType, resolvedId, trimmedLabel || valueText);\n            }\n            closeMenu();\n        }\n\n        async function updateCharacteristic(animalId, type, valueId, valueText) {\n            const trimmedLabel = typeof valueText === 'string' ? valueText.trim() : (valueText ?? '');\n            let resolvedValue = isValidIdValue(valueId) ? valueId : null;\n            if (!isValidIdValue(resolvedValue) && shouldUseLabelAsId(type) && trimmedLabel !== '') {\n                resolvedValue = trimmedLabel;\n            }\n\n            const payload = {\n                animal_id: animalId,\n                caracteristica: type,\n                valor: resolvedValue === undefined ? null : resolvedValue\n            };\n\n            try {\n                logDetails('updateCharacteristic:request', payload);\n                await fetch(animalUpdateEndpoint, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(payload)\n                });\n\n                currentButton.textContent = trimmedLabel || valueText || '';\n                showAlert('Item salvo com sucesso.');\n                logDetails('updateCharacteristic:success', { type, valor: payload.valor });\n            } catch (error) {\n                logDetails('updateCharacteristic:error', { error, type, valor: payload.valor });\n                showAlert('Erro ao atualizar: ' + type + ' - ', error);\n            }\n        }\n\n        async function callAnimalUpdate(caracteristica, valor, animalIdOverride = null) {\n            const payload = {\n                animal_id: animalIdOverride !== null && animalIdOverride !== undefined ? animalIdOverride : '${animal.animal_id}',\n                caracteristica,\n                valor: valor === undefined ? null : valor\n            };\n            logDetails('callAnimalUpdate:request', payload);\n\n            const response = await fetch(animalUpdateEndpoint, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(payload)\n            });\n\n            if (!response.ok) {\n                logDetails('callAnimalUpdate:httpError', { status: response.status, statusText: response.statusText });\n                throw new Error('Falha ao atualizar (HTTP ' + response.status + ')');\n            }\n\n            try {\n                const json = await response.json();\n                logDetails('callAnimalUpdate:success', { caracteristica, valor: payload.valor });\n                return json;\n            } catch (error) {\n                logDetails('callAnimalUpdate:noJson', { error });\n                return null;\n            }\n        }\n\n        function normalizeString(value) {\n            return (value || '')\n                .toString()\n                .normalize('NFD')\n                .replace(/[\\u0300-\\u036f]/g, '')\n                .toLowerCase()\n                .trim();\n        }\n\n        async function ensureObservationTypeId() {\n            logDetails('ensureObservationTypeId:start', { cached: observationTypeId !== null, inflight: Boolean(observationTypeLookupPromise) });\n            if (observationTypeId !== null) {\n                logDetails('ensureObservationTypeId:cacheHit', { observationTypeId });\n                return observationTypeId;\n            }\n            if (observationTypeLookupPromise) {\n                logDetails('ensureObservationTypeId:awaitInflight');\n                return observationTypeLookupPromise;\n            }\n\n            observationTypeLookupPromise = (async () => {\n                try {\n                    const registros = await fetchOptions('registros');\n                    const observation = (registros || []).find(item => {\n                        const label = normalizeString(item?.nome || item?.label);\n                        return label === 'observacao' || label === 'observaca';\n                    });\n                    if (observation) {\n                        observationTypeId = observation.id;\n                        logDetails('ensureObservationTypeId:found', { observationTypeId });\n                    } else {\n                        logDetails('ensureObservationTypeId:notFound');\n                    }\n                } catch (error) {\n                    logDetails('ensureObservationTypeId:error', { error });\n                } finally {\n                    observationTypeLookupPromise = null;\n                }\n                return observationTypeId;\n            })();\n\n            return observationTypeLookupPromise;\n        }\n\n        function getStatusActionDescription(caracteristica, isActive, friendlyName) {\n            const mapping = statusActionDescriptionMap[caracteristica];\n            if (mapping) {\n                return isActive ? mapping.on : mapping.off;\n            }\n            const label = friendlyName || caracteristica;\n            return 'Observacao automatica: acao ' + label + ' ' + (isActive ? 'ativada.' : 'desativada.');\n        }\n\n        async function logObservationEvent(description) {\n            if (!description) {\n                return;\n            }\n            logDetails('logObservationEvent:start', { description });\n\n            try {\n                const eventPayload = {\n                    table: 'eventos',\n                    load: {\n                        animal_id: '${animal.animal_id}',\n                        data_realizado: new Date().toISOString().split('T')[0],\n                        descricao: description\n                    }\n                };\n\n                const tipoId = await ensureObservationTypeId();\n                if (tipoId) {\n                    eventPayload.load.tipo_evento_id = tipoId;\n                }\n                logDetails('logObservationEvent:request', eventPayload);\n\n                const response = await fetch('/webhook/kaniu-salvar', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(eventPayload)\n                });\n\n                if (!response.ok) {\n                    logDetails('logObservationEvent:httpError', { status: response.status, statusText: response.statusText });\n                    throw new Error('HTTP ' + response.status);\n                }\n\n                cachedData['eventos'] = null;\n\n                const eventosTabButton = document.querySelector('.tab-btn[data-tab=\"eventos\"]');\n                if (eventosTabButton && eventosTabButton.classList.contains('active')) {\n                    await fetchTabData('eventos');\n                }\n                logDetails('logObservationEvent:success');\n            } catch (error) {\n                logDetails('logObservationEvent:error', { error });\n            }\n        }\n\nfunction updateStatusActionButton(button, isActive) {\n  if (!button) return;\n  const activeState = Boolean(isActive);\n  button.classList.toggle('active', activeState);\n  button.dataset.state = activeState ? 'true' : 'false';\n\n  const tooltip = button.querySelector('.resume-action-tooltip');\n  if (tooltip) {\n    const activeText = button.getAttribute('data-tooltip-active');\n    const inactiveText = button.getAttribute('data-tooltip-inactive');\n    if (activeState && activeText) {\n      tooltip.textContent = activeText;\n    } else if (!activeState && inactiveText) {\n      tooltip.textContent = inactiveText;\n    }\n  }\n}\n\nfunction initStatusActionButtons() {\n  const buttons = document.querySelectorAll('.resume-action-icon[data-caracteristica]');\n  logDetails('initStatusActionButtons', { count: buttons.length });\n  buttons.forEach(button => {\n    const caracteristica = button.getAttribute('data-caracteristica');\n    const targetCaracteristica = button.getAttribute('data-target') || caracteristica;\n    const invertValue = button.getAttribute('data-invert') === 'true';\n    const friendlyName =\n      button.getAttribute('data-label') ||\n      caracteristica.charAt(0).toUpperCase() + caracteristica.slice(1);\n\n    // Garante estado inicial consistente nos atributos de dados\n    updateStatusActionButton(button, button.classList.contains('active'));\n\n    const handleToggle = async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (button.dataset.statusProcessing === 'true') return;\n      button.dataset.statusProcessing = 'true';\n\n      const currentState = button.dataset.state === 'true';\n      const newState = !currentState;\n      const valueToSend = invertValue ? !newState : newState;\n      logDetails('statusActionToggle:start', { caracteristica, targetCaracteristica, currentState, newState, valueToSend });\n\n      try {\n        await callAnimalUpdate(targetCaracteristica, Boolean(valueToSend));\n        updateStatusActionButton(button, newState);\n        showAlert(friendlyName + ' ' + (newState ? 'ativado' : 'desativado') + ' com sucesso!', 'success', 2000);\n        const description = getStatusActionDescription(caracteristica, newState, friendlyName);\n        void logObservationEvent(description);\n        logDetails('statusActionToggle:success', { caracteristica, newState });\n      } catch (error) {\n        logDetails('statusActionToggle:error', { caracteristica, error });\n        const message = (error && error.message) ? error.message : error;\n        showAlert('Erro ao atualizar ' + friendlyName + ': ' + message, 'error', 3000);\n      } finally {\n        delete button.dataset.statusProcessing;\n      }\n    };\n\n    button.addEventListener('click', handleToggle);\n    button.addEventListener('keydown', (event) => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        handleToggle(event);\n      }\n    });\n  });\n}\n\n        function initDatePopup() {\n            const nascimentoButton = document.getElementById(\"open-nascimento-menu\");\n            const nascimentoPopup = document.getElementById(\"pop-up-nascimento\");\n            const nascimentoInput = document.getElementById(\"nascimento-input\");\n            const confirmNascimento = document.getElementById(\"confirm-nascimento\");\n            const cancelNascimento = document.getElementById(\"cancel-nascimento\");\n            const overlay = document.getElementById(\"overlay\");\n            const popupActions = nascimentoPopup.querySelector('.pop-up-actions');\n\n            nascimentoButton.onclick = function () {\n                if (nascimentoButton.textContent !== \"Definir Data\") {\n                    nascimentoInput.value = nascimentoButton.textContent;\n                } else {\n                    nascimentoInput.value = \"\";\n                }\n                // Limpa a mensagem de erro ao abrir\n                clearErrorMessage();\n                overlay.style.display = \"block\";\n                nascimentoPopup.style.display = \"flex\";\n            };\n\n            function clearErrorMessage() {\n                const errorElement = nascimentoPopup.querySelector('.error-message-nascimento');\n                if (errorElement) {\n                    errorElement.remove();\n                }\n            }\n\n            function showErrorMessage(message) {\n                clearErrorMessage();\n                popupActions.insertAdjacentHTML('beforebegin', '<p class=\"error-message-nascimento\" style=\"color:var(--primary-color); font-size: 0.8rem; text-align:center; margin-bottom: 5px;\">' + message + '</p>');\n            }\n\n            function closeNascimentoPopup() {\n                clearErrorMessage();\n                overlay.style.display = \"none\";\n                nascimentoPopup.style.display = \"none\";\n            }\n\n            cancelNascimento.onclick = closeNascimentoPopup;\n\n            confirmNascimento.onclick = async function () {\n                const novaData = nascimentoInput.value;\n                if (!novaData) {\n                    showErrorMessage('Selecione uma data válida.');\n                    return;\n                }\n\n                try {\n                    await callAnimalUpdate('nascimento', novaData);\n                    nascimentoButton.textContent = novaData;\n                    showAlert(\"Data de nascimento atualizada com sucesso!\");\n                } catch (error) {\n                    console.error('Erro ao atualizar data de nascimento', error);\n                    showAlert(\"Erro ao atualizar data de nascimento: \" + (error?.message || error), 'error', 3000);\n                }\n\n                closeNascimentoPopup();\n            };\n\n            document.addEventListener(\"keydown\", function (event) {\n                if (event.key !== \"Escape\" && event.key !== \"Esc\") {\n                    return;\n                }\n\n                const isVisible = (el) => !!el && window.getComputedStyle(el).display !== 'none';\n                const animaisPopup = document.getElementById('pop-up-animais');\n                const condicoesPopup = document.getElementById('pop-up-condicoes');\n                const avaliacaoPopup = document.getElementById('pop-up-avaliacao');\n\n                if (isVisible(animaisPopup) && typeof closeAnimaisPopup === 'function') {\n                    closeAnimaisPopup();\n                    return;\n                }\n\n                if (isVisible(condicoesPopup) && typeof closeCondicoesPopup === 'function') {\n                    closeCondicoesPopup(true);\n                    return;\n                }\n\n                if (isVisible(avaliacaoPopup) && typeof closeAvaliacaoPopup === 'function') {\n                    closeAvaliacaoPopup();\n                }\n\n                closeMenu();\n                closeNascimentoPopup();\n                closePesagemPopup();\n                closeHistoricoPopup();\n                closeTratamentoPopup();\n                cancelDelete();\n            });\n        }\n\n        document.addEventListener('DOMContentLoaded', function () {\n            initTabs();\n            initDatePopup();\n            initStatusActionButtons();\n\n            document.getElementById('open-especie-menu').onclick = () => openMenu(${especies}, document.getElementById('open-especie-menu'), 'especie', 'especie');\n            document.getElementById('open-raca-menu').onclick = () => openMenu(${racas}, document.getElementById('open-raca-menu'), 'raca', 'raca');\n            document.getElementById('open-genero-menu').onclick = () => openMenu(${generos}, document.getElementById('open-genero-menu'), 'genero', 'genero');\n            document.getElementById('open-porte-menu').onclick = () => openMenu(${portes}, document.getElementById('open-porte-menu'), 'porte', 'porte');\n            document.getElementById('open-cor-menu').onclick = () => openMenu(${cores}, document.getElementById('open-cor-menu'), 'cor', 'cor');\n            document.getElementById('open-pelagem-menu').onclick = () => openMenu(${pelagens}, document.getElementById('open-pelagem-menu'), 'pelagem', 'pelagem');\n\n            // Configura os botões do pop-up de pesagem (MANTIDO CASO O POP-UP SEJA USADO PARA 'NOVO')\n            document.getElementById('confirm-pesagem').onclick = updatePesagemRecord;\n            document.getElementById('cancel-pesagem').onclick = closePesagemPopup;\n            document.getElementById('confirm-historico').onclick = saveHistoricoRecord;\n            document.getElementById('cancel-historico').onclick = closeHistoricoPopup;\n\n            // Permite atualizar a foto do animal ao clicar na imagem\n            const animalPhotoImg = document.getElementById('animal-photo');\n            const animalPhotoInput = document.getElementById('animal-photo-upload-input');\n            const uploadEndpoint = '/webhook/kaniu-image-save';\n\n            if (animalPhotoImg && animalPhotoInput) {\n                animalPhotoImg.style.cursor = 'pointer';\n\n                animalPhotoImg.addEventListener('click', () => {\n                    if (animalPhotoInput.disabled) {\n                        return;\n                    }\n                    animalPhotoInput.click();\n                });\n\n                animalPhotoInput.addEventListener('change', async (event) => {\n                    const file = event.target.files && event.target.files[0];\n                    if (!file) {\n                        return;\n                    }\n\n                    if (file.type && !file.type.startsWith('image/')) {\n                        showAlert('Selecione um arquivo de imagem valido.', 'error', 3000);\n                        animalPhotoInput.value = '';\n                        return;\n                    }\n\n                    animalPhotoInput.disabled = true;\n                    const previousOpacity = animalPhotoImg.style.opacity;\n                    animalPhotoImg.style.opacity = '0.6';\n                    showAlert('Enviando nova foto...', 'info', 2000);\n\n                    try {\n                        const formData = new FormData();\n                        formData.append('animal_id', '${animal.animal_id}');\n                        formData.append('image', file, file.name);\n\n                        const response = await fetch(uploadEndpoint, {\n                            method: 'POST',\n                            body: formData\n                        });\n\n                        if (!response.ok) {\n                            throw new Error('Falha na requisicao: ' + response.status);\n                        }\n\n                        let data = null;\n                        try {\n                            data = await response.json();\n                        } catch (jsonError) {\n                            console.warn('[animal-photo-upload] Resposta sem JSON valido', jsonError);\n                        }\n\n                        const newUrl = data && (data.imageUrl || data.url || data.image || data.path);\n                        if (newUrl) {\n                            animalPhotoImg.src = newUrl;\n                        }\n\n                        showAlert('Foto enviada com sucesso.', 'success', 2500);\n                    } catch (error) {\n                        console.error('[animal-photo-upload] Erro ao enviar foto', error);\n                        showAlert('Nao foi possivel enviar a foto.', 'error', 3000);\n                    } finally {\n                        animalPhotoInput.value = '';\n                        animalPhotoInput.disabled = false;\n                        animalPhotoImg.style.opacity = previousOpacity;\n                    }\n                });\n            }\n\n\n            // Carrega a guia de resumo por padrão\n            document.querySelector('[data-tab=\"resumo\"]').click();\n        });\n\n        function showAlert(message, type = 'success', duration = 1500) {\n            logDetails('showAlert', { message, type, duration });\n            const popup = document.getElementById('alert-popup');\n            const icon = document.getElementById('alert-icon');\n            const messageText = document.getElementById('alert-message');\n\n            // Limpa classes anteriores e adiciona a nova\n            popup.className = 'alert-popup';\n            popup.classList.add(type);\n            popup.classList.add('show');\n\n            // Define o texto da mensagem\n            messageText.textContent = message;\n\n            // Limpa e define o conteúdo do ícone\n            //icon.innerHTML = '';\n            //icon.classList.add(type);\n\n            // Define um temporizador para esconder o pop-up\n            setTimeout(() => {\n                popup.classList.remove('show');\n            }, duration);\n        }\n\n        // Função para simular o início da criação de um novo registro\n        function newRecord(tabId) {\n            showAlert('Iniciando a criação de um novo registro em: ' + tabId, 'info', 2500);\n            // Coloque aqui a lógica para abrir um pop-up/formulário \n            // para a criação do novo item para a guia (tabId)\n        }\n    </script>\n\n    <script>\n\n        let deleteContext = { tabId: null, recordId: null };\n\n        function confirmDelete(tabId, recordId) {\n            deleteContext.tabId = tabId;\n            deleteContext.recordId = recordId;\n\n            const overlay = document.getElementById('overlay');\n            const popup = document.getElementById('delete-confirmation-popup');\n\n            overlay.style.display = 'block';\n            popup.style.display = 'flex';\n        }\n\n        function cancelDelete() {\n            deleteContext = { tabId: null, recordId: null };\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('delete-confirmation-popup').style.display = 'none';\n        }\n\n        async function executeDelete() {\n            if (!deleteContext.tabId || !deleteContext.recordId) {\n                cancelDelete();\n                return;\n            }\n\n            try {\n                const payload = {\n                    table: deleteContext.tabId,\n                    id: deleteContext.recordId\n                };\n\n                const response = await fetch('/webhook/kaniu-excluir', {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) throw new Error('Falha ao excluir o registro.');\n\n                showAlert('Registro excluído com sucesso!', 'success', 2000);\n                cachedData[deleteContext.tabId] = null;\n                await fetchTabData(deleteContext.tabId);\n            } catch (error) {\n                showAlert('Erro ao excluir: ' + error.message, 'error', 3000);\n            } finally {\n                cancelDelete();\n            }\n        }\n\n    </script>\n\n    <script>\n        // ===========================\n        // POPUP DE AVALIAÇÃO / ANAMNESE\n        // ===========================\n\n        async function openAvaliacaoPopup(record = null) {\n            logDetails('openAvaliacaoPopup', { record });\n            const popup = document.getElementById('pop-up-avaliacao');\n            const overlay = document.getElementById('overlay');\n\n            // Limpa campos\n            document.querySelectorAll('#pop-up-avaliacao .date-input, #pop-up-avaliacao textarea').forEach(el => el.value = '');\n\n            if (record) {\n                document.getElementById('avaliacao-id').value = record.id || '';\n                document.getElementById('avaliacao-data').value = record.data || '';\n                document.getElementById('avaliacao-vet-select').value = record.veterinario_id || '';\n                document.getElementById('avaliacao-temp').value = record.Temperatura || '';\n                document.getElementById('avaliacao-peso').value = record.Peso || '';\n                document.getElementById('avaliacao-score').value = record.Score || '';\n                document.getElementById('avaliacao-observacao').value = record.Observação || '';\n                if (!parametros.length || !condicoes.length) {\n                  await loadParametrosECondicoes();\n                }\n                hydrateCondicoesSelecionadasFromIds(record.condicoes_ids || []);\n                renderCondicoesSelecionadas();\n            } else {\n                document.getElementById('avaliacao-id').value = '';\n                document.getElementById('avaliacao-data').value = new Date().toISOString().split('T')[0];\n                condicoesSelecionadas = [];\n                renderCondicoesSelecionadas();\n            }\n\n            overlay.style.display = 'block';\n            popup.style.display = 'flex';\n        }\n\n        function closeAvaliacaoPopup() {\n            logDetails('closeAvaliacaoPopup');\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-avaliacao').style.display = 'none';\n        }\n\n        async function saveAvaliacaoRecord() {\n            try {\n                // Validação\n                const data = document.getElementById('avaliacao-data').value;\n                const vet = document.getElementById('avaliacao-vet-select').value;\n                const temp = document.getElementById('avaliacao-temp').value;\n                const peso = document.getElementById('avaliacao-peso').value;\n                const score = document.getElementById('avaliacao-score').value;\n                const observacao = document.getElementById('avaliacao-observacao').value;\n                const id = document.getElementById('avaliacao-id').value;\n\n                if (!data || !vet) {\n                    showAlert('Preencha os campos obrigatórios.', 'error', 2000);\n                    return;\n                }\n\n                const condicaoIds = condicoesSelecionadas.map(c => c.id);\n\n                const payload = {\n                    table: 'avaliacoes', // anamneses\n                    load: {\n                        animal_id: '${animal.animal_id}',\n                        data: data,\n                        veterinario_id: vet || null,\n                        temperatura: temp ? parseFloat(temp) : null,\n                        peso: peso ? parseFloat(peso) : null,\n                        score: score ? parseFloat(score) : null,\n                        observacao: observacao || '',\n                        condicoes_ids: condicaoIds\n\n                    }\n                };\n\n                if (id) payload.load.id = parseInt(id);\n\n                const endpoint = id\n                    ? '/webhook/kaniu-atualizar'\n                    : '/webhook/kaniu-salvar';\n\n                const response = await fetch(endpoint, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) throw new Error('Falha ao salvar avaliação.');\n\n                showAlert(id ? 'Avaliação atualizada com sucesso!' : 'Avaliação salva com sucesso!', 'success', 2000);\n\n                cachedData['avaliacoes'] = null;\n                await fetchTabData('avaliacoes');\n                closeAvaliacaoPopup();\n\n            } catch (err) {\n                console.error('Erro ao salvar avaliação:', err);\n                showAlert('Erro ao salvar avaliação: ' + err.message, 'error', 3000);\n            }\n        }\n\n        // ===========================\n        // Inicialização\n        // ===========================\n        document.addEventListener('DOMContentLoaded', async () => {\n            // Preenche veterinários dinamicamente\n            await populateSelect('avaliacao-vet-select', 'veterinarios');\n\n            document.getElementById('cancel-avaliacao').onclick = closeAvaliacaoPopup;\n            document.getElementById('confirm-avaliacao').onclick = saveAvaliacaoRecord;\n        });\n\n        function normalizeImunizacaoDate(value) {\n            if (!value) {\n                return '';\n            }\n            if (typeof value === 'string') {\n                const parts = value.split('T');\n                return parts[0];\n            }\n            return '';\n        }\n\n        async function ensureImunizacaoOptions() {\n            if (imunizacaoOptionsLoaded) {\n                return;\n            }\n            if (imunizacaoOptionsPromise) {\n                await imunizacaoOptionsPromise;\n                return;\n            }\n\n            imunizacaoOptionsPromise = (async () => {\n                await Promise.all([\n                    populateSelect('imunizacao-tipo-select', 'imunizacao_tipo'),\n                    populateSelect('imunizacao-imunizante-select', 'imunizante'),\n                    populateSelect('imunizacao-vet-select', 'veterinarios')\n                ]);\n                imunizacaoOptionsLoaded = true;\n            })();\n\n            try {\n                await imunizacaoOptionsPromise;\n            } catch (error) {\n                console.error('Erro ao carregar opções de imunização:', error);\n                showAlert('Não foi possível carregar as opções de imunização.', 'error', 3000);\n                throw error;\n            } finally {\n                imunizacaoOptionsPromise = null;\n            }\n        }\n\n        async function openImunizacaoPopup(record = null) {\n            try {\n                await ensureImunizacaoOptions();\n            } catch {\n                return;\n            }\n\n            resetFieldBorders('pop-up-imunizacao');\n\n            const overlay = document.getElementById('overlay');\n            const popup = document.getElementById('pop-up-imunizacao');\n\n            const idInput = document.getElementById('imunizacao-id');\n            const dataPrevistaInput = document.getElementById('imunizacao-data-prevista');\n            const dataRealizadaInput = document.getElementById('imunizacao-data-realizada');\n            const tipoSelect = document.getElementById('imunizacao-tipo-select');\n            const imunizanteSelect = document.getElementById('imunizacao-imunizante-select');\n            const vetSelect = document.getElementById('imunizacao-vet-select');\n            const descricaoInput = document.getElementById('imunizacao-descricao-input');\n            const observacaoInput = document.getElementById('imunizacao-observacao-input');\n            const aplicadaCheckbox = document.getElementById('imunizacao-aplicada-checkbox');\n\n            if (record) {\n                idInput.value = record.id != null ? String(record.id) : '';\n                dataPrevistaInput.value = normalizeImunizacaoDate(\n                    record.data_prevista || record.data_previsto || record.data_programada || record.data\n                );\n                dataRealizadaInput.value = normalizeImunizacaoDate(\n                    record.data_realizada || record.data_realizado || record.data_aplicada\n                );\n                tipoSelect.value = record.tipo_id || record.tipo || '';\n\n                const imunizanteValue = record.imunizante_id ?? record.imunizante;\n                imunizanteSelect.value = imunizanteValue != null ? String(imunizanteValue) : '';\n\n                const vetValue = record.veterinario_id || record.veterinario;\n                vetSelect.value = vetValue || '';\n\n                descricaoInput.value = record.descricao || record['Descrição'] || '';\n                observacaoInput.value = record.observacao || record.observacao_texto || record['Observações'] || '';\n\n                const appliedValue = record.aplicada;\n                aplicadaCheckbox.checked = appliedValue === true\n                    || appliedValue === 'Sim'\n                    || appliedValue === 'true'\n                    || appliedValue === 'Aplicada'\n                    || appliedValue === 1;\n            } else {\n                idInput.value = '';\n                const today = new Date().toISOString().split('T')[0];\n                dataPrevistaInput.value = today;\n                dataRealizadaInput.value = '';\n                tipoSelect.value = '';\n                imunizanteSelect.value = '';\n                vetSelect.value = '';\n                descricaoInput.value = '';\n                observacaoInput.value = '';\n                aplicadaCheckbox.checked = false;\n            }\n\n            overlay.style.display = 'block';\n            popup.style.display = 'flex';\n        }\n\n        function closeImunizacaoPopup() {\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-imunizacao').style.display = 'none';\n        }\n\n        async function saveImunizacaoRecord() {\n            try {\n                const id = document.getElementById('imunizacao-id').value;\n                const dataPrevistaInput = document.getElementById('imunizacao-data-prevista');\n                const dataRealizadaInput = document.getElementById('imunizacao-data-realizada');\n                const tipoSelect = document.getElementById('imunizacao-tipo-select');\n                const imunizanteSelect = document.getElementById('imunizacao-imunizante-select');\n                const vetSelect = document.getElementById('imunizacao-vet-select');\n                const descricaoInput = document.getElementById('imunizacao-descricao-input');\n                const observacaoInput = document.getElementById('imunizacao-observacao-input');\n                const aplicadaCheckbox = document.getElementById('imunizacao-aplicada-checkbox');\n\n                const requiredFields = [tipoSelect, imunizanteSelect, dataPrevistaInput];\n                if (aplicadaCheckbox.checked) {\n                    requiredFields.push(dataRealizadaInput);\n                }\n\n                let allValid = true;\n                requiredFields.forEach(field => {\n                    if (!field) {\n                        return;\n                    }\n                    const value = field.value?.trim?.() || '';\n                    if (!value) {\n                        field.style.border = '1px solid #d9534f';\n                        allValid = false;\n                        field.addEventListener('input', () => {\n                            field.style.border = '1px solid var(--border-color)';\n                        }, { once: true });\n                    } else {\n                        field.style.border = '1px solid var(--border-color)';\n                    }\n                });\n\n                if (!allValid) {\n                    showAlert('Preencha os campos obrigatórios.', 'error', 2500);\n                    return;\n                }\n\n                const payload = {\n                    table: 'imunizacoes',\n                    load: {\n                        animal_id: '${animal.animal_id}',\n                        tipo: tipoSelect.value || null,\n                        imunizante_id: imunizanteSelect.value ? parseInt(imunizanteSelect.value, 10) : null,\n                        veterinario_id: vetSelect.value || null,\n                        data_previsto: dataPrevistaInput.value || null,\n                        data_realizado: dataRealizadaInput.value || null,\n                        descricao: descricaoInput.value.trim() || '',\n                        observacao: observacaoInput.value.trim() || '',\n                        aplicada: aplicadaCheckbox.checked\n                    }\n                };\n\n                if (id) {\n                    payload.load.id = parseInt(id, 10);\n                }\n\n                const endpoint = id ? '/webhook/kaniu-atualizar' : '/webhook/kaniu-salvar';\n\n                const response = await fetch(endpoint, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) {\n                    throw new Error('Falha ao salvar o registro de imunização. Código: ' + response.status);\n                }\n\n                showAlert(id ? 'Imunização atualizada com sucesso!' : 'Imunização registrada com sucesso!', 'success', 2000);\n                cachedData['imunizacoes'] = null;\n                await fetchTabData('imunizacoes');\n                closeImunizacaoPopup();\n            } catch (error) {\n                console.error('Erro ao salvar imunização:', error);\n                showAlert('Erro ao salvar imunização: ' + error.message, 'error', 3000);\n            }\n        }\n\n        document.addEventListener('DOMContentLoaded', () => {\n            const cancelButton = document.getElementById('cancel-imunizacao');\n            const confirmButton = document.getElementById('confirm-imunizacao');\n            const appliedCheckbox = document.getElementById('imunizacao-aplicada-checkbox');\n            const appliedDateInput = document.getElementById('imunizacao-data-realizada');\n\n            if (cancelButton) {\n                cancelButton.onclick = closeImunizacaoPopup;\n            }\n            if (confirmButton) {\n                confirmButton.onclick = saveImunizacaoRecord;\n            }\n            if (appliedCheckbox && appliedDateInput) {\n                appliedCheckbox.addEventListener('change', () => {\n                    if (!appliedCheckbox.checked) {\n                        appliedDateInput.style.border = '1px solid var(--border-color)';\n                    }\n                });\n            }\n        });\n\n        document.addEventListener('DOMContentLoaded', () => {\n            ensureImunizacaoOptions().catch(() => { });\n        });\n\n        /****************************\n         * Popup de novo tratamento \n         ****************************/\n\n        function openTratamentoPopup(record = null) {\n            //console.log('openTratamentoPopup::', ' record:', record);\n            const popup = document.getElementById('pop-up-tratamento');\n            const overlay = document.getElementById('overlay');\n\n            if (record) {\n                // Preenche campos para edição\n                document.getElementById('tratamento-id').value = record.id || '';\n\n                // Seleciona as opções correspondentes nos combos\n                document.getElementById('tratamento-vet-select').value = record.veterinario_id || '';\n                document.getElementById('tratamento-med-select').value = record.medicamento_id || '';\n                document.getElementById('tratamento-via-select').value = record.via_id || '';\n                document.getElementById('tratamento-dosagem-select').value = record.dosagem_id || '';\n\n                // Fração x Dose\n                const fracaoCheckbox = document.getElementById('tratamento-fracao');\n                const isFracao = record.fracao_id;\n\n                fracaoCheckbox.checked = isFracao;\n                //console.log('--> createDoseInput:: isFracao: ', isFracao, ' | dose: ', record.Dose)\n                //console.log('--> record: ', record);\n                createDoseInput(isFracao, record.Dose);\n\n                // Data início, horário e intervalo\n                document.getElementById('tratamento-inicio-input').value = record.data || '';\n                document.getElementById('tratamento-horario-input').value = record.horario_id || '';\n                document.getElementById('tratamento-intervalo-select').value = record.intervalo_id || '';\n\n                // Duração / contínuo (nova lógica com continuo_id)\n                const chkContinuo = document.getElementById('tratamento-continuo');\n                const diasInput = document.getElementById('tratamento-dias-input');\n                const diasWrapper = document.getElementById('tratamento-dias-wrapper');\n\n                chkContinuo.checked = !!record.continuo_id;\n\n                if (record.continuo_id) {\n                    diasInput.value = ''; // limpa o campo de dias quando contínuo\n                    diasWrapper.style.display = 'none';\n                } else {\n                    diasInput.value = record.duracao_id || '';\n                    diasWrapper.style.display = 'block';\n                }\n\n\n                // Observações\n                document.getElementById('tratamento-observacoes-input').value = record.Observações || '';\n\n            } else {\n                // Novo registro\n                document.getElementById('tratamento-id').value = '';\n                document.getElementById('tratamento-vet-select').value = '';\n                document.getElementById('tratamento-med-select').value = '';\n                document.getElementById('tratamento-via-select').value = '';\n                document.getElementById('tratamento-dosagem-select').value = '';\n                document.getElementById('tratamento-fracao').checked = false;\n                createDoseInput(false);\n\n                const hoje = new Date().toISOString().split('T')[0];\n                document.getElementById('tratamento-inicio-input').value = hoje;\n                document.getElementById('tratamento-horario-input').value = '08:00';\n                document.getElementById('tratamento-intervalo-select').value = '';\n                document.getElementById('tratamento-continuo').checked = false;\n                document.getElementById('tratamento-dias-input').value = '';\n                document.getElementById('tratamento-observacoes-input').value = '';\n            }\n\n            overlay.style.display = 'block';\n            popup.style.display = 'flex';\n        }\n\n        const doseFractionOptions = [\n            '1/8',\n            '1/6',\n            '1/4',\n            '1/3',\n            '1/2',\n            '2/3',\n            '3/4'\n        ];\n\n        function createDoseInput(isFraction, initialValue = null) {\n            //console.log('createDoseInput:: isFraction', isFraction);\n            //console.log('createDoseInput:: initialValue', initialValue);\n            const wrapper = document.getElementById('tratamento-dose-wrapper');\n            wrapper.innerHTML = '';\n            const normalizedInitialValue = (initialValue ?? '').toString().trim();\n            if (isFraction) {\n                const select = document.createElement('select');\n                select.className = 'date-input';\n                select.id = 'tratamento-dose-select';\n                const placeholderOption = document.createElement('option');\n                placeholderOption.value = '';\n                placeholderOption.textContent = 'Selecione...';\n                select.appendChild(placeholderOption);\n\n                const options = [...doseFractionOptions];\n                if (normalizedInitialValue && !options.includes(normalizedInitialValue)) {\n                    options.push(normalizedInitialValue);\n                }\n\n                options.forEach(optText => {\n                    const opt = document.createElement('option');\n                    opt.value = optText;\n                    opt.textContent = optText;\n                    select.appendChild(opt);\n                });\n                wrapper.appendChild(select);\n                if (normalizedInitialValue) {\n                    select.value = normalizedInitialValue;\n                }\n            } else {\n                const input = document.createElement('input');\n                input.type = 'number';\n                input.min = '0';\n                input.step = '0.1';\n                input.id = 'tratamento-dose-input';\n                input.className = 'date-input';\n                wrapper.appendChild(input);\n                if (normalizedInitialValue !== '') {\n                    input.value = normalizedInitialValue;\n                }\n            }\n        }\n\n\n        function closeTratamentoPopup() {\n            const popup = document.getElementById('pop-up-tratamento');\n            const overlay = document.getElementById('overlay');\n\n            // Fecha popup e overlay\n            popup.style.display = 'none';\n            overlay.style.display = 'none';\n\n            // Limpa todos os campos destacados em vermelho\n            document.querySelectorAll('.date-input').forEach(el => {\n                el.style.border = '1px solid var(--border-color)';\n            });\n\n            // (opcional) limpa também o campo de observações e valores temporários\n            document.querySelectorAll('#pop-up-tratamento input, #pop-up-tratamento select, #pop-up-tratamento textarea').forEach(el => {\n                el.style.border = '1px solid var(--border-color)';\n            });\n        }\n\n        // Associa os botões ao popup\n        document.addEventListener('DOMContentLoaded', () => {\n            document.getElementById('cancel-tratamento').onclick = closeTratamentoPopup;\n            document.getElementById('confirm-tratamento').onclick = saveTratamentoRecord;\n        });\n    </script>\n\n    <script>\n        // cache e fila global\n        const fetchPromises = {};\n\n        async function fetchOptions(table) {\n            logDetails('fetchOptions:start', { table, cached: Boolean(cachedData[table]), inflight: Boolean(fetchPromises[table]) });\n            // já em cache?\n            if (cachedData[table]) {\n                logDetails('fetchOptions:cacheHit', { table });\n                return cachedData[table];\n            }\n\n            // já existe uma requisição em andamento? aguarda ela\n            if (fetchPromises[table]) {\n                logDetails('fetchOptions:awaitInflight', { table });\n                return await fetchPromises[table];\n            }\n\n            // inicia uma nova requisição e guarda a promise\n            fetchPromises[table] = (async () => {\n                const url = '/webhook/kaniu-data-tables';\n                const payload = { table, canil_id: ${canil_id} };\n\n            const response = await fetch(url, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload)\n            });\n            logDetails('fetchOptions:responseStatus', { table, status: response.status });\n\n            const rawText = await response.text();\n            const trimmedText = rawText.trim();\n\n            if (!response.ok) {\n                throw new Error('Falha ao carregar \"' + table + '\" (HTTP ' + response.status + ').');\n            }\n            if (!trimmedText) return [];\n\n            try {\n                const data = JSON.parse(trimmedText);\n                const items = Array.isArray(data) ? (data[0]?.items || []) : (data.items || []);\n\n                cachedData[table] = items;\n                logDetails('fetchOptions:parsed', { table, count: items.length });\n                return items;\n            } catch (parseError) {\n                logDetails('fetchOptions:parseError', { table, error: parseError, raw: trimmedText });\n                throw new Error('Erro ao carregar \"' + table + '\".');\n            }\n        })();\n\n        try {\n            const result = await fetchPromises[table];\n            logDetails('fetchOptions:resolved', { table, count: Array.isArray(result) ? result.length : null });\n            return result;\n        } finally {\n            // limpa a fila, mantendo apenas o cache\n            delete fetchPromises[table];\n            logDetails('fetchOptions:cleanup', { table });\n        }\n        }\n    </script>\n\n\n    <script>\n\n        async function populateSelect(selectId, table) {\n            logDetails('populateSelect:start', { selectId, table });\n            const select = document.getElementById(selectId);\n            select.innerHTML = '<option value=\"\">Selecione...</option>';\n\n            const items = await fetchOptions(table);\n            logDetails('populateSelect:data', { selectId, table, count: items.length });\n\n            items.forEach(item => {\n                const opt = document.createElement('option');\n                opt.value = item.id;         // valor sempre = id\n                opt.textContent = item.nome; // texto sempre = nome\n                select.appendChild(opt);\n            });\n            logDetails('populateSelect:completed', { selectId, table });\n        }\n\n        async function initHistoricoPopup() {\n            try {\n                await Promise.all([\n                    populateSelect('historico-tipo-select', 'registros'),\n                    populateSelect('historico-vet-select', 'veterinarios')\n                ]);\n                logDetails('initHistoricoPopup:ready');\n            } catch (error) {\n                logDetails('initHistoricoPopup:error', { error });\n                showAlert('Não foi possível carregar os dados do histórico.', 'error', 3000);\n            }\n        }\n\n        async function saveHistoricoRecord() {\n            try {\n                // Limpa bordas\n                document.querySelectorAll('#pop-up-historico .date-input').forEach(el => {\n                    el.style.border = '1px solid var(--border-color)';\n                });\n\n                const id = document.getElementById('historico-id').value;\n                const dataInput = document.getElementById('historico-data-input');\n                const tipoSelect = document.getElementById('historico-tipo-select');\n                const vetSelect = document.getElementById('historico-vet-select');\n                const descricaoInput = document.getElementById('historico-descricao-input');\n\n                const requiredFields = [dataInput, tipoSelect, descricaoInput];\n                let allValid = true;\n\n                requiredFields.forEach(el => {\n                    if (!el) return;\n                    const value = el.value?.trim?.() || '';\n\n                    if (!value) {\n                        el.style.border = '1px solid #d9534f';\n                        allValid = false;\n                    } else {\n                        el.style.border = '1px solid var(--border-color)';\n                    }\n\n                    el.addEventListener('input', () => {\n                        el.style.border = '1px solid var(--border-color)';\n                    }, { once: true });\n                });\n\n                if (!allValid) {\n                    showAlert('Preencha todos os campos obrigatórios.', 'error', 2500);\n                    return;\n                }\n\n                // Payload final É ENVIADO EXATAMENTE COMO O NÓ Add Evento ESPERA\n                const payload = {\n                    table: 'eventos',\n                    load: {\n                        animal_id: '${animal.animal_id}',\n                        data_realizado: dataInput.value,\n                        descricao: descricaoInput.value.trim(),\n                        tipo_evento_id: tipoSelect.value ? tipoSelect.value : null,\n                        veterinario_id: vetSelect.value ? vetSelect.value : null\n                    }\n                };\n\n                if (id) payload.load.id = parseInt(id);\n\n                const endpoint = id\n                    ? '/webhook/kaniu-atualizar'\n                    : '/webhook/kaniu-salvar';\n\n                const response = await fetch(endpoint, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n                if (!response.ok) throw new Error('Falha ao salvar o evento. Código: ' + response.status);\n\n                showAlert(id ? 'histórico atualizado com sucesso!' : 'histórico salvo com sucesso!', 'success', 2000);\n                cachedData['eventos'] = null;\n                await fetchTabData('eventos');\n                closeHistoricoPopup();\n\n            } catch (error) {\n                console.error('Erro ao salvar evento:', error);\n                showAlert('Erro ao salvar evento: ' + error.message, 'error', 3000);\n            }\n        }\n\n\n        function closeTratamentoPopup() {\n            document.getElementById('overlay').style.display = 'none';\n            document.getElementById('pop-up-tratamento').style.display = 'none';\n        }\n\n        async function initTratamentoPopup() {\n            // Combos dinâmicos\n            await populateSelect('tratamento-vet-select', 'veterinarios');\n            await populateSelect('tratamento-med-select', 'medicamentos');\n            await populateSelect('tratamento-via-select', 'vias', 'id');\n            await populateSelect('tratamento-dosagem-select', 'dosagens', 'id');\n\n            // Intervalos fixos\n            const intervalos = [1, 2, 4, 6, 8, 12, 24, 36, 48, 72];\n            const intervaloSelect = document.getElementById('tratamento-intervalo-select');\n            intervalos.forEach(i => {\n                const opt = document.createElement('option');\n                opt.value = i;\n                opt.textContent = i + ' h';\n                intervaloSelect.appendChild(opt);\n            });\n\n            // Dose dinâmica\n            const fracaoCheckbox = document.getElementById('tratamento-fracao');\n            fracaoCheckbox.addEventListener('change', () => createDoseInput(fracaoCheckbox.checked));\n            createDoseInput(false);\n\n            // Botões\n            document.getElementById('cancel-tratamento').onclick = closeTratamentoPopup;\n            document.getElementById('confirm-tratamento').onclick = saveTratamentoRecord;\n        }\n\n        async function saveTratamentoRecord() {\n            try {\n                // Limpa destaques anteriores\n                document.querySelectorAll('.date-input').forEach(el => {\n                    el.style.border = '1px solid var(--border-color)';\n                });\n\n                // 1º Coleta os valores\n                const id = document.getElementById('tratamento-id').value;\n                const veterinario = document.getElementById('tratamento-vet-select');\n                const medicamento = document.getElementById('tratamento-med-select');\n                const via = document.getElementById('tratamento-via-select');\n                const dosagem = document.getElementById('tratamento-dosagem-select');\n                const intervalo = document.getElementById('tratamento-intervalo-select');\n                const inicio = document.getElementById('tratamento-inicio-input');\n                const horario = document.getElementById('tratamento-horario-input');\n                const descricao = document.getElementById('tratamento-observacoes-input');\n                const chkContinuo = document.getElementById('tratamento-continuo');\n                const duracaoInput = document.getElementById('tratamento-dias-input');\n                const isFraction = document.getElementById('tratamento-fracao').checked;\n\n                let dose = '';\n                const doseSelect = document.getElementById('tratamento-dose-select');\n                const doseInput = document.getElementById('tratamento-dose-input');\n                if (isFraction && doseSelect) dose = doseSelect.value;\n                if (!isFraction && doseInput) dose = doseInput.value;\n\n                // 2º Campos obrigatórios\n                const requiredFields = [\n                    veterinario, medicamento, via, dosagem,\n                    inicio, horario, intervalo\n                ];\n\n                if (isFraction) {\n                    if (!doseSelect || !doseSelect.value) requiredFields.push(document.getElementById('tratamento-dose-wrapper'));\n                } else {\n                    if (!doseInput || !doseInput.value) requiredFields.push(document.getElementById('tratamento-dose-wrapper'));\n                }\n\n                if (!chkContinuo.checked) requiredFields.push(duracaoInput);\n\n                // 3º Validação visual\n                let allValid = true;\n\n                requiredFields.forEach(el => {\n                    if (!el) return;\n\n                    // Se for o wrapper do campo de dose, pega o input/select interno\n                    let targetEl = el;\n                    if (el.id === 'tratamento-dose-wrapper') {\n                        targetEl = el.querySelector('input, select');\n                    }\n\n                    const value = targetEl?.value?.trim?.() || '';\n                    const isInvalid = !value || value === 'null' || value === 'undefined';\n\n                    if (isInvalid) {\n                        targetEl.style.border = '1px solid #d9534f';\n                        allValid = false;\n                    } else {\n                        targetEl.style.border = '1px solid var(--border-color)';\n                    }\n\n                    // Remove o destaque ao corrigir\n                    targetEl.addEventListener('input', () => {\n                        targetEl.style.border = '1px solid var(--border-color)';\n                    }, { once: true });\n                });\n\n                if (!allValid) {\n                    showAlert('Preencha todos os campos obrigatórios.', 'error', 2500);\n                    return;\n                }\n\n                // 4º Monta payload\n                const payload = {\n                    table: 'tratamentos',\n                    load: {\n                        animal_id: '${animal.animal_id}',\n                        veterinario_id: veterinario.value || null,\n                        inicio: inicio.value || null,\n                        inicio_horario: horario.value || null,\n                        medicamento: medicamento.value ? parseInt(medicamento.value) : null,\n                        via: via.value || '',\n                        dosagem: dosagem.value || '',\n                        intervalo_horas: intervalo.value ? parseInt(intervalo.value) : null,\n                        descricao: descricao.value.trim() || '',\n                        continuo: chkContinuo.checked,\n                        duracao_dias: chkContinuo.checked ? null : (duracaoInput.value ? parseInt(duracaoInput.value) : null),\n                        dose: dose || '',\n                        finalizada: false,\n                        salva: true\n                    }\n                };\n\n                if (id) payload.load.id = parseInt(id);\n\n                logDetails('saveTratamentoRecord:submit', payload);\n\n                // 5º Envio CORRIGIDO\n                const endpoint = id\n                    ? '/webhook/kaniu-atualizar'   // ⇦ EDITAR\n                    : '/webhook/kaniu-salvar';     // ⇦ NOVO\n\n                const response = await fetch(endpoint, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload)\n                });\n\n\n                if (!response.ok) throw new Error('Falha ao salvar a prescrição. Código: ' + response.status);\n\n                showAlert(id ? 'Tratamento atualizado com sucesso!' : 'Tratamento salvo com sucesso!', 'success', 2000);\n                cachedData['tratamentos'] = null;\n                await fetchTabData('tratamentos');\n                closeTratamentoPopup();\n\n            } catch (error) {\n                console.error('Erro ao salvar tratamento:', error);\n                showAlert('Erro ao salvar tratamento: ' + error.message, 'error', 3000);\n            }\n        }\n\n\n        document.addEventListener('DOMContentLoaded', initHistoricoPopup);\n        document.addEventListener('DOMContentLoaded', initTratamentoPopup);\n    </script>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', () => {\n            const chkContinuo = document.getElementById('tratamento-continuo');\n            const diasWrapper = document.getElementById('tratamento-dias-wrapper');\n            const diasInput = document.getElementById('tratamento-dias-input');\n\n            function toggleDiasField() {\n                if (chkContinuo.checked) {\n                    diasWrapper.style.display = 'none';\n                    diasInput.value = 9999;  // valor especial para submissão\n                } else {\n                    diasWrapper.style.display = 'block';\n                    diasInput.value = '';    // limpa quando desmarca\n                }\n            }\n\n            chkContinuo.addEventListener('change', toggleDiasField);\n\n            // estado inicial\n            toggleDiasField();\n        });\n\n        // Função para tratar o clique em um tratamento existente\n        function handleTratamentoClick(rowElement) {\n            const itemDataString = rowElement.getAttribute('data-record');\n            const safeJsonString = itemDataString.replace(/&quot;/g, '\"');\n            const record = JSON.parse(safeJsonString);\n\n            openTratamentoPopup(record);\n        }\n\n        function resetFieldBorders(containerId) {\n            document.querySelectorAll('#' + containerId + ' input, #' + containerId + ' select, #' + containerId + ' textarea').forEach(el => {\n                el.style.border = '1px solid var(--border-color)';\n            });\n        }\n\n    </script>\n\n    <script>\n        let condicoes = [];\n        let parametros = [];\n        let condicoesSelecionadas = [];\n\n        // ===================================================\n        // ABRIR POPUP\n        // ===================================================\n        async function openCondicoesPopup() {\n            const overlay = document.getElementById('overlay');\n            const popupCond = document.getElementById('pop-up-condicoes');\n            const popupAvaliacao = document.getElementById('pop-up-avaliacao');\n\n            // Oculta popup principal\n            popupAvaliacao.style.display = 'none';\n\n            // Busca os dados apenas uma vez\n            if (!parametros.length || !condicoes.length) {\n                await loadParametrosECondicoes();\n            }\n\n            renderParametrosList();\n\n            overlay.style.display = 'block';\n            popupCond.style.display = 'flex';\n        }\n\n        // ===================================================\n        // FECHAR POPUP\n        // ===================================================\n        function closeCondicoesPopup(returnToAvaliacao = true) {\n            const condicoesPopup = document.getElementById('pop-up-condicoes');\n            const avaliacaoPopup = document.getElementById('pop-up-avaliacao');\n            const overlay = document.getElementById('overlay');\n\n            if (condicoesPopup) {\n                condicoesPopup.style.display = 'none';\n            }\n\n            if (returnToAvaliacao) {\n                if (avaliacaoPopup) {\n                    avaliacaoPopup.style.display = 'flex'; // reexibe popup de avaliação\n                }\n                if (overlay) {\n                    overlay.style.display = 'block';\n                }\n            } else {\n                if (avaliacaoPopup) {\n                    avaliacaoPopup.style.display = 'none';\n                }\n                if (overlay) {\n                    overlay.style.display = 'none';\n                }\n            }\n        }\n\n        // ===================================================\n        // CARREGAR PARÂMETROS E CONDIÇÕES DO ENDPOINT\n        // ===================================================\n        async function loadParametrosECondicoes() {\n            try {\n                const [respParam, respCond] = await Promise.all([\n                    fetchOptions('parametros'),\n                    fetchOptions('condicoes')\n                ]);\n\n                // Agora respParam e respCond já são arrays de itens normalizados\n                parametros = respParam || [];\n                condicoes = respCond || [];\n\n                // Ordenações (opcional)\n                parametros.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));\n                condicoes.sort((a, b) => (a.parametro || '').localeCompare(b.parametro || ''));\n\n            } catch (err) {\n                console.error('Erro ao carregar PARÂMETROS/CONDIÇÕES:', err);\n                showAlert('Falha ao carregar PARÂMETROS e CONDIÇÕES.', 'error', 2500);\n            }\n        }\n\n\n        let parametroSelecionado = null;\n\n        // ===================================================\n        // RENDERIZAR LISTA DE PARÂMETROS\n        // ===================================================\n        function renderParametrosList() {\n            const container = document.getElementById('parametros-list');\n            container.innerHTML = '';\n\n            if (!parametros.length) {\n                container.innerHTML =\n                    '<p style=\"color: var(--text-light); font-size: 0.85rem;\">Nenhum parâmetro encontrado.</p>';\n                return;\n            }\n\n            parametros.forEach(param => {\n                const div = document.createElement('div');\n                div.className = 'pop-up-option';\n                div.textContent = param.nome;\n\n                // marca como ativo\n                if (parametroSelecionado && parametroSelecionado === param.nome) {\n                    div.classList.add('parametro-ativo');\n                }\n\n                div.onclick = () => {\n                    parametroSelecionado = param.nome;\n                    renderParametrosList(); // re-renderiza pra destacar o ativo\n                    renderCondicoesList(param.nome);\n                };\n\n                container.appendChild(div);\n            });\n        }\n\n        // ===================================================\n        // RENDERIZAR LISTA DE CONDIÇÕES DO PARÂMETRO\n        // ===================================================\n        function renderCondicoesList(parametroNome) {\n          const container = document.getElementById('condicoes-list');\n          container.innerHTML = '';\n        \n          const condsFiltradas = condicoes\n            .filter(c => c.parametro === parametroNome)\n            .sort((a, b) => (Number(a.valor) || 0) - (Number(b.valor) || 0));\n        \n          if (!condsFiltradas.length) {\n            container.innerHTML = '<p style=\"color: var(--text-light); font-size: 0.85rem;\">Nenhuma condição cadastrada.</p>';\n            return;\n          }\n        \n          condsFiltradas.forEach(c => {\n            const div = document.createElement('div');\n            div.className = 'condicao-item';\n            div.textContent = c.nome;\n        \n            const valor = Number(c.valor) || 0;\n            const baseColor = c.negativo ? '255,0,0' : '0,128,0';\n            const alpha = c.negativo ? Math.min(0.2 + valor * 0.15, 0.8) : 0.15 + valor * 0.05;\n        \n            div.style.backgroundColor = 'rgba(' + baseColor + ', ' + alpha + ')';\n            div.onclick = function () { selectCondicao(c); };\n        \n            container.appendChild(div);\n          });\n        }\n\n        // ===================================================\n        // SELECIONAR CONDIÇÃO\n        // ===================================================\n        function selectCondicao(cond) {\n          if (condicoesSelecionadas.some(c => c.id === parseInt(cond.id))) {\n            showAlert('Condição já adicionada.', 'info', 1500);\n            return;\n          }\n        \n          condicoesSelecionadas.push({\n            id: parseInt(cond.id),\n            nome: cond.nome,\n            parametro: cond.parametro,\n            // garanta que estes dois venham do master:\n            negativo: !!cond.negativo,\n            valor: Number(cond.valor) || 0\n          });\n        \n          renderCondicoesSelecionadas();\n          closeCondicoesPopup();\n        }\n\n        function hydrateCondicoesSelecionadasFromIds(ids) {\n          if (!Array.isArray(ids)) { condicoesSelecionadas = []; return; }\n          // garanta que a lista mestre 'condicoes' já foi carregada:\n          const mapa = new Map(condicoes.map(c => [parseInt(c.id), c]));\n          condicoesSelecionadas = ids\n            .map(id => mapa.get(parseInt(id)))\n            .filter(Boolean)\n            .map(c => ({\n              id: parseInt(c.id),\n              nome: c.nome,\n              parametro: c.parametro,\n              negativo: !!c.negativo,\n              valor: Number(c.valor) || 0\n            }));\n        }\n\n        // ===================================================\n        // RENDERIZAR CONDIÇÕES SELECIONADAS NA AVALIAÇÃO\n        // ===================================================\n        function renderCondicoesSelecionadas() {\n            const container = document.getElementById('condicoes-selecionadas');\n            if (!container) return;\n        \n            container.innerHTML = ''; // limpa badges anteriores\n        \n            // Ordena por valor\n            const lista = condicoesSelecionadas.sort((a, b) => a.valor - b.valor);\n        \n            lista.forEach(cond => {\n                const badge = document.createElement('div');\n                badge.className = 'condicao-badge';\n        \n                const valor = Number(cond.valor) || 0;\n                const baseColor = cond.negativo ? '255,0,0' : '0,128,0';\n                const alpha = cond.negativo\n                    ? Math.min(0.2 + valor * 0.15, 0.8)\n                    : 0.15 + valor * 0.05;\n        \n                badge.style.backgroundColor = 'rgba(' + baseColor + ', ' + alpha + ')';\n        \n                badge.innerHTML =\n                    (cond.parametro ? '<strong>' + cond.parametro + ':</strong> ' : '') +\n                    cond.nome +\n                    ' <i class=\"fa-solid fa-xmark\" title=\"Remover\" style=\"margin-left:6px; cursor:pointer;\" onclick=\"removeCondicao(' +\n                    cond.id +\n                    ')\"></i>';\n        \n                container.appendChild(badge);\n            });\n        }\n\n\n\n        // ===================================================\n        // REMOVER CONDIÇÃO\n        // ===================================================\n        function removeCondicao(id) {\n            condicoesSelecionadas = condicoesSelecionadas.filter(c => c.id !== id);\n            renderCondicoesSelecionadas();\n        }\n\n        // ===================================================\n        // INICIALIZAÇÃO\n        // ===================================================\n        document.addEventListener('DOMContentLoaded', () => {\n            const addButton = document.getElementById('add-condicao-button');\n            if (addButton) addButton.onclick = openCondicoesPopup;\n        });\n    </script>\n\n    <script>\n        const animalsStatusFilters = [\n            { status: 'Abrigado', label: 'Abrigados' },\n            { status: 'Adotado', label: 'Adotados' },\n            { status: 'Internado', label: 'Internados' }\n        ];\n\n        const animalsPopupCache = {};\n        let currentAnimalsFilter = null;\n        let animalsFiltersInitialized = false;\n        const animalsListPageUrl = '${app_url ? app_url.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\") : ''}';\n\n        function getListPageBaseUrl() {\n            logDetails('animalsPopup:getListPageBaseUrl:start', { animalsListPageUrl });\n            if (!animalsListPageUrl) {\n                const path = window.location.pathname.split('?')[0];\n                logDetails('animalsPopup:getListPageBaseUrl:fallbackPath', { path });\n                return path;\n            }\n            const base = animalsListPageUrl.split('?')[0];\n            const normalized = base.startsWith('/') ? base : '/' + base;\n            logDetails('animalsPopup:getListPageBaseUrl:normalized', { normalized });\n            return normalized;\n        }\n\n        function ensureAnimalsFilters() {\n            logDetails('animalsPopup:ensureFilters:start', { initialized: animalsFiltersInitialized });\n            if (animalsFiltersInitialized) return;\n            const container = document.getElementById('animals-filters');\n            if (!container) return;\n\n            animalsStatusFilters.forEach(filter => {\n                const button = document.createElement('button');\n                button.type = 'button';\n                button.className = 'animals-filter-button';\n                button.setAttribute('data-animals-filter', filter.status);\n                button.textContent = filter.label;\n                button.addEventListener('click', () => handleAnimalsFilterClick(filter.status));\n                container.appendChild(button);\n            });\n\n            animalsFiltersInitialized = true;\n            logDetails('animalsPopup:ensureFilters:ready');\n        }\n\n        function openAnimaisPopup() {\n            logDetails('animalsPopup:open');\n            ensureAnimalsFilters();\n            const defaultStatus = 'Adotado';\n            currentAnimalsFilter = null;\n            const buttons = document.querySelectorAll('.animals-filter-button');\n            buttons.forEach(btn => btn.classList.remove('active'));\n            const listContainer = document.getElementById('animals-list-container');\n            if (listContainer) {\n                listContainer.innerHTML = '<p class=\"animals-list-placeholder\">Carregando animais...</p>';\n            }\n\n            const popup = document.getElementById('pop-up-animais');\n            const overlay = document.getElementById('overlay');\n\n            if (popup && overlay) {\n                overlay.style.display = 'block';\n                popup.style.display = 'flex';\n            }\n\n            handleAnimalsFilterClick(defaultStatus);\n        }\n\n        function closeAnimaisPopup() {\n            logDetails('animalsPopup:close');\n            const popup = document.getElementById('pop-up-animais');\n            const overlay = document.getElementById('overlay');\n            if (popup) popup.style.display = 'none';\n            if (overlay) overlay.style.display = 'none';\n            currentAnimalsFilter = null;\n        }\n\n        async function handleAnimalsFilterClick(status) {\n            logDetails('animalsPopup:filterClick', { status });\n            const buttons = document.querySelectorAll('.animals-filter-button');\n            const listContainer = document.getElementById('animals-list-container');\n            if (!listContainer) return;\n\n            if (currentAnimalsFilter === status) {\n                logDetails('animalsPopup:filterToggleOff', { status });\n                currentAnimalsFilter = null;\n                buttons.forEach(btn => btn.classList.remove('active'));\n                listContainer.innerHTML = '<p class=\"animals-list-placeholder\">Selecione um filtro para visualizar os animais.</p>';\n                return;\n            }\n\n            buttons.forEach(btn => {\n                if (btn.getAttribute('data-animals-filter') === status) {\n                    btn.classList.add('active');\n                } else {\n                    btn.classList.remove('active');\n                }\n            });\n\n            currentAnimalsFilter = status;\n            listContainer.innerHTML = '<p class=\"animals-list-placeholder\">Carregando animais...</p>';\n\n            try {\n                const animals = await fetchAnimalsByStatus(status);\n                logDetails('animalsPopup:filterData', { status, count: animals.length });\n                renderAnimalsList(animals);\n            } catch (error) {\n                logDetails('animalsPopup:filterError', { status, error });\n                listContainer.innerHTML = '<p class=\"animals-list-error\">Não foi possível carregar os animais agora.</p>';\n            }\n        }\n\n        function renderAnimalsList(animals) {\n            logDetails('animalsPopup:renderList', { count: Array.isArray(animals) ? animals.length : null });\n            const listContainer = document.getElementById('animals-list-container');\n            if (!listContainer) return;\n\n            if (!Array.isArray(animals) || !animals.length) {\n                listContainer.innerHTML = '<p class=\"animals-list-placeholder\">Nenhum animal encontrado para este filtro.</p>';\n                return;\n            }\n\n            const fragment = document.createDocumentFragment();\n            const sortedAnimals = [...animals].sort((a, b) => {\n                const nameA = (a.nome || '').trim();\n                const nameB = (b.nome || '').trim();\n                return nameA.localeCompare(nameB, 'pt', { sensitivity: 'base' });\n            });\n\n            sortedAnimals.forEach(animal => {\n                const button = document.createElement('button');\n                button.type = 'button';\n                button.className = 'animals-list-button';\n                button.textContent = (animal.nome || 'Animal sem nome').trim();\n                button.addEventListener('click', () => navigateToAnimalDetail(animal.animal_id || animal.id));\n                fragment.appendChild(button);\n            });\n\n            listContainer.innerHTML = '';\n            listContainer.appendChild(fragment);\n        }\n\n        function navigateToAnimalDetail(id) {\n            logDetails('animalsPopup:navigate', { id });\n            if (!id) return;\n            const basePath = window.location.pathname.split('?')[0];\n            window.location.href = basePath + '?animal_id=' + encodeURIComponent(id);\n        }\n\n        async function fetchAnimalsByStatus(status) {\n            logDetails('animalsPopup:fetchByStatus:start', { status });\n            if (animalsPopupCache[status]) {\n                logDetails('animalsPopup:fetchByStatus:cacheHit', { status, count: animalsPopupCache[status].length });\n                return animalsPopupCache[status];\n            }\n\n            const requestUrl = '/webhook/kaniu-animals-list';\n\n            const response = await fetch(requestUrl, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    status: status,\n                    canil_id: ${canil_id}\n                })\n            });\n            if (!response.ok) {\n                logDetails('animalsPopup:fetchByStatus:httpError', { status: response.status, statusText: response.statusText });\n                throw new Error('Resposta inválida (' + response.status + ')');\n            }\n\n            let data = null;\n            try {\n                data = await response.json();\n            } catch (error) {\n                logDetails('animalsPopup:fetchByStatus:jsonError', { error });\n                data = null;\n            }\n\n            let animals = [];\n            if (data) {\n                if (Array.isArray(data.animals)) {\n                    animals = data.animals;\n                } else if (Array.isArray(data.items)) {\n                    animals = data.items;\n                } else if (Array.isArray(data)) {\n                    animals = data;\n                } else if (data.animals && Array.isArray(data.animals.items)) {\n                    animals = data.animals.items;\n                }\n            }\n\n            animals = animals.map(item => ({\n                animal_id: item.animal_id || item.id || item.animalId || '',\n                nome: (item.nome || item.name || '').trim()\n            })).filter(item => item.animal_id && item.nome);\n\n            animalsPopupCache[status] = animals;\n            logDetails('animalsPopup:fetchByStatus:parsed', { status, count: animals.length });\n            return animals;\n        }\n\n        document.addEventListener('DOMContentLoaded', () => {\n            const animalsButton = document.getElementById('open-animals-popup');\n            if (animalsButton) {\n                logDetails('animalsPopup:registerButton');\n                animalsButton.addEventListener('click', openAnimaisPopup);\n            }\n        });\n    </script>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', () => {\n          const statusMap = ${JSON.stringify(initialStatusMap)};\n          Object.entries(statusMap).forEach(([key, value]) => {\n            const selector = '.resume-action-icon[data-caracteristica=\"' + key + '\"]';\n            const btn = document.querySelector(selector);\n            if (!btn) {\n              return;\n            }\n            updateStatusActionButton(btn, Boolean(value));\n          });\n        });\n    </script>\n    \n    // script para recolher sidebar\n    ${sidebar_script}\n    \n    </div>\n  </div>\n</body>\n\n\n</html>\n`;\n\nreturn [{ json: { html: html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        -256
      ],
      "id": "7831536c-493e-41f7-9a25-fab6e07ea049",
      "name": "Details Page"
    },
    {
      "parameters": {
        "jsCode": "const style = `\n<style>\n/* ==========================================================================\n// 1. IMPORTAÇÕES E FONTES\n// ========================================================================== */\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@font-face {\n    font-family: 'GoodDog';\n    src: url('https://viralatinhaz.uzd6db.easypanel.host/assets/fonts/GoodDog.ttf') format('truetype');\n    font-weight: normal;\n    font-style: normal;\n}\n\n/* ==========================================================================\n// 2. VARIÁVEIS CSS (ROOT)\n// ========================================================================== */\n:root {\n    /* Cores */\n    --primary-color: #5A5D7F;\n    --primary-background: #5A5D7FA0;\n    --background-light: #EEF2F9;\n    --background-soft: #F5F6FB;\n    --card-background: #FFFFFF;\n    --warning-color: #C62828;\n    --text-dark: #372D1F;\n    --text-light: #6B7280;\n    --text-faded: #A0A6B5;\n    --border-color: #E5E7F2;\n\n    --radius-lg: 18px;\n    --radius-md: 12px;\n    --radius-sm: 6px;\n\n    --primary-soft: #5A5D7F10;\n    --primary-strong: #5A5D7FAA;\n\n    /* Botões */\n    --button-padding: 6px 12px;\n    --button-font-size: 0.85rem;\n    --button-border-radius: 6px;\n\n    /* Offsets / sticky */\n    --tab-toolbar-h: 44px;\n    --tab-content-pt: 20px;\n    --tab-header-offset: var(--tab-content-pt);\n}\n\n/* Ajuste de Altura da Toolbar para Telas Menores */\n@media (max-width: 768px) {\n    :root { --tab-toolbar-h: 52px; }\n}\n\n/* ==========================================================================\n// 3. ESTILOS GERAIS DE LAYOUT E ESTRUTURA\n// ========================================================================== */\nbody {\n    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    margin: 0;\n    background: var(--background-light);\n    color: var(--text-dark);\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\na { color: inherit; text-decoration: none; }\n\nbutton, input, select, textarea {\n    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n}\n\n.app-shell {\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\n/* ==========================================================================\n// 4. HEADER (APP-HEADER) — ÚNICO HEADER VÁLIDO\n// ========================================================================== */\n.app-header {\n  background: var(--card-background);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-lg);\n  box-shadow: 0 15px 45px rgba(15, 23, 42, 0.05);\n  width: 100%;\n  //max-width: calc(100% - 3rem);;\n  box-sizing: border-box;\n\n  /* 🔹 Removido o sticky para que role junto */\n  position: static;\n  top: auto;\n  z-index: auto;\n\n  /* 🔹 Mantém espaçamento coerente com main */\n  margin: 0 !important; //1rem auto 0;\n  padding: 0;\n}\n\n/* 🔹 Mantém a formatação interna */\n.header-content {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n  padding: 1.25rem 1.75rem;\n  box-sizing: border-box;\n  width: 100%;\n}\n\n.header-inner {\n  width: 100%;\n  padding: 1.25rem 1.75rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between; /* garante o botão à direita */\n  gap: 1rem;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n}\n\n.header-right {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    justify-content: flex-end;\n}\n\n/* Botões do header */\n.quick-action {\n  background: var(--primary-color);\n  color: var(--card-background);\n  border: none;\n  border-radius: 50%;\n  width: 44px;\n  height: 44px;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.quick-action:hover {\n  background: color-mix(in srgb, var(--primary-color) 85%, black 15%);\n}\n\n.quick-action i,\n.back-chip i { pointer-events: none; }\n\n/* Botão \"Listar animais\" dentro do header */\n.app-header .quick-action#open-animals-popup,\n#open-animals-popup {\n  position: static !important; /* remove qualquer flutuar legado */\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--background-soft);\n  border: 1px solid var(--border-color);\n  color: var(--primary-color);\n  padding: 6px 12px;\n  border-radius: var(--radius-sm);\n  font-size: 1rem;\n  transition: background 0.2s ease, color 0.2s ease, border 0.2s ease, transform 120ms ease;\n  cursor: pointer;\n}\n.app-header .quick-action#open-animals-popup:hover,\n#open-animals-popup:hover {\n  background-color: var(--primary-color);\n  color: var(--card-background);\n  border-color: var(--primary-color);\n  transform: translateY(-1px);\n}\n\n\n/* Título e foto do animal */\n\n.animal-header {\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.animal-photo-wrapper {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.animal-photo {\n  width: 96px;\n  height: 96px;\n  border-radius: 16px;\n  object-fit: cover;\n  border: 4px solid var(--background-soft);\n  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);\n  cursor: pointer;\n  transition: transform 120ms ease;\n}\n.animal-photo:hover { transform: translateY(-1px); }\n\n.animal-title {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.animal-title h1 {\n  font-family: 'GoodDog', 'Inter', sans-serif;\n  font-size: 2.8rem;\n  font-weight: bold;\n  letter-spacing: 0.02em;\n  color: var(--primary-color);\n  margin: 0;\n  line-height: 1.1;\n}\n.animal-subline {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n\n.tag {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.35rem;\n    font-size: 0.75rem;\n    font-weight: 600;\n    padding: 0.35rem 0.7rem;\n    border-radius: 999px;\n    background: rgba(15, 118, 110, 0.12);\n    color: #0f766e;\n}\n\n.status-icon-row {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.6rem;\n    margin-top: 0.4rem;\n}\n.status-icon-row .img-button-wrapper {\n    width: 40px;\n    height: 40px;\n    background: var(--card-background);\n    border: 1px solid var(--border-color);\n    color: var(--text-light);\n}\n.status-icon-row .img-button-wrapper:hover {\n    border-color: rgba(255, 102, 0, 0.35);\n    box-shadow: 0 8px 18px rgba(255, 102, 0, 0.12);\n}\n.status-icon-row .img-button-wrapper i { color: inherit; }\n\n/* ==========================================================================\n// 5. MAIN / GRID / CARDS\n// ========================================================================== */\nmain {\n    flex: 1;\n    width: 100%;\n    max-width: calc(100% - 3rem);\n    margin: 2rem auto 3rem;\n    padding: 0 1.75rem 3rem;\n    margin-top: 0px;\n}\n\n.content-grid {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    width: 100%;\n    margin-top: 1.25rem;\n}\n\n.identity-section {\n    display: flex;\n    flex-direction: column;\n    gap: 1.75rem;\n}\n\n.card {\n    background: var(--card-background);\n    border-radius: var(--radius-lg);\n    border: 1px solid var(--border-color);\n    box-shadow: 0 15px 45px rgba(15, 23, 42, 0.05);\n    padding: 1.5rem 1.75rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1.1rem;\n}\n.tab-container.card { padding: 0; gap: 0; }\n\n.card header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 0.75rem;\n}\n.card header h2 {\n    margin: 0;\n    font-size: 1.05rem;\n    letter-spacing: -0.01em;\n    color: var(--text-dark);\n}\n\n.info-grid {\n    display: grid;\n    gap: 1rem;\n    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n}\n.info-field {\n    background: rgba(255, 255, 255, 0.8);\n    border-radius: var(--radius-md);\n    border: 1px solid var(--border-color);\n    padding: 0.75rem 0.9rem;\n    display: flex;\n    flex-direction: column;\n    gap: 0.35rem;\n}\n.info-field__label {\n    font-size: 0.72rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    color: var(--text-light);\n    font-weight: 600;\n}\n.info-field__value {\n    font-size: 0.95rem;\n    font-weight: 600;\n    color: var(--text-dark);\n}\n\n/* ==========================================================================\n// 6. TABELAS\n// ========================================================================== */\n.table-card {\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-md);\n    padding: 1rem;\n    background: var(--card-background);\n    overflow: auto;\n}\n\ntable {\n    border-collapse: collapse;\n    width: 100%;\n    min-width: 520px;\n}\nth, td {\n    text-align: left;\n    padding: 0.65rem 0.75rem;\n    font-size: 0.88rem;\n    color: var(--text-dark);\n}\nth {\n    position: sticky;\n    top: 0;\n    background: var(--background-soft, #f5f6fb);\n    z-index: 1;\n    text-transform: uppercase;\n    font-size: 0.72rem;\n    letter-spacing: 0.08em;\n    color: var(--text-light);\n}\ntbody tr {\n    border-bottom: 1px solid var(--border-color);\n    transition: background 120ms ease;\n}\ntbody tr:hover { background: rgba(255, 102, 0, 0.05); }\n\n.table-col-long { min-width: 220px; }\n\n/* ==========================================================================\n// 7. SCROLL / FOCUS / MISC\n// ========================================================================== */\n.main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    gap: 5px;\n    padding: 5px;\n    box-sizing: border-box;\n    height: calc(100% - 60px);\n}\n\n/* Ícones e foco */\ni { color: inherit; }\nbutton:focus { outline: none !important; box-shadow: none !important; }\n\n/* Scrollbar (Webkit) */\n.details-container::-webkit-scrollbar,\n.tab-content::-webkit-scrollbar { width: 8px; }\n.details-container::-webkit-scrollbar-track,\n.tab-content::-webkit-scrollbar-track {\n    background: var(--background-light);\n    border-radius: 4px;\n}\n.details-container::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 4px;\n    border: 4px solid var(--background-light);\n    background-clip: padding-box;\n    width: 14px;\n}\n.tab-content::-webkit-scrollbar-thumb {\n    background-color: var(--text-faded);\n    border-radius: 4px;\n}\n.tab-content::-webkit-scrollbar-thumb:hover { background-color: var(--primary-color); }\n\n/* Scrollbar Firefox */\n.details-container, .tab-content {\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-color) var(--background-light);\n}\n.tab-content { \n  scrollbar-color: var(--text-faded) var(--background-light); \n  padding-top: 10px !important;\n  padding-bottom: 24px !important;\n}\n\n/* ==========================================================================\n// 8. DETALHES DO ANIMAL (FRAME)\n// ========================================================================== */\n.animal-details-frame {\n    background-color: var(--card-background);\n    border-radius: 10px;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);\n    width: 380px;\n    display: flex;\n    flex-direction: column;\n    flex-shrink: 0;\n    height: 100%;\n    overflow: hidden;\n    position: relative;\n}\n.content-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    gap: 5px;\n    padding: 20px;\n    flex-shrink: 0;\n    position: relative;\n}\n.animal-photo-container {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.text-content {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    flex: 1;\n    height: auto;\n    gap: 0.75rem;\n}\n\n.details-container {\n    overflow-y: auto;\n    flex: 1;\n    padding: 0 10px 10px 10px;\n}\n.details-grid {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n    width: 100%;\n    text-align: left;\n}\n.detail-item {\n    background-color: transparent;\n    padding: 12px 15px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    border-bottom: 1px solid var(--border-color);\n    border-radius: 0;\n}\n.detail-item strong { font-size: 0.75rem; color: var(--text-dark); }\n.characteristic-box { background-color: transparent; color: var(--text-light); font-size: 0.8rem; font-weight: 500; }\n\n/* Botão de Retorno (Back Button) */\n.back-button {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    background-color: var(--background-light);\n    border: none;\n    color: var(--primary-color);\n    padding: var(--button-padding);\n    border-radius: var(--button-border-radius);\n    text-decoration: none;\n    font-size: 0.8rem;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n    font-weight: 500;\n}\n.back-button:hover { background-color: var(--primary-color); color: var(--card-background); }\n\n/* ==========================================================================\n// 9. TABS — ESTILO COM BASE NA COR SECUNDÁRIA\n// ========================================================================== */\n.tab-nav {\n    display: flex;\n    gap: 0.75rem;\n    flex-wrap: wrap;\n    padding: 0 1.75rem 0;\n    margin: 0;\n}\n\n.tab-btn {\n    border: none;\n    background: transparent;\n    padding: 0.6rem 0.9rem;\n    border-radius: var(--radius-md);\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-weight: 600;\n    color: var(--text-light);\n    cursor: pointer;\n    transition: color 120ms ease, background 120ms ease, transform 120ms ease;\n}\n\n/* Hover e ativo com base na cor secundária */\n.tab-btn:hover {\n    color: var(--primary-color);\n    background: var(--card-background);\n    transform: translateY(-1px);\n}\n\n.tab-btn.active {\n    background: var(--primary-color);\n    color: #ffffff;\n    box-shadow: 0 10px 30px rgba(90, 93, 127, 0.28);\n}\n\n.tab-btn.active:hover i { color: #ffffff; }\n\n\n/* Conteúdo */\n.tab-content-area { padding: 0 1.75rem 1.75rem; }\n.tab-content { display: none; flex-direction: column; gap: 10px; }\n.tab-content.active { display: flex; }\n\n/* Toolbar “Novo” (sticky) */\n.new-button-fixed {\n    position: sticky;\n    top: auto;\n    bottom: 0;\n    z-index: 10;\n    background: var(--card-background);\n    min-height: var(--tab-toolbar-h);\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    border-top: 8px !important;\n    border-bottom: 8px !important;\n    box-shadow: 6px !important;\n}\n/* ==========================================================================\n// BOTÃO \"NOVO\" - estilo harmonizado com o restante do app\n// ========================================================================== */\n.new-button-fixed .action-button {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--card-background);\n  color: var(--primary-color);\n  font-weight: 600;\n  border: none;\n  border-radius: var(--radius-sm);\n  padding: 0.6rem 0.6rem;\n  font-size: 0.9rem;\n  cursor: pointer;\n  box-shadow: 0 8px 18px rgba(90, 93, 127, 0.18);\n  transition: all 0.2s ease;\n}\n\n.new-button-fixed .action-button:hover {\n  background-color: var(--primary-color);\n  color: var(--card-background);\n  transform: translateY(-1px);\n}\n\n.new-button-fixed .action-button i {\n  font-size: 1rem;\n  line-height: 1;\n  color: inherit;\n}\n\n.tab-content, .tab-content-area {\n  padding-bottom: max(12px, env(safe-area-inset-bottom)) !important;\n}\n.tab-table-wrapper, .chart-container { margin-bottom: 6px !important; }\n.new-button-fixed::before, .new-button-fixed::after { content: none !important; }\n\n/* Ajuste de Offset para Guias Sem Toolbar */\n#tab-resumo { padding-top: 20px !important; }\n#tab-qualquer-guia-sem-toolbar .tab-table thead { top: 0; }\n\n// SAVE BUTTON - FORMS\n.popup-actions .action-button {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--card-background);\n  color: var(--primary-color);\n  font-weight: 600;\n  border: none;\n  border-radius: 12px;\n  padding: 0.6rem 0.6rem;\n  font-size: 0.9rem;\n  cursor: pointer;\n  box-shadow: 0 8px 18px rgba(90, 93, 127, 0.18);\n  transition: all 0.2s ease;\n}\n\n.popup-actions .action-button:hover {\n  background-color: var(--primary-color);\n  color: var(--card-background);\n  transform: translateY(-1px);\n}\n\n/* ==========================================================================\n// 10. TABELAS (TABS)\n// ========================================================================== */\n.tab-table-wrapper {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    position: relative;\n}\n.tab-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n    margin-top: 0;\n}\n.tab-table thead {\n    position: sticky;\n    top: var(--tab-header-offset);\n    z-index: 5;\n    background: var(--background-light);\n}\n/* Arredonda os cantos superiores das tabelas */\n.tab-table thead th:first-child {\n  border-top-left-radius: var(--radius-md);\n}\n.tab-table thead th:last-child {\n  border-top-right-radius: var(--radius-md);\n}\n\n/* Garante que o fundo e o raio se apliquem corretamente */\n.tab-table thead th {\n  background: var(--background-light);\n  overflow: hidden;\n}\n\n/* Opcional: suaviza a linha inferior do cabeçalho */\n.tab-table thead tr {\n  border-radius: var(--radius-md) var(--radius-md) 0 0;\n  overflow: hidden;\n}\n.tab-table thead th::after {\n    content: \"\";\n    position: absolute;\n    left: 0; right: 0; bottom: -1px;\n    height: 1px;\n    background: var(--border-color);\n}\n.tab-table th, .tab-table td {\n    padding: 12px 15px;\n    text-align: left;\n    border-bottom: 1px solid var(--border-color);\n    vertical-align: top; /* texto longo fica coerente */\n}\n.tab-table thead th {\n    position: sticky;\n    top: 0;\n    z-index: 4;\n    background-color: var(--background-light);\n    font-weight: 600;\n    color: var(--primary-color);\n}\n.tab-table td { color: var(--text-light); }\n.tab-table tbody tr:hover { background-color: rgba(90, 93, 127, 0.03); }\n\n/* Coluna de Ações */\n.action-cell {\n    vertical-align: middle;\n    text-align: center;\n    padding: 12px 0 !important;\n    min-width: 44px;\n    width: 44px;\n    box-sizing: border-box;\n}\n.action-cell .icon-button {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n}\n.action-cell .icon-button i { line-height: 1; }\n.tab-table thead th:last-child {\n    width: 44px; text-align: center;\n}\n\nth.table-col-long, td.table-col-long {\n    width: 60%;\n    max-width: 60%;\n    white-space: normal;\n    word-break: break-word;\n    overflow-wrap: anywhere;\n}\n#tab-tratamentos th.table-col-long,\n#tab-tratamentos td.table-col-long {\n    width: clamp(20%, 30%, 40%);\n    min-width: 20%;\n    max-width: 40%;\n    white-space: nowrap;\n    word-break: normal;\n    overflow-wrap: normal;\n}\n\n/* ==========================================================================\n// 11. RESUMO E TIMELINE\n// ========================================================================== */\n.timeline-container { padding: 20px; }\n.timeline-header {\n    display: flex; align-items: center; gap: 15px;\n    margin-bottom: 15px; padding: 0 15px;\n}\n.timeline-column-title { flex: 1; font-weight: 600; color: var(--primary-color); text-align: center; }\n.timeline-column-title.date-column { min-width: 100px; text-align: left; }\n.timeline-grid { display: flex; flex-direction: column; gap: 8px; }\n.timeline-item {\n    background-color: var(--background-light);\n    padding: 10px 15px;\n    border-radius: 8px;\n    display: flex; align-items: center; gap: 15px;\n}\n.timeline-item strong { min-width: 100px; color: var(--text-dark); font-weight: 500; }\n.timeline-box {\n    flex: 1;\n    background-color: var(--card-background);\n    color: var(--text-light);\n    padding: 6px 10px;\n    border-radius: 6px;\n    font-weight: 500;\n    text-align: center;\n    white-space: nowrap;\n    overflow: hidden; text-overflow: ellipsis;\n}\n\n/* Seções de Resumo */\n.resume-sections { display: flex; flex-direction: column; gap: 16px; padding: 10px; }\n.resume-section { display: flex; flex-direction: column; gap: 8px; }\n.resume-title {\n    color: var(--primary-color); font-weight: 600; margin: 0 0 4px 0;\n    font-size: 0.8rem; letter-spacing: 0.02em;\n}\n.resume-card {\n    background-color: var(--background-soft);\n    border-radius: var(--radius-md);\n    padding: 1.1rem 1.25rem;\n    border: 1px solid var(--border-color);\n    box-shadow: none;\n    display: flex; flex-direction: column; gap: 12px;\n}\n.resume-action-item { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }\n.resume-action-icon {\n    width: 42px;\n    height: 42px;\n    border-radius: var(--radius-md);\n    background-color: var(--card-background);\n    border: 1px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--primary-color);\n    font-size: 1.1rem;\n    flex-shrink: 0;\n    position: relative;\n    cursor: pointer;\n    transition: background 120ms ease, color 120ms ease, border 120ms ease, box-shadow 120ms ease;\n}\n\n.resume-action-icon:hover {\n    color: var(--card-background);\n    background-color: var(--primary-color);\n    border-color: var(--primary-color);\n    box-shadow: 0 8px 18px rgba(90, 93, 127, 0.25);\n}\n.resume-action-icon:hover i { color: inherit; }\n.resume-action-icon .resume-action-tooltip {\n    visibility: hidden; opacity: 0;\n    position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);\n    padding: 6px 12px; background-color: var(--primary-color); color: var(--card-background);\n    border-radius: 6px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; pointer-events: none;\n    transition: opacity 0.2s ease; z-index: 2;\n}\n.resume-action-icon .resume-action-tooltip::after {\n    content: \"\"; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);\n    border-width: 6px; border-style: solid;\n    border-color: var(--primary-color) transparent transparent transparent;\n}\n.resume-action-icon:hover .resume-action-tooltip { visibility: visible; opacity: 1; }\n\n.resume-empty-message {\n    display: none; padding: 18px; border-radius: 12px;\n    background-color: var(--card-background);\n    border: 1px solid rgba(90, 93, 127, 0.08);\n    color: var(--text-light); font-size: 0.75rem; text-align: center;\n}\n.resume-sections.resume-empty .resume-empty-message { display: block; }\n.resume-sections.resume-empty .resume-section:not(.resume-actions) { display: none; }\n\n.resume-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }\n\n.resume-item { \n  display: flex; \n  flex-direction: column; \n  align-items: flex-start; \n  gap: 6px; padding: 0; \n  border-radius: 0; \n  border: none; \n  background: none; \n}\n\n.resume-label {\n    font-size: 0.6rem; color: var(--text-light);\n    text-transform: uppercase; letter-spacing: 0.04em; font-weight: 600;\n}\n\n.resume-value {\n    display: block; width: 100%;\n    font-size: 0.75rem; font-weight: 600; color: var(--text-dark);\n    background-color: var(--card-background);\n    border-radius: 10px; padding: 10px 14px; box-sizing: border-box; word-break: break-word;\n}\n\n.content-section { margin-bottom: 20px; }\n.content-section h3 { color: var(--primary-color); margin-bottom: 10px; }\n.content-section p { color: var(--text-light); line-height: 1.6; }\n\n/* Gráficos */\n.chart-container {\n    position: relative;\n    width: 100%;\n    max-height: 500px;\n    margin-top: 2rem;\n    display: flex; justify-content: center; align-items: center;\n}\n\n/* ==========================================================================\n// 12. BOTÕES E COMPONENTES DE INTERAÇÃO\n// ========================================================================== */\n.detail-button,\n.animals-list-button,\n.animals-filter-button {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background-color: var(--background-soft);\n    border: 1px solid transparent;\n    border-radius: var(--radius-sm);\n    padding: 0.5rem 0.75rem;\n    font-weight: 600;\n    font-size: 0.9rem;\n    color: var(--text-dark);\n    transition: background 120ms ease, color 120ms ease, transform 120ms ease, border 120ms ease;\n    cursor: pointer;\n}\n.detail-button:hover,\n.animals-list-button:hover,\n.animals-filter-button:hover,\n.animals-filter-button.active {\n    background-color: var(--primary-color);\n    color: var(--card-background);\n    border-color: var(--primary-color);\n    transform: translateY(-1px);\n}\n/* Ajuste: botões da lista de animais ocupam linha inteira */\n.animals-list-button {\n    display: flex;           /* substitui inline-flex */\n    width: 100%;             /* ocupa toda a largura */\n    justify-content: flex-start; /* texto alinhado à esquerda */\n    box-sizing: border-box;\n    margin-bottom: 6px;      /* espaçamento entre os botões */\n    text-align: left;\n}\n\n/* Mantém o efeito de hover, mas ajustado ao novo layout */\n.animals-list-button:hover {\n    background-color: var(--primary-color);\n    color: var(--card-background);\n    border-color: var(--primary-color);\n    transform: translateY(-1px);\n}\n\n/* Botões de ícone / lixeira / status */\n.icon-button { background: none; border: none; cursor: pointer; font-size: 1rem; color: var(--text-dark); }\n.icon-button:not(.delete-button):hover { color: var(--primary-color); }\n.icon-button i {\n    vertical-align: middle;\n    font-size: 1.1rem;\n    transition: color 0.2s ease;\n    display: flex; align-items: center; justify-content: center;\n    line-height: 1; height: 100%;\n    padding: 0; border: none; background: none; cursor: pointer; color: var(--text-dark);\n}\n.icon-button i { pointer-events: none; }\n\n.icon-button.delete-button i { color: #bbb !important; font-size: 1.1rem; }\n.icon-button.delete-button:hover i { color: var(--warning-color) !important; }\n\n.status-concluido i, .status-programado i, .status-atrasado i { font-size: 1rem; color: #999; }\n.icon-button.status-concluido:hover i { color: #3CCB5A; }\n.icon-button.status-programado:hover i { color: #4A90E2; }\n.icon-button.status-atrasado:hover i { color: #E25B4A; }\n\n/* Botões de imagem com tooltip */\n.img-button-wrapper {\n    position: relative; display: flex; align-items: center; justify-content: center;\n    width: 32px; height: 32px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n    transition: all 0.2s ease; cursor: default;\n}\n.img-button { width: 24px; height: 24px; object-fit: contain; }\n.img-button-wrapper .tooltip {\n    visibility: hidden; width: max-content; background-color: var(--primary-color); color: var(--card-background);\n    text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1;\n    bottom: 150%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-size: 0.75rem; white-space: nowrap;\n}\n.img-button-wrapper .tooltip::after {\n    content: \"\"; position: absolute; top: 100%; left: 50%; margin-left: -5px;\n    border-width: 5px; border-style: solid; border-color: var(--primary-color) transparent transparent transparent;\n}\n.img-button-wrapper:hover .tooltip { visibility: visible; opacity: 1; }\n\n/* ==========================================================================\n// 13. POP-UPS E OVERLAYS\n// ========================================================================== */\n/* ==========================================================================\n// 13. POP-UPS E OVERLAYS — CORRIGIDO PARA COBRIR O HEADER\n// ========================================================================== */\n.overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.55);\n    backdrop-filter: blur(4px);\n    display: none;\n    z-index: 150; /* 🔹 agora cobre o header (z-index: 50) */\n}\n\n.pop-up-menu,\n.pop-up-animais {\n    width: min(90vw, 450px);\n    max-height: 80vh; /* 🔹 sempre 80% da altura visível */\n    height: auto;\n    display: none;\n    flex-direction: column;\n    gap: 10px;\n    overflow: hidden;\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background-color: var(--card-background);\n    border-radius: var(--radius-lg);\n    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.25);\n    z-index: 200;\n}\n/* ==========================================================================\n// POPUP DE NASCIMENTO — ESTILO COMPLETO E CORRIGIDO\n// ========================================================================== */\n\n.pop-up-menu h2 {\n  margin: 20px 0 10px 0;\n  font-size: 1rem;\n  color: var(--primary-color);\n  text-align: center;\n}\n\n#pop-up-nascimento {\n  display: none;               /* 👈 começa fechado */\n  width: 300px;\n  height: auto;\n  max-height: none;\n  overflow: visible;\n  padding: 24px 20px;\n  box-sizing: border-box;\n  border-radius: 18px;\n  background: var(--card-background);\n  gap: 12px;\n  justify-content: center;\n  align-items: stretch;\n}\n\n/* título */\n#pop-up-nascimento h2 {\n  margin: 0 0 14px 0;\n  font-size: 1rem;\n  color: var(--primary-color);\n  text-align: center;\n}\n\n/* container do input — corta o que passar */\n#pop-up-nascimento .pop-up-options-container {\n  width: 100%;\n  box-sizing: border-box;\n  overflow: hidden;           /* 👈 se o navegador pintar 1px a mais, some */\n  border-radius: 12px;\n  padding: 0;\n}\n\n/* input de data — 2px menor que o container */\n#pop-up-nascimento .date-input {\n  width: calc(100% - 2px);    /* 👈 evita o transbordo */\n  max-width: calc(100% - 2px);\n  box-sizing: border-box;\n  padding: 8px 10px;\n  border: 1px solid var(--border-color);\n  border-radius: 12px;\n  background: var(--card-background);\n  font-size: 0.9rem;\n  appearance: none;\n  -webkit-appearance: none;\n}\n\n/* ícone do calendário */\n#pop-up-nascimento input[type=\"date\"]::-webkit-calendar-picker-indicator {\n  margin-right: 4px;\n  cursor: pointer;\n}\n\n/* botões */\n#pop-up-nascimento .pop-up-actions {\n  display: flex;\n  gap: 10px;\n  margin-top: 12px;\n  justify-content: center;\n}\n#pop-up-nascimento .pop-up-actions .detail-button {\n  flex: 1;\n  max-width: 110px;\n}\n\n.animals-filters {\n    display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 5px 0 10px 0;\n}\n.animals-list-container {\n    flex: 1;\n    overflow-y: auto;\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    background-color: var(--card-background);\n    min-height: 0; /* 🔹 evita estourar o container */\n    margin: 0 20px 20px 20px;\n}\n.animals-list-placeholder, .animals-list-error {\n    text-align: center; color: var(--text-light); font-size: 0.9rem; margin: 10px 0;\n}\n.animals-list-error { color: var(--warning-color); }\n.pop-up-close { position: absolute; top: 5px; right: 10px; font-size: 2rem; cursor: pointer; color: var(--text-faded); }\n\n/* Opções de Pop-up */\n.pop-up-options-container {\n    display: flex; \n    flex-direction: column; \n    gap: 5px; \n    margin: 20px;\n}\n.pop-up-option {\n    padding: 8px 12px; background-color: var(--background-light); border-radius: 6px;\n    cursor: pointer; transition: all 0.2s ease; font-weight: 500; font-size: 0.8rem;\n}\n.pop-up-option:hover, .pop-up-option.selected {\n    background-color: var(--primary-color); color: var(--card-background);\n}\n\n/* Input de data */\n.date-input {\n    padding: 10px 15px; border-radius: 6px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; font-size: 14px;\n}\n\n/* Ações do pop-up */\n.pop-up-actions {\n    display: flex; justify-content: center; gap: 15px; margin-top: 10px; flex-wrap: wrap;\n}\n.pop-up-actions .confirm-button,\n.pop-up-actions .cancel-button,\n.pop-up-actions .delete-button,\n.popup-button {\n    padding: var(--button-padding);\n    font-size: var(--button-font-size);\n    border-radius: var(--button-border-radius);\n    border: none; cursor: pointer; flex: 1; max-width: 120px;\n}\n.pop-up-actions .confirm-button,\n.pop-up-actions .cancel-button {\n    background-color: var(--background-light); color: var(--primary-color);\n    transition: all 0.2s ease; border: none;\n}\n.pop-up-actions .confirm-button:hover,\n.pop-up-actions .cancel-button:hover {\n    background-color: var(--primary-color); color: var(--card-background);\n}\n.pop-up-actions .delete-button {\n    background-color: var(--card-background); color: var(--warning-color); border: 1px solid var(--warning-color);\n    transition: all 0.2s ease;\n}\n.pop-up-actions .delete-button:hover { background-color: var(--warning-color); color: var(--card-background); }\n.small-pop-up { min-height: auto; padding: 16px; gap: 12px; flex-direction: column; justify-content: flex-start; }\n.small-pop-up h2 { font-size: 16px; margin-bottom: 12px; }\n.pop-up-content { margin-bottom: 16px; }\n.popup-button { background-color: #f0f0f0; border: 1px solid #ccc; transition: background 0.2s; }\n.popup-button:hover { background-color: #e0e0e0; }\n\n/* Alert */\n.alert-popup {\n    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);\n    background-color: var(--card-background); color: var(--text-dark);\n    padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    display: flex; align-items: center; opacity: 0; visibility: hidden;\n    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;\n    z-index: 1000; min-width: 250px;\n}\n.alert-popup.success, .alert-popup.error { color: var(--primary-color); }\n.alert-popup.show { opacity: 1; visibility: visible; }\n.alert-icon { font-size: 12px; font-weight: 400; }\n\n/* Form dentro do pop-up */\n.pop-up-menu label {\n    display: block; font-size: 0.8rem; font-weight: 600; color: var(--text-dark); margin-bottom: 2px;\n}\n\n/* ===================================================\n   POPUPS — CAMPOS INTERNOS\n   =================================================== */\n.pop-up-menu input,\n.pop-up-menu select,\n.pop-up-menu textarea {\n  background-color: var(--background-soft);  /* 🔹 cinza-claro suave */\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-sm);\n  color: var(--text-dark);\n  font-size: 0.95rem;\n  padding: 8px 10px;\n  box-sizing: border-box;\n  width: 100%;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n\n.pop-up-menu input:focus,\n.pop-up-menu select:focus,\n.pop-up-menu textarea:focus {\n  border-color: var(--primary-color);\n  box-shadow: 0 0 0 2px var(--primary-soft);\n  outline: none;\n}\n\n/* opcional: estiliza o select para ficar coerente com o tema */\n.pop-up-menu select {\n  appearance: none;\n  background-image: url(\"data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%235A5D7F' d='M0 0l5 6 5-6z'/%3E%3C/svg%3E\");\n  background-repeat: no-repeat;\n  background-position: right 10px center;\n  background-size: 10px 6px;\n  padding-right: 28px; /* espaço pro ícone */\n}\n\n/* mantém consistência no label */\n.pop-up-menu label {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--text-light);\n  margin-bottom: 4px;\n  display: block;\n}\n\n/* Tratamento: sobrescritas */\n#pop-up-tratamento label { font-size: 0.78rem; color: var(--primary-color); font-weight: 600; }\n#tratamento-fracao { transform: translateY(2px); }\n#tratamento-dias-wrapper { display: none; }\n#tratamento-dose-wrapper {\n    border: none !important; background: transparent !important;\n    padding: 0; margin: 0; display: flex; align-items: center;\n}\n#tratamento-dose-wrapper input, #tratamento-dose-wrapper select {\n    border-radius: 8px; width: 100%;\n}\n\n/* ==========================================================================\n// 14. CONDIÇÕES OBSERVADAS (DENTRO DA AVALIAÇÃO)\n// ========================================================================== */\n.condicoes-container {\n  display: flex; flex-direction: row; align-items: center; flex-wrap: wrap;\n  gap: 4px; border: 1px solid var(--border-color); border-radius: 6px;\n  padding: 4px 6px; min-height: 32px; background-color: var(--card-background);\n  position: relative;\n}\n.condicoes-container-inner {\n  display: flex; flex-wrap: wrap; gap: 4px; align-items: center; flex: 1;\n}\n#add-condicao-button {\n  flex-shrink: 0; margin-left: auto; font-size: 1rem; color: var(--primary-color);\n  background: none; border: none; cursor: pointer; transition: color 0.2s ease;\n}\n#add-condicao-button:hover { color: var(--primary-color); }\n.condicao-badge { margin: 2px; padding: 5px 8px; border-radius: 6px; font-size: 0.82rem; }\n.condicao-badge:hover { transform: scale(1.03); }\n.condicao-badge i { cursor: pointer; opacity: 0.8; transition: opacity 0.2s; }\n.condicao-badge i:hover { opacity: 1; }\n#parametros-list { padding-right: 8px; }\n.parametro-ativo { background-color: var(--primary-color); color: var(--card-background); }\n.condicao-item {\n    border-radius: 6px; margin-bottom: 4px; padding: 6px 8px; cursor: pointer; font-size: 0.85rem;\n    transition: background-color 0.2s ease, transform 0.1s ease;\n}\n.condicao-item:hover { transform: translateX(2px); }\n\n/* ==========================================================================\n// 15. MENSAGEM DE LISTA VAZIA / SEM ITENS\n// ========================================================================== */\n.empty-message, .no-data-message, .no-items-message, .animals-list-placeholder {\n    color: var(--primary-color);\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-align: center;\n    margin: 40px 0 40px 0;\n}\n\n/* ==========================================================================\n// 16. RESPONSIVIDADE\n// ========================================================================== */\n@media (max-width: 768px) {\n    .timeline-header { display: none; }\n    .timeline-item { flex-direction: column; align-items: stretch; gap: 8px; }\n    .timeline-item strong {\n        min-width: auto; text-align: center; background-color: var(--primary-color);\n        color: var(--card-background); padding: 6px 10px; border-radius: 6px;\n    }\n    .timeline-box { text-align: left; }\n    .resume-list { grid-template-columns: 1fr; }\n    .tab-btn { min-width: 70px; padding: 12px 12px; font-size: 0.8rem; }\n    .tab-content { padding: 10px; }\n}\n@media (max-width: 480px) {\n    .main-content { flex-direction: column; }\n    .animal-details-frame { width: 100%; height: auto; }\n    .content-wrapper, .text-content { height: auto; }\n    .pop-up-menu { width: 85%; }\n    .tab-btn { min-width: 60px; padding: 10px 12px; font-size: 0.75rem; }\n    .tab-content { padding: 10px; }\n}\n@media (max-width: 720px) {\n  .animal-title h1 {\n    font-size: 1.9rem;\n  }\n}\n/* ============================================================\n   ESTILO UNIFICADO DE CHIPS / TAGS / CÁPSULAS — COR SECUNDÁRIA\n   ============================================================ */\n.chip {\n  appearance: none;\n  border: none;\n  outline: none;\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 600;\n  letter-spacing: 0.01em;\n  padding: 0.6rem 0.7rem;\n  line-height: 1;\n  cursor: default;\n  transition: all 0.2s ease;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  white-space: nowrap;\n}\n\n/* Estado neutro (valor indefinido) */\n.chip.is-empty {\n  background: var(--primary-soft);\n  color: var(--text-light);\n}\n\n/* ============================================================\n   CHIPS DE AÇÃO — estilo destacado\n   ============================================================ */\n.chip.is-action {\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  cursor: pointer;\n  border: 1px !important;\n  border-color: var(--primary-color) !important;\n}\n\n.chip.is-action:hover {\n  background: var(--primary-color);\n  color: #FFF;\n  transform: translateY(-1px);\n}\n\n/* Containers */\n.identity-chips {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  margin-top: 0.6rem;\n}\n\n.animal-subline {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.4rem;\n  margin-top: 0.4rem;\n}\n\n/* Responsividade */\n@media (max-width: 720px) {\n  .chip {\n    font-size: 0.72rem;\n    padding: 0.4rem 0.8rem;\n  }\n  .animal-subline, .identity-chips { gap: 0.35rem; }\n}\n\n/* ============================================================\n   SIDEBAR LAYOUT\n   ============================================================ */\n.sidebar {\n  position: fixed;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 240px;\n  background-color: var(--card-background);\n  border-right: 1px solid var(--border-color);\n  box-shadow: 4px 0 12px rgba(15, 23, 42, 0.05);\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  z-index: 100;\n  transition: width 0.25s ease;\n}\n\n.sidebar.collapsed {\n  width: 72px;\n}\n\n.sidebar-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 12px 16px;\n}\n\n.sidebar-logo {\n  height: 32px;\n  transition: opacity 0.25s ease;\n}\n\n.sidebar.collapsed .sidebar-logo {\n  opacity: 0;\n  visibility: hidden;\n}\n\n.sidebar-toggle {\n  background: none;\n  border: none;\n  color: var(--primary-color);\n  font-size: 1.2rem;\n  cursor: pointer;\n  transition: color 0.2s ease;\n}\n\n.sidebar-toggle:hover {\n  color: var(--primary-color);\n}\n\n/* Itens de menu */\n.sidebar-menu, .sidebar-footer {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  padding: 12px 12px;\n}\n\n.sidebar-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  background: transparent;\n  border: none;\n  color: var(--text-light);\n  font-size: 0.95rem;\n  font-weight: 500;\n  padding: 10px 14px;\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  text-align: left;\n  transition: background 0.2s, color 0.2s, transform 0.15s;\n}\n\n.sidebar-item i {\n  font-size: 1.1rem;\n  min-width: 20px;\n  text-align: center;\n}\n\n.sidebar-item:hover {\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  transform: translateY(-1px);\n}\n\n.sidebar-item.active {\n  background: var(--primary-color);\n  color: #fff;\n  box-shadow: 0 6px 16px rgba(90,93,127,0.25);\n}\n\n.sidebar.collapsed .sidebar-item span {\n  display: none;\n}\n\n/* Rodapé */\n.sidebar-footer {\n  border-top: 1px solid var(--border-color);\n  padding-top: 8px;\n  margin-top: auto;\n}\n\n/* Ajuste de conteúdo principal */\n.main-with-sidebar {\n  margin-left: 240px;\n  transition: margin-left 0.25s ease;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n}\n\n.main-with-sidebar.expanded {\n  margin-left: 72px;\n}\n\n/* ===================================================\n   CORREÇÃO REAL DO DESLOCAMENTO DAS TABELAS\n   =================================================== */\n\n/* 1. a aba não pode ter gap entre o header e a tabela */\n\n/* 3. o sticky do thead deve colar no topo da aba */\n.tab-table thead,\n.tab-table thead th {\n  top: 0 !important;\n}\n\n\n\n</style>\n`;\nreturn { style };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        -256
      ],
      "id": "f3b624ed-674e-449c-b7fc-7b207e0642db",
      "name": "Details Style"
    },
    {
      "parameters": {
        "jsCode": "const style = `\n<style>\n/* ==========================================================================\n// 1. IMPORTAÇÕES E FONTES\n// ========================================================================== */\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@font-face {\n    font-family: 'GoodDog';\n    src: url('https://viralatinhaz.uzd6db.easypanel.host/assets/fonts/GoodDog.ttf') format('truetype');\n    font-weight: normal;\n    font-style: normal;\n}\n\n/* ==========================================================================\n// 2. VARIÁVEIS CSS (ROOT)\n// ========================================================================== */\n:root {\n    /* Cores */\n    --primary-color: #5A5D7F;\n    --primary-background: #5A5D7FA0;\n    --background-light: #EEF2F9;\n    --background-soft: #F5F6FB;\n    --card-background: #FFFFFF;\n    --warning-color: #C62828;\n    --text-dark: #372D1F;\n    --text-light: #6B7280;\n    --text-faded: #A0A6B5;\n    --border-color: #E5E7F2;\n\n    --radius-lg: 18px;\n    --radius-md: 12px;\n    --radius-sm: 6px;\n\n    --primary-soft: #5A5D7F10;\n    --primary-strong: #5A5D7FAA;\n\n    /* Botões */\n    --button-padding: 6px 12px;\n    --button-font-size: 0.85rem;\n    --button-border-radius: 6px;\n\n    /* Offsets / sticky */\n    --tab-toolbar-h: 44px;\n    --tab-content-pt: 20px;\n    --tab-header-offset: var(--tab-content-pt);\n}\n\n/* Ajuste de Altura da Toolbar para Telas Menores */\n@media (max-width: 768px) {\n    :root { --tab-toolbar-h: 52px; }\n}\n\n/* ==========================================================================\n// 3. ESTILOS GERAIS DE LAYOUT E ESTRUTURA\n// ========================================================================== */\nbody {\n    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    margin: 0;\n    background: var(--background-light);\n    color: var(--text-dark);\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\na { color: inherit; text-decoration: none; }\n\nbutton, input, select, textarea {\n    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n}\n\n.app-shell {\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\n/* ==========================================================================\n// 4. HEADER (APP-HEADER) — ÚNICO HEADER VÁLIDO\n// ========================================================================== */\n.app-header {\n  background: var(--card-background);\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-lg);\n  box-shadow: 0 15px 45px rgba(15, 23, 42, 0.05);\n  width: 100%;\n  max-width: calc(100% - 2rem);\n  box-sizing: border-box;\n\n  /* 🔹 Removido o sticky para que role junto */\n  position: static;\n  top: auto;\n  z-index: auto;\n\n  /* 🔹 Mantém espaçamento coerente com main */\n  margin: 1rem auto 0;\n  padding: 0;\n}\n\n/* 🔹 Mantém a formatação interna */\n.header-content {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n  padding: 1.25rem 1.25rem;\n  box-sizing: border-box;\n  width: 100%;\n}\n\n.header-inner {\n  width: 100%;\n  padding: 1.25rem 1.75rem;\n  display: flex;\n  align-items: center;\n  justify-content: space-between; /* garante o botão à direita */\n  gap: 0.5rem;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n}\n\n.header-right {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    justify-content: flex-end;\n}\n\n/* Botões do header */\n.quick-action {\n  background: var(--primary-color);\n  color: var(--card-background);\n  border: none;\n  border-radius: 50%;\n  width: 44px;\n  height: 44px;\n  font-size: 1.2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.quick-action:hover {\n  background: color-mix(in srgb, var(--primary-color) 85%, black 15%);\n}\n\n.quick-action i,\n.back-chip i { pointer-events: none; }\n\n/* Botão \"Listar animais\" dentro do header */\n.app-header .quick-action#open-animals-popup,\n#open-animals-popup {\n  position: static !important; /* remove qualquer flutuar legado */\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--background-soft);\n  border: 1px solid var(--border-color);\n  color: var(--primary-color);\n  padding: 6px 12px;\n  border-radius: var(--radius-sm);\n  font-size: 1rem;\n  transition: background 0.2s ease, color 0.2s ease, border 0.2s ease, transform 120ms ease;\n  cursor: pointer;\n}\n.app-header .quick-action#open-animals-popup:hover,\n#open-animals-popup:hover {\n  background-color: var(--primary-color);\n  color: var(--card-background);\n  border-color: var(--primary-color);\n  transform: translateY(-1px);\n}\n\n\n/* Título e foto do animal */\n\n.animal-header {\n  display: flex;\n  align-items: center;\n  gap: 1.25rem;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.animal-photo-wrapper {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.animal-photo {\n  width: 96px;\n  height: 96px;\n  border-radius: 16px;\n  object-fit: cover;\n  border: 4px solid var(--background-soft);\n  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);\n  cursor: pointer;\n  transition: transform 120ms ease;\n}\n.animal-photo:hover { transform: translateY(-1px); }\n\n.animal-title {\n  display: flex;\n  flex-direction: column;\n  gap: 0.4rem;\n}\n.animal-title h1 {\n  font-family: 'GoodDog', 'Inter', sans-serif;\n  font-size: 2.8rem;\n  font-weight: bold;\n  letter-spacing: 0.02em;\n  color: var(--primary-color);\n  margin: 0;\n  line-height: 1.1;\n}\n.animal-subline {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n}\n\n.tag {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.35rem;\n    font-size: 0.75rem;\n    font-weight: 600;\n    padding: 0.35rem 0.7rem;\n    border-radius: 999px;\n    background: rgba(15, 118, 110, 0.12);\n    color: #0f766e;\n}\n\n.status-icon-row {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.6rem;\n    margin-top: 0.4rem;\n}\n.status-icon-row .img-button-wrapper {\n    width: 40px;\n    height: 40px;\n    background: var(--card-background);\n    border: 1px solid var(--border-color);\n    color: var(--text-light);\n}\n.status-icon-row .img-button-wrapper:hover {\n    border-color: rgba(255, 102, 0, 0.35);\n    box-shadow: 0 8px 18px rgba(255, 102, 0, 0.12);\n}\n.status-icon-row .img-button-wrapper i { color: inherit; }\n\n/* ==========================================================================\n// 5. MAIN / GRID / CARDS\n// ========================================================================== */\nmain {\n    flex: 1;\n    width: 100%;\n    max-width: calc(100% - 3rem);\n    //margin: 0 0 0;\n    padding: 1rem 1rem 1rem;\n    //margin-top: 0px;\n}\n\n.content-grid {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    width: 100%;\n}\n\n.identity-section {\n    display: flex;\n    flex-direction: column;\n    gap: 1.75rem;\n}\n\n.card {\n    background: var(--card-background);\n    border-radius: var(--radius-lg);\n    border: 1px solid var(--border-color);\n    box-shadow: 0 15px 45px rgba(15, 23, 42, 0.05);\n    padding: 1.5rem 1.75rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1.1rem;\n}\n.tab-container.card { padding: 0; gap: 0; }\n\n.card header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 0.75rem;\n}\n.card header h2 {\n    margin: 0;\n    font-size: 1.05rem;\n    letter-spacing: -0.01em;\n    color: var(--text-dark);\n}\n\n.info-grid {\n    display: grid;\n    gap: 1rem;\n    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n}\n.info-field {\n    background: rgba(255, 255, 255, 0.8);\n    border-radius: var(--radius-md);\n    border: 1px solid var(--border-color);\n    padding: 0.75rem 0.9rem;\n    display: flex;\n    flex-direction: column;\n    gap: 0.35rem;\n}\n.info-field__label {\n    font-size: 0.72rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    color: var(--text-light);\n    font-weight: 600;\n}\n.info-field__value {\n    font-size: 0.95rem;\n    font-weight: 600;\n    color: var(--text-dark);\n}\n\n/* ==========================================================================\n// 6. TABELAS\n// ========================================================================== */\n.table-card {\n    border: 1px solid var(--border-color);\n    border-radius: var(--radius-md);\n    padding: 1rem;\n    background: var(--card-background);\n    overflow: auto;\n}\n\ntable {\n    border-collapse: collapse;\n    width: 100%;\n    min-width: 520px;\n}\nth, td {\n    text-align: left;\n    padding: 0.65rem 0.75rem;\n    font-size: 0.88rem;\n    color: var(--text-dark);\n}\nth {\n    position: sticky;\n    top: 0;\n    background: var(--background-soft, #f5f6fb);\n    z-index: 1;\n    text-transform: uppercase;\n    font-size: 0.72rem;\n    letter-spacing: 0.08em;\n    color: var(--text-light);\n}\ntbody tr {\n    border-bottom: 1px solid var(--border-color);\n    transition: background 120ms ease;\n}\ntbody tr:hover { background: rgba(255, 102, 0, 0.05); }\n\n.table-col-long { min-width: 220px; }\n\n/* ==========================================================================\n// 7. SCROLL / FOCUS / MISC\n// ========================================================================== */\n.main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    gap: 5px;\n    padding: 5px;\n    box-sizing: border-box;\n    height: calc(100% - 60px);\n}\n\n/* Ícones e foco */\ni { color: inherit; }\nbutton:focus { outline: none !important; box-shadow: none !important; }\n\n/* Scrollbar (Webkit) */\n.details-container::-webkit-scrollbar,\n.tab-content::-webkit-scrollbar { width: 8px; }\n.details-container::-webkit-scrollbar-track,\n.tab-content::-webkit-scrollbar-track {\n    background: var(--background-light);\n    border-radius: 4px;\n}\n.details-container::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 4px;\n    border: 4px solid var(--background-light);\n    background-clip: padding-box;\n    width: 14px;\n}\n.tab-content::-webkit-scrollbar-thumb {\n    background-color: var(--text-faded);\n    border-radius: 4px;\n}\n.tab-content::-webkit-scrollbar-thumb:hover { background-color: var(--primary-color); }\n\n/* Scrollbar Firefox */\n.details-container, .tab-content {\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-color) var(--background-light);\n}\n.tab-content { \n  scrollbar-color: var(--text-faded) var(--background-light); \n  padding-top: 10px !important;\n  padding-bottom: 24px !important;\n}\n\n/* ==========================================================================\n// 8. DETALHES DO ANIMAL (FRAME)\n// ========================================================================== */\n.animal-details-frame {\n    background-color: var(--card-background);\n    border-radius: 10px;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);\n    width: 380px;\n    display: flex;\n    flex-direction: column;\n    flex-shrink: 0;\n    height: 100%;\n    overflow: hidden;\n    position: relative;\n}\n.content-wrapper {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    gap: 5px;\n    padding: 20px;\n    flex-shrink: 0;\n    position: relative;\n}\n.animal-photo-container {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.text-content {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    flex: 1;\n    height: auto;\n    gap: 0.75rem;\n}\n\n.details-container {\n    overflow-y: auto;\n    flex: 1;\n    padding: 0 10px 10px 10px;\n}\n.details-grid {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n    width: 100%;\n    text-align: left;\n}\n.detail-item {\n    background-color: transparent;\n    padding: 12px 15px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    border-bottom: 1px solid var(--border-color);\n    border-radius: 0;\n}\n.detail-item strong { font-size: 0.75rem; color: var(--text-dark); }\n.characteristic-box { background-color: transparent; color: var(--text-light); font-size: 0.8rem; font-weight: 500; }\n\n/* Botão de Retorno (Back Button) */\n.back-button {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    background-color: var(--background-light);\n    border: none;\n    color: var(--primary-color);\n    padding: var(--button-padding);\n    border-radius: var(--button-border-radius);\n    text-decoration: none;\n    font-size: 0.8rem;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n    font-weight: 500;\n}\n.back-button:hover { background-color: var(--primary-color); color: var(--card-background); }\n\n/* ==========================================================================\n// 9. TABS — ESTILO COM BASE NA COR SECUNDÁRIA\n// ========================================================================== */\n.tab-nav {\n    display: flex;\n    gap: 0.75rem;\n    flex-wrap: wrap;\n    padding: 0 1.75rem 0;\n    margin: 0;\n}\n\n.tab-btn {\n    border: none;\n    background: transparent;\n    padding: 0.6rem 0.9rem;\n    border-radius: var(--radius-md);\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-weight: 600;\n    color: var(--text-light);\n    cursor: pointer;\n    transition: color 120ms ease, background 120ms ease, transform 120ms ease;\n}\n\n/* Hover e ativo com base na cor secundária */\n.tab-btn:hover {\n    color: var(--primary-color);\n    background: var(--card-background);\n    transform: translateY(-1px);\n}\n\n.tab-btn.active {\n    background: var(--primary-color);\n    color: #ffffff;\n    box-shadow: 0 10px 30px rgba(90, 93, 127, 0.28);\n}\n\n.tab-btn.active:hover i { color: #ffffff; }\n\n\n/* Conteúdo */\n.tab-content-area { padding: 0 1.75rem 1.75rem; }\n.tab-content { display: none; flex-direction: column; gap: 10px; }\n.tab-content.active { display: flex; }\n\n/* Toolbar “Novo” (sticky) */\n.new-button-fixed {\n    position: sticky;\n    top: auto;\n    bottom: 0;\n    z-index: 10;\n    background: var(--card-background);\n    min-height: var(--tab-toolbar-h);\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    border-top: none !important;\n    box-shadow: none !important;\n}\n/* ==========================================================================\n// BOTÃO \"NOVO\" - estilo harmonizado com o restante do app\n// ========================================================================== */\n.new-button-fixed .action-button {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--card-background);\n  color: var(--primary-color);\n  font-weight: 600;\n  border: none;\n  border-radius: var(--radius-sm);\n  padding: 0.6rem 0.6rem;\n  font-size: 0.9rem;\n  cursor: pointer;\n  box-shadow: 0 8px 18px rgba(90, 93, 127, 0.18);\n  transition: all 0.2s ease;\n}\n\n.new-button-fixed .action-button:hover {\n  background-color: var(--primary-color);\n  color: var(--card-background);\n  transform: translateY(-1px);\n}\n\n.new-button-fixed .action-button i {\n  font-size: 1rem;\n  line-height: 1;\n  color: inherit;\n}\n\n.tab-content, .tab-content-area {\n  padding-bottom: max(12px, env(safe-area-inset-bottom)) !important;\n}\n.tab-table-wrapper, .chart-container { margin-bottom: 6px !important; }\n.new-button-fixed::before, .new-button-fixed::after { content: none !important; }\n\n/* Ajuste de Offset para Guias Sem Toolbar */\n#tab-resumo { padding-top: 20px !important; }\n#tab-qualquer-guia-sem-toolbar .tab-table thead { top: 0; }\n\n/* ==========================================================================\n// 10. TABELAS (TABS)\n// ========================================================================== */\n.tab-table-wrapper {\n    flex: 1;\n    min-height: 0;\n    overflow-y: auto;\n    position: relative;\n}\n.tab-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n    margin-top: 0;\n}\n.tab-table thead {\n    position: sticky;\n    top: var(--tab-header-offset);\n    z-index: 5;\n    background: var(--background-light);\n}\n/* Arredonda os cantos superiores das tabelas */\n.tab-table thead th:first-child {\n  border-top-left-radius: var(--radius-md);\n}\n.tab-table thead th:last-child {\n  border-top-right-radius: var(--radius-md);\n}\n\n/* Garante que o fundo e o raio se apliquem corretamente */\n.tab-table thead th {\n  background: var(--background-light);\n  overflow: hidden;\n}\n\n/* Opcional: suaviza a linha inferior do cabeçalho */\n.tab-table thead tr {\n  border-radius: var(--radius-md) var(--radius-md) 0 0;\n  overflow: hidden;\n}\n.tab-table thead th::after {\n    content: \"\";\n    position: absolute;\n    left: 0; right: 0; bottom: -1px;\n    height: 1px;\n    background: var(--border-color);\n}\n.tab-table th, .tab-table td {\n    padding: 12px 15px;\n    text-align: left;\n    border-bottom: 1px solid var(--border-color);\n    vertical-align: top; /* texto longo fica coerente */\n}\n.tab-table thead th {\n    position: sticky;\n    top: 0;\n    z-index: 4;\n    background-color: var(--background-light);\n    font-weight: 600;\n    color: var(--primary-color);\n}\n.tab-table td { color: var(--text-light); }\n.tab-table tbody tr:hover { background-color: rgba(90, 93, 127, 0.03); }\n\n/* Coluna de Ações */\n.action-cell {\n    vertical-align: middle;\n    text-align: center;\n    padding: 12px 0 !important;\n    min-width: 44px;\n    width: 44px;\n    box-sizing: border-box;\n}\n.action-cell .icon-button {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 28px;\n    height: 28px;\n    padding: 0;\n}\n.action-cell .icon-button i { line-height: 1; }\n.tab-table thead th:last-child {\n    width: 44px; text-align: center;\n}\n\nth.table-col-long, td.table-col-long {\n    width: 60%;\n    max-width: 60%;\n    white-space: normal;\n    word-break: break-word;\n    overflow-wrap: anywhere;\n}\n#tab-tratamentos th.table-col-long,\n#tab-tratamentos td.table-col-long {\n    width: clamp(20%, 30%, 40%);\n    min-width: 20%;\n    max-width: 40%;\n    white-space: nowrap;\n    word-break: normal;\n    overflow-wrap: normal;\n}\n\n/* ==========================================================================\n// 11. RESUMO E TIMELINE\n// ========================================================================== */\n.timeline-container { padding: 20px; }\n.timeline-header {\n    display: flex; align-items: center; gap: 15px;\n    margin-bottom: 15px; padding: 0 15px;\n}\n.timeline-column-title { flex: 1; font-weight: 600; color: var(--primary-color); text-align: center; }\n.timeline-column-title.date-column { min-width: 100px; text-align: left; }\n.timeline-grid { display: flex; flex-direction: column; gap: 8px; }\n.timeline-item {\n    background-color: var(--background-light);\n    padding: 10px 15px;\n    border-radius: 8px;\n    display: flex; align-items: center; gap: 15px;\n}\n.timeline-item strong { min-width: 100px; color: var(--text-dark); font-weight: 500; }\n.timeline-box {\n    flex: 1;\n    background-color: var(--card-background);\n    color: var(--text-light);\n    padding: 6px 10px;\n    border-radius: 6px;\n    font-weight: 500;\n    text-align: center;\n    white-space: nowrap;\n    overflow: hidden; text-overflow: ellipsis;\n}\n\n/* Seções de Resumo */\n.resume-sections { display: flex; flex-direction: column; gap: 16px; padding: 10px; }\n.resume-section { display: flex; flex-direction: column; gap: 8px; }\n.resume-title {\n    color: var(--primary-color); font-weight: 600; margin: 0 0 4px 0;\n    font-size: 0.8rem; letter-spacing: 0.02em;\n}\n.resume-card {\n    background-color: var(--background-soft);\n    border-radius: var(--radius-md);\n    padding: 1.1rem 1.25rem;\n    border: 1px solid var(--border-color);\n    box-shadow: none;\n    display: flex; flex-direction: column; gap: 12px;\n}\n.resume-action-item { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }\n.resume-action-icon {\n    width: 42px;\n    height: 42px;\n    border-radius: var(--radius-md);\n    background-color: var(--card-background);\n    border: 1px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--primary-color);\n    font-size: 1.1rem;\n    flex-shrink: 0;\n    position: relative;\n    cursor: pointer;\n    transition: background 120ms ease, color 120ms ease, border 120ms ease, box-shadow 120ms ease;\n}\n\n.resume-action-icon:hover {\n    color: var(--card-background);\n    background-color: var(--primary-color);\n    border-color: var(--primary-color);\n    box-shadow: 0 8px 18px rgba(90, 93, 127, 0.25);\n}\n.resume-action-icon:hover i { color: inherit; }\n.resume-action-icon .resume-action-tooltip {\n    visibility: hidden; opacity: 0;\n    position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);\n    padding: 6px 12px; background-color: var(--primary-color); color: var(--card-background);\n    border-radius: 6px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; pointer-events: none;\n    transition: opacity 0.2s ease; z-index: 2;\n}\n.resume-action-icon .resume-action-tooltip::after {\n    content: \"\"; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);\n    border-width: 6px; border-style: solid;\n    border-color: var(--primary-color) transparent transparent transparent;\n}\n.resume-action-icon:hover .resume-action-tooltip { visibility: visible; opacity: 1; }\n\n.resume-empty-message {\n    display: none; padding: 18px; border-radius: 12px;\n    background-color: var(--card-background);\n    border: 1px solid rgba(90, 93, 127, 0.08);\n    color: var(--text-light); font-size: 0.75rem; text-align: center;\n}\n.resume-sections.resume-empty .resume-empty-message { display: block; }\n.resume-sections.resume-empty .resume-section:not(.resume-actions) { display: none; }\n\n.resume-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }\n\n.resume-item { \n  display: flex; \n  flex-direction: column; \n  align-items: flex-start; \n  gap: 6px; padding: 0; \n  border-radius: 0; \n  border: none; \n  background: none; \n}\n\n.resume-label {\n    font-size: 0.6rem; color: var(--text-light);\n    text-transform: uppercase; letter-spacing: 0.04em; font-weight: 600;\n}\n\n.resume-value {\n    display: block; width: 100%;\n    font-size: 0.75rem; font-weight: 600; color: var(--text-dark);\n    background-color: var(--card-background);\n    border-radius: 10px; padding: 10px 14px; box-sizing: border-box; word-break: break-word;\n}\n\n.content-section { margin-bottom: 20px; }\n.content-section h3 { color: var(--primary-color); margin-bottom: 10px; }\n.content-section p { color: var(--text-light); line-height: 1.6; }\n\n/* Gráficos */\n.chart-container {\n    position: relative;\n    width: 100%;\n    max-height: 500px;\n    margin-top: 2rem;\n    display: flex; justify-content: center; align-items: center;\n}\n\n/* ==========================================================================\n// 12. BOTÕES E COMPONENTES DE INTERAÇÃO\n// ========================================================================== */\n.detail-button,\n.animals-list-button,\n.animals-filter-button {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    background-color: var(--background-soft);\n    border: 1px solid transparent;\n    border-radius: var(--radius-sm);\n    padding: 0.5rem 0.75rem;\n    font-weight: 600;\n    font-size: 0.9rem;\n    color: var(--text-dark);\n    transition: background 120ms ease, color 120ms ease, transform 120ms ease, border 120ms ease;\n    cursor: pointer;\n}\n.detail-button:hover,\n.animals-list-button:hover,\n.animals-filter-button:hover,\n.animals-filter-button.active {\n    background-color: var(--primary-color);\n    color: var(--card-background);\n    border-color: var(--primary-color);\n    transform: translateY(-1px);\n}\n/* Ajuste: botões da lista de animais ocupam linha inteira */\n.animals-list-button {\n    display: flex;           /* substitui inline-flex */\n    width: 100%;             /* ocupa toda a largura */\n    justify-content: flex-start; /* texto alinhado à esquerda */\n    box-sizing: border-box;\n    margin-bottom: 6px;      /* espaçamento entre os botões */\n    text-align: left;\n}\n\n/* Mantém o efeito de hover, mas ajustado ao novo layout */\n.animals-list-button:hover {\n    background-color: var(--primary-color);\n    color: var(--card-background);\n    border-color: var(--primary-color);\n    transform: translateY(-1px);\n}\n\n/* Botões de ícone / lixeira / status */\n.icon-button { background: none; border: none; cursor: pointer; font-size: 1rem; color: var(--text-dark); }\n.icon-button:not(.delete-button):hover { color: var(--primary-color); }\n.icon-button i {\n    vertical-align: middle;\n    font-size: 1.1rem;\n    transition: color 0.2s ease;\n    display: flex; align-items: center; justify-content: center;\n    line-height: 1; height: 100%;\n    padding: 0; border: none; background: none; cursor: pointer; color: var(--text-dark);\n}\n.icon-button i { pointer-events: none; }\n\n.icon-button.delete-button i { color: #bbb !important; font-size: 1.1rem; }\n.icon-button.delete-button:hover i { color: var(--warning-color) !important; }\n\n.status-concluido i, .status-programado i, .status-atrasado i { font-size: 1rem; color: #999; }\n.icon-button.status-concluido:hover i { color: #3CCB5A; }\n.icon-button.status-programado:hover i { color: #4A90E2; }\n.icon-button.status-atrasado:hover i { color: #E25B4A; }\n\n/* Botões de imagem com tooltip */\n.img-button-wrapper {\n    position: relative; display: flex; align-items: center; justify-content: center;\n    width: 32px; height: 32px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n    transition: all 0.2s ease; cursor: default;\n}\n.img-button { width: 24px; height: 24px; object-fit: contain; }\n.img-button-wrapper .tooltip {\n    visibility: hidden; width: max-content; background-color: var(--primary-color); color: var(--card-background);\n    text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1;\n    bottom: 150%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-size: 0.75rem; white-space: nowrap;\n}\n.img-button-wrapper .tooltip::after {\n    content: \"\"; position: absolute; top: 100%; left: 50%; margin-left: -5px;\n    border-width: 5px; border-style: solid; border-color: var(--primary-color) transparent transparent transparent;\n}\n.img-button-wrapper:hover .tooltip { visibility: visible; opacity: 1; }\n\n/* ==========================================================================\n// 13. POP-UPS E OVERLAYS\n// ========================================================================== */\n/* ==========================================================================\n// 13. POP-UPS E OVERLAYS — CORRIGIDO PARA COBRIR O HEADER\n// ========================================================================== */\n.overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.55);\n    backdrop-filter: blur(4px);\n    display: none;\n    z-index: 150; /* 🔹 agora cobre o header (z-index: 50) */\n}\n\n.pop-up-menu,\n.pop-up-animais {\n    width: min(90vw, 450px);\n    height: max(80vh); /* 🔹 sempre 80% da altura visível */\n    display: none;\n    flex-direction: column;\n    gap: 10px;\n    overflow: hidden;\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background-color: var(--card-background);\n    border-radius: var(--radius-lg);\n    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.25);\n    z-index: 200;\n}\n/* ==========================================================================\n// POPUP DE NASCIMENTO — ESTILO COMPLETO E CORRIGIDO\n// ========================================================================== */\n\n.pop-up-menu h2 {\n  margin: 20px 0 10px 0;\n  font-size: 1rem;\n  color: var(--primary-color);\n  text-align: center;\n}\n\n#pop-up-nascimento {\n  display: none;               /* 👈 começa fechado */\n  width: 300px;\n  height: auto;\n  max-height: none;\n  overflow: visible;\n  padding: 24px 20px;\n  box-sizing: border-box;\n  border-radius: 18px;\n  background: var(--card-background);\n  gap: 12px;\n  justify-content: center;\n  align-items: stretch;\n}\n\n/* título */\n#pop-up-nascimento h2 {\n  margin: 0 0 14px 0;\n  font-size: 1rem;\n  color: var(--primary-color);\n  text-align: center;\n}\n\n/* container do input — corta o que passar */\n#pop-up-nascimento .pop-up-options-container {\n  width: 100%;\n  box-sizing: border-box;\n  overflow: hidden;           /* 👈 se o navegador pintar 1px a mais, some */\n  border-radius: 12px;\n  padding: 0;\n}\n\n/* input de data — 2px menor que o container */\n#pop-up-nascimento .date-input {\n  width: calc(100% - 2px);    /* 👈 evita o transbordo */\n  max-width: calc(100% - 2px);\n  box-sizing: border-box;\n  padding: 8px 10px;\n  border: 1px solid var(--border-color);\n  border-radius: 12px;\n  background: var(--card-background);\n  font-size: 0.9rem;\n  appearance: none;\n  -webkit-appearance: none;\n}\n\n/* ícone do calendário */\n#pop-up-nascimento input[type=\"date\"]::-webkit-calendar-picker-indicator {\n  margin-right: 4px;\n  cursor: pointer;\n}\n\n/* botões */\n#pop-up-nascimento .pop-up-actions {\n  display: flex;\n  gap: 10px;\n  margin-top: 12px;\n  justify-content: center;\n}\n#pop-up-nascimento .pop-up-actions .detail-button {\n  flex: 1;\n  max-width: 110px;\n}\n\n.animals-filters {\n    display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 5px 0 10px 0;\n}\n.animals-list-container {\n    flex: 1;\n    overflow-y: auto;\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    background-color: var(--card-background);\n    min-height: 0; /* 🔹 evita estourar o container */\n    margin: 0 20px 20px 20px;\n}\n.animals-list-placeholder, .animals-list-error {\n    text-align: center; color: var(--text-light); font-size: 0.9rem; margin: 10px 0;\n}\n.animals-list-error { color: var(--warning-color); }\n.pop-up-close { position: absolute; top: 5px; right: 10px; font-size: 1.2rem; cursor: pointer; color: var(--text-faded); }\n\n/* Opções de Pop-up */\n.pop-up-options-container {\n    display: flex; \n    flex-direction: column; \n    gap: 5px; \n    margin: 20px;\n}\n.pop-up-option {\n    padding: 8px 12px; background-color: var(--background-light); border-radius: 6px;\n    cursor: pointer; transition: all 0.2s ease; font-weight: 500; font-size: 0.8rem;\n}\n.pop-up-option:hover, .pop-up-option.selected {\n    background-color: var(--primary-color); color: var(--card-background);\n}\n\n/* Input de data */\n.date-input {\n    padding: 10px 15px; border-radius: 6px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; font-size: 14px;\n}\n\n/* Ações do pop-up */\n.pop-up-actions {\n    display: flex; justify-content: center; gap: 15px; margin-top: 10px; flex-wrap: wrap;\n}\n.pop-up-actions .confirm-button,\n.pop-up-actions .cancel-button,\n.pop-up-actions .delete-button,\n.popup-button {\n    padding: var(--button-padding);\n    font-size: var(--button-font-size);\n    border-radius: var(--button-border-radius);\n    border: none; cursor: pointer; flex: 1; max-width: 120px;\n}\n.pop-up-actions .confirm-button {\n    background-color: #4CAF50; color: var(--card-background);\n}\n.pop-up-actions .cancel-button {\n    background-color: var(--background-light); color: var(--primary-color);\n    transition: all 0.2s ease; border: none;\n}\n.pop-up-actions .cancel-button:hover {\n    background-color: var(--primary-color); color: var(--card-background);\n}\n.pop-up-actions .delete-button {\n    background-color: var(--card-background); color: var(--warning-color); border: 1px solid var(--warning-color);\n    transition: all 0.2s ease;\n}\n.pop-up-actions .delete-button:hover { background-color: var(--warning-color); color: var(--card-background); }\n.small-pop-up { min-height: auto; padding: 16px; gap: 12px; flex-direction: column; justify-content: flex-start; }\n.small-pop-up h2 { font-size: 16px; margin-bottom: 12px; }\n.pop-up-content { margin-bottom: 16px; }\n.popup-button { background-color: #f0f0f0; border: 1px solid #ccc; transition: background 0.2s; }\n.popup-button:hover { background-color: #e0e0e0; }\n\n/* Alert */\n.alert-popup {\n    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);\n    background-color: var(--card-background); color: var(--text-dark);\n    padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    display: flex; align-items: center; opacity: 0; visibility: hidden;\n    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;\n    z-index: 1000; min-width: 250px;\n}\n.alert-popup.success, .alert-popup.error { color: var(--primary-color); }\n.alert-popup.show { opacity: 1; visibility: visible; }\n.alert-icon { font-size: 12px; font-weight: 400; }\n\n/* Form dentro do pop-up */\n.pop-up-menu label {\n    display: block; font-size: 0.8rem; font-weight: 600; color: var(--text-dark); margin-bottom: 2px;\n}\n.pop-up-menu .date-input, .pop-up-menu textarea, .pop-up-menu select {\n    margin-top: 2px; margin-bottom: 8px;\n}\n\n/* Tratamento: sobrescritas */\n#pop-up-tratamento label { font-size: 0.78rem; color: var(--primary-color); font-weight: 600; }\n#tratamento-fracao { transform: translateY(2px); }\n#tratamento-dias-wrapper { display: none; }\n#tratamento-dose-wrapper {\n    border: none !important; background: transparent !important;\n    padding: 0; margin: 0; display: flex; align-items: center;\n}\n#tratamento-dose-wrapper input, #tratamento-dose-wrapper select {\n    border-radius: 8px; width: 100%;\n}\n\n/* ==========================================================================\n// 14. CONDIÇÕES OBSERVADAS (DENTRO DA AVALIAÇÃO)\n// ========================================================================== */\n.condicoes-container {\n  display: flex; flex-direction: row; align-items: center; flex-wrap: wrap;\n  gap: 4px; border: 1px solid var(--border-color); border-radius: 6px;\n  padding: 4px 6px; min-height: 32px; background-color: var(--card-background);\n  position: relative;\n}\n.condicoes-container-inner {\n  display: flex; flex-wrap: wrap; gap: 4px; align-items: center; flex: 1;\n}\n#add-condicao-button {\n  flex-shrink: 0; margin-left: auto; font-size: 1rem; color: var(--primary-color);\n  background: none; border: none; cursor: pointer; transition: color 0.2s ease;\n}\n#add-condicao-button:hover { color: var(--primary-color); }\n.condicao-badge { margin: 2px; padding: 5px 8px; border-radius: 6px; font-size: 0.82rem; }\n.condicao-badge:hover { transform: scale(1.03); }\n.condicao-badge i { cursor: pointer; opacity: 0.8; transition: opacity 0.2s; }\n.condicao-badge i:hover { opacity: 1; }\n#parametros-list { padding-right: 8px; }\n.parametro-ativo { background-color: var(--primary-color); color: var(--card-background); }\n.condicao-item {\n    border-radius: 6px; margin-bottom: 4px; padding: 6px 8px; cursor: pointer; font-size: 0.85rem;\n    transition: background-color 0.2s ease, transform 0.1s ease;\n}\n.condicao-item:hover { transform: translateX(2px); }\n\n/* ==========================================================================\n// 15. MENSAGEM DE LISTA VAZIA / SEM ITENS\n// ========================================================================== */\n.empty-message, .no-data-message, .no-items-message, .animals-list-placeholder {\n    color: var(--primary-color);\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-align: center;\n    margin: 40px 0 40px 0;\n}\n\n/* ==========================================================================\n// 16. RESPONSIVIDADE\n// ========================================================================== */\n@media (max-width: 768px) {\n    .timeline-header { display: none; }\n    .timeline-item { flex-direction: column; align-items: stretch; gap: 8px; }\n    .timeline-item strong {\n        min-width: auto; text-align: center; background-color: var(--primary-color);\n        color: var(--card-background); padding: 6px 10px; border-radius: 6px;\n    }\n    .timeline-box { text-align: left; }\n    .resume-list { grid-template-columns: 1fr; }\n    .tab-btn { min-width: 70px; padding: 12px 12px; font-size: 0.8rem; }\n    .tab-content { padding: 10px; }\n}\n@media (max-width: 480px) {\n    .main-content { flex-direction: column; }\n    .animal-details-frame { width: 100%; height: auto; }\n    .content-wrapper, .text-content { height: auto; }\n    .pop-up-menu { width: 85%; }\n    .tab-btn { min-width: 60px; padding: 10px 12px; font-size: 0.75rem; }\n    .tab-content { padding: 10px; }\n}\n@media (max-width: 720px) {\n  .animal-title h1 {\n    font-size: 1.9rem;\n  }\n}\n/* ============================================================\n   ESTILO UNIFICADO DE CHIPS / TAGS / CÁPSULAS — COR SECUNDÁRIA\n   ============================================================ */\n.chip {\n  appearance: none;\n  border: none;\n  outline: none;\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  border-radius: 12px;\n  font-size: 0.8rem;\n  font-weight: 600;\n  letter-spacing: 0.01em;\n  padding: 0.6rem 0.7rem;\n  line-height: 1;\n  cursor: default;\n  transition: all 0.2s ease;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  white-space: nowrap;\n}\n\n/* Estado neutro (valor indefinido) */\n.chip.is-empty {\n  background: var(--primary-soft);\n  color: var(--text-light);\n}\n\n/* ============================================================\n   CHIPS DE AÇÃO — estilo destacado\n   ============================================================ */\n.chip.is-action {\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  cursor: pointer;\n  border: 1px !important;\n  border-color: var(--primary-color) !important;\n}\n\n.chip.is-action:hover {\n  background: var(--primary-color);\n  color: #FFF;\n  transform: translateY(-1px);\n}\n\n/* Containers */\n.identity-chips {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  margin-top: 0.6rem;\n}\n\n.animal-subline {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.4rem;\n  margin-top: 0.4rem;\n}\n\n/* Responsividade */\n@media (max-width: 720px) {\n  .chip {\n    font-size: 0.72rem;\n    padding: 0.4rem 0.8rem;\n  }\n  .animal-subline, .identity-chips { gap: 0.35rem; }\n}\n\n/* ============================================================\n   SIDEBAR LAYOUT\n   ============================================================ */\n.sidebar {\n  position: fixed;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 240px;\n  background-color: var(--card-background);\n  border-right: 1px solid var(--border-color);\n  box-shadow: 4px 0 12px rgba(15, 23, 42, 0.05);\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  z-index: 100;\n  transition: width 0.25s ease;\n}\n\n.sidebar.collapsed {\n  width: 72px;\n}\n\n.sidebar-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 12px 16px;\n}\n\n.sidebar-logo {\n  height: 32px;\n  transition: opacity 0.25s ease;\n}\n\n.sidebar.collapsed .sidebar-logo {\n  opacity: 0;\n  visibility: hidden;\n}\n\n.sidebar-toggle {\n  background: none;\n  border: none;\n  color: var(--primary-color);\n  font-size: 1.2rem;\n  cursor: pointer;\n  transition: color 0.2s ease;\n}\n\n.sidebar-toggle:hover {\n  color: var(--primary-color);\n}\n\n/* Itens de menu */\n.sidebar-menu, .sidebar-footer {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  padding: 12px 12px;\n}\n\n.sidebar-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  background: transparent;\n  border: none;\n  color: var(--text-light);\n  font-size: 0.95rem;\n  font-weight: 500;\n  padding: 10px 14px;\n  border-radius: var(--radius-md);\n  cursor: pointer;\n  text-align: left;\n  transition: background 0.2s, color 0.2s, transform 0.15s;\n}\n\n.sidebar-item i {\n  font-size: 1.1rem;\n  min-width: 20px;\n  text-align: center;\n}\n\n.sidebar-item:hover {\n  background: var(--primary-soft);\n  color: var(--primary-color);\n  transform: translateY(-1px);\n}\n\n.sidebar-item.active {\n  background: var(--primary-color);\n  color: #fff;\n  box-shadow: 0 6px 16px rgba(90,93,127,0.25);\n}\n\n.sidebar.collapsed .sidebar-item span {\n  display: none;\n}\n\n/* Rodapé */\n.sidebar-footer {\n  border-top: 1px solid var(--border-color);\n  padding-top: 8px;\n  margin-top: auto;\n}\n\n/* Ajuste de conteúdo principal */\n.main-with-sidebar {\n  margin-left: 240px;\n  transition: margin-left 0.25s ease;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n}\n\n.main-with-sidebar.expanded {\n  margin-left: 72px;\n}\n\n/* Adaptação de header e main para o novo contexto */\n//.app-header, main {  max-width: calc(1280px - 240px);}\n\n.sidebar.collapsed + .main-with-sidebar .app-header,\n.sidebar.collapsed + .main-with-sidebar main {\n  //max-width: calc(1280px - 72px);\n}\n.no-results {\n  text-align: center;\n  color: var(--text-light);\n  font-size: 1rem;\n  margin-top: 4rem;        /* 🔹 afastamento do topo */\n  line-height: 1.5;\n  background: transparent; /* mantém fundo neutro */\n}\n</style>\n`;\nreturn { style };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        -512
      ],
      "id": "2d8d174b-13d7-4c7a-bb66-b48ce78fccca",
      "name": "List Style"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "_n8n_animais_dados",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "canil",
              "condition": "eq",
              "keyValue": "={{ $('Vars').item.json.canil_id }}"
            },
            {
              "keyName": "status",
              "condition": "eq",
              "keyValue": "={{ $('Vars').item.json.status }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        208,
        -512
      ],
      "id": "577b992e-b108-484a-8013-959199b517ba",
      "name": "Get List",
      "notesInFlow": true,
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "vfFMnH1cZndqgot0",
          "name": "Viralatinhaz Supabase"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "animais",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "41527549-4ef2-43ea-9895-b20a065dac9c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "list"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "95c9f890-fb49-4199-b54d-ca5858f69160",
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "animal",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "details"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f3db4ef9-1d43-47ff-9827-098a460d19d4",
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "painel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "painel"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0d3a9ffe-9b1a-45de-a4e5-bb8ea4585edd",
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "historico",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "historico"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b46b5ed3-b3c1-4d61-befb-290176fb5a0b",
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "avaliacoes",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "avaliacoes"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a481344f-815f-498a-9d5d-97d27d2439eb",
                    "leftValue": "={{ $('Vars').item.json.pagina }}",
                    "rightValue": "tratamentos",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tratamentos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -704,
        -272
      ],
      "id": "29b3c49a-d791-4469-8439-bafdd2eb023e",
      "name": "Page",
      "notesInFlow": true
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "EWFne3J2f3OQzFT4",
          "mode": "list",
          "cachedResultUrl": "/workflow/EWFne3J2f3OQzFT4",
          "cachedResultName": "Kaniu Supabase Categories"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        -208,
        -256
      ],
      "id": "34fb8bf9-8ed1-4718-92d5-708acc44e5d0",
      "name": "Get Tables",
      "notesInFlow": true
    },
    {
      "parameters": {
        "jsCode": "// ===================================================\n// NÓ CODE (JavaScript) – n8n\n// LISTAGEM DE ANIMAIS PARA ADOÇÃO\n// Revisão e otimização sem alterar comportamento\n// ===================================================\n\n// ---------- VARIÁVEIS DE ENTRADA ----------\nconst animals = $input.first().json.animals;\nconst constants = $('Constants').item.json;\nconst vars = $('Vars').first().json;\nconst style = $('List Style').first().json.style;\nconst sidebar_html = $('Sidebar Html').first().json.html;\nconst sidebar_script = $('Sidebar Script').first().json.script;\n\n// ---------- VARIÁVEIS BASE ----------\nconst img_logo = constants.img_logo;\nconst fav_icon = constants.fav_icon;\nconst dog_font = constants.dog_font;\nconst webhook_url = vars.url;\nconst canil_id = vars.canil_id;\nconst APPLIED_STATUS = vars.query?.status || 'Abrigado';\nconst options_endpoint = '/webhook/kaniu-animal-data-tables';\n\n// ---------- FUNÇÕES AUXILIARES ----------\nconst normalizeAccents = (str = '') =>\n  str.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\nconst animalPhoto = (especie = 'Vazio') => ({\n  'Cachorro': 'https://i.ibb.co/Z6dPncCH/pic-dog.png',\n  'Gato': 'https://i.ibb.co/9dWLkZs/pic-cat.png',\n  'Vazio': 'https://i.ibb.co/KpVTx4vK/pic-none.png',\n}[especie] || 'https://i.ibb.co/KpVTx4vK/pic-none.png');\n\n// Função para checar por valores nulos ou 0\nconst formatValue = (value) => value === null || value === 0 || value === undefined ? '' : value;\n\n// ---------- RENDERIZAÇÃO DE CARDS ----------\nlet cardsHtml = '';\n\nif (Array.isArray(animals) && animals.length > 0) {\n  cardsHtml = animals.map(animal => {\n    const nome = normalizeAccents(animal.nome);\n    const foto = animal.foto || animalPhoto(animal.especie);\n\n    return `\n      <a href=\"${webhook_url}?animal_id=${animal.animal_id}\" class=\"animal-list-link\">\n        <header class=\"app-header\">\n          <div class=\"header-content\">\n            <div class=\"animal-header\">\n              <div class=\"animal-photo-wrapper\">\n                <input type=\"file\" id=\"animal-photo-upload-input\" class=\"animal-photo-input\" accept=\"image/*\" style=\"display: none;\" />\n                <img class=\"animal-photo\" id=\"animal-photo\"\n                     src=\"${animal.foto || animalPhoto(animal.especie)}\"\n                     alt=\"Foto de ${animal.nome}\" title=\"Clique para alterar a foto\" />\n              </div>\n        \n              <div class=\"animal-title\">\n                <h1>${animal.nome || ''}</h1>\n                <div class=\"animal-subline\">\n                  <button class=\"chip\" id=\"open-especie-menu\">${animal.especie || ':Espécie:'}</button>\n                  <button class=\"chip\" id=\"open-genero-menu\">${animal.sexo || ':Sexo:'}</button>\n                  <button class=\"chip\" id=\"open-porte-menu\">${animal.porte || ':Porte:'}</button>\n                  <button class=\"chip\" id=\"open-raca-menu\">${animal['raça'] || ':Raça:'}</button>\n                  <button class=\"chip\" id=\"open-pelagem-menu\">Pelo ${animal.pelagem || ':Pelagem:'}</button>\n                  <button class=\"chip\" id=\"open-cor-menu\">${animal.cor || ':Cor:'}</button>\n                  <button class=\"chip\" id=\"open-nascimento-menu\">\n                    ${animal.nascimento ? animal.nascimento : 'Definir nascimento'}\n                  </button>\n                  ${animal.faixa_etaria ? `<button class=\"chip\">${animal.faixa_etaria}</button>` : ''}\n                  ${formatValue(animal.peso) ? `<button class=\"chip\">${formatValue(animal.peso)} kg</button>` : ''}\n                </div>\n              </div>\n            </div>\n        \n            <!-- Botão de listar animais -->\n            <button class=\"quick-action\" id=\"open-animals-popup\" title=\"Listar animais\" aria-label=\"Listar animais\">\n              <i class=\"fa-solid fa-bars\"></i>\n            </button>\n          </div>\n        </header>\n\n      </a>\n    `;\n  }).join('');\n} else {\n  cardsHtml = `\n    <p class=\"no-results\">\n      Nenhum item encontrado.\n    </p>`;\n}\n\n// ---------- HTML FINAL ----------\nconst html = `\n<!DOCTYPE html>\n<html lang=\"pt-BR\">\n\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <link rel=\"icon\" type=\"image/png\" href=\"${fav_icon}\" />\n  <title>Animais para Adoção</title>\n  <!------------------------------------- Carregar fontes locais ------------------------------------->\n  <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/fontawesome.css\" rel=\"stylesheet\" />\n  <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/solid.css\" rel=\"stylesheet\" />\n</head>\n\n${style}\n\n<body>\n\n  <div class=\"app-shell\">\n  \n    <!-- Inclui a Sidebar -->\n    ${sidebar_html}\n    \n    <div class=\"main-with-sidebar\">\n      <main class=\"main-container\">\n        <header class=\"header\">\n          <div class=\"tab-nav\">\n            ${['Abrigado', 'Adotado', 'Internado', 'Desaparecido', 'Falecido']\n            .map(status => `\n            <button class=\"tab-btn ${APPLIED_STATUS === status ? 'active' : ''}\" data-status=\"${status}\">\n              ${status + 's'}\n            </button>\n            `).join('')}\n          </div>\n        </header>\n        <div class=\"list-container\">\n          ${cardsHtml}\n        </div>\n      </main>\n    </div>\n  </div>\n\n  <!-- Overlay (já segue padrão dos popups existentes) -->\n  <div id=\"overlay\" class=\"overlay\"></div>\n\n  <!-- POP-UP NOVO ANIMAL -->\n  <div id=\"pop-up-novo-animal\" class=\"pop-up-menu\" style=\"width: 480px; padding: 20px; display: none;\">\n    <span class=\"pop-up-close\" onclick=\"closeNovoAnimalPopup()\">&times;</span>\n    <h2>Novo Animal</h2>\n\n    <div class=\"pop-up-content\" style=\"display: flex; flex-direction: column; gap: 12px;\">\n\n      <!-- Nome + Data de Nascimento na mesma linha -->\n      <div style=\"display: grid; grid-template-columns: 2fr 1fr; gap: 8px;\">\n        <div>\n          <label>Nome</label>\n          <input type=\"text\" id=\"novo-animal-nome\" class=\"date-input\" placeholder=\"Digite o nome do animal\" />\n        </div>\n        <div>\n          <label>Data de Nascimento</label>\n          <input type=\"date\" id=\"novo-animal-nascimento\" class=\"date-input\" />\n        </div>\n      </div>\n\n      <!-- Espécie + Sexo -->\n      <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px;\">\n        <div>\n          <label>Espécie</label>\n          <select id=\"novo-animal-especie\" class=\"date-input\">\n            <option value=\"\">Carregando...</option>\n          </select>\n        </div>\n        <div>\n          <label>Raça</label>\n          <select id=\"novo-animal-raca\" class=\"date-input\">\n            <option value=\"\">Selecione a espécie primeiro</option>\n          </select>\n        </div>\n      </div>\n\n      <!-- Raça + Porte -->\n      <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px;\">\n        <div>\n          <label>Sexo</label>\n          <select id=\"novo-animal-sexo\" class=\"date-input\">\n            <option value=\"\">Carregando...</option>\n          </select>\n        </div>\n        <div>\n          <label>Porte</label>\n          <select id=\"novo-animal-porte\" class=\"date-input\">\n            <option value=\"\">Carregando...</option>\n          </select>\n        </div>\n      </div>\n\n      <!-- Cor + Pelagem -->\n      <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px;\">\n        <div>\n          <label>Cor</label>\n          <select id=\"novo-animal-cor\" class=\"date-input\">\n            <option value=\"\">Carregando...</option>\n          </select>\n        </div>\n        <div>\n          <label>Pelagem</label>\n          <select id=\"novo-animal-pelagem\" class=\"date-input\">\n            <option value=\"\">Carregando...</option>\n          </select>\n        </div>\n      </div>\n\n    </div>\n\n    <div class=\"pop-up-actions\" style=\"margin-top: 20px;\">\n      <button class=\"cancel-button\" onclick=\"closeNovoAnimalPopup()\">Cancelar</button>\n      <button class=\"action-button\" onclick=\"salvarNovoAnimal()\">Salvar</button>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      const ENDPOINT_URL = ${ JSON.stringify(webhook_url)\n    };\n    const DEFAULT_STATUS = 'Abrigado';\n    let currentStatus = ${ JSON.stringify(APPLIED_STATUS)};\n\n    const header = document.querySelector('.header');\n    const listContainer = document.querySelector('.list-container');\n    const statusButtons = document.querySelectorAll('.tab-btn');\n\n\n\n    // ---------- ATUALIZA BOTÕES ATIVOS ----------\n    const updateButtonStatus = () => {\n      statusButtons.forEach(btn => {\n        const isActive = btn.dataset.status === currentStatus;\n        btn.classList.toggle('active', isActive);\n      });\n    };\n    updateButtonStatus();\n\n    // ---------- HISTÓRICO ----------\n    if (!window.history.state || window.history.state.status !== currentStatus) {\n      window.history.replaceState({ status: currentStatus }, '', window.location.href);\n    }\n\n    // ---------- FUNÇÕES DE URL ----------\n    const buildUrlForStatus = (statusValue) => {\n      try {\n        const url = new URL(ENDPOINT_URL, window.location.origin);\n        url.searchParams.set('status', statusValue);\n        return url.toString();\n      } catch {\n        const sep = ENDPOINT_URL.includes('?') ? '&' : '?';\n        return ENDPOINT_URL + sep + 'status=' + encodeURIComponent(statusValue);\n      }\n    };\n\n    const updateUrl = (statusValue) => {\n      const url = new URL(window.location.href);\n      url.searchParams.set('status', statusValue);\n      window.history.pushState({ status: statusValue }, '', url.toString());\n    };\n\n    // ---------- RECARREGAR LISTA VIA FETCH ----------\n    const fetchAndRenderList = async (statusValue, { updateHistory = true } = {}) => {\n      const newUrl = buildUrlForStatus(statusValue);\n\n      if (!listContainer) {\n        window.location.href = newUrl;\n        return;\n      }\n\n      try {\n        const response = await fetch(newUrl, {\n          headers: { 'X-Requested-With': 'XMLHttpRequest' },\n          credentials: 'same-origin'\n        });\n\n        if (!response.ok) throw new Error('Erro ao carregar a lista.');\n\n        const htmlText = await response.text();\n        const doc = new DOMParser().parseFromString(htmlText, 'text/html');\n        const updatedList = doc.querySelector('.list-container');\n\n        if (!updatedList) throw new Error('Estrutura da lista não encontrada.');\n\n        listContainer.innerHTML = updatedList.innerHTML;\n        currentStatus = statusValue;\n        updateButtonStatus();\n\n        if (updateHistory) updateUrl(statusValue);\n      } catch (err) {\n        console.error(err);\n        window.location.href = newUrl;\n      }\n    };\n\n    window.refreshAnimalList = (statusValue, extraOptions = {}) => {\n      const statusToUse = statusValue || currentStatus;\n      const options = { updateHistory: false, ...extraOptions };\n      return fetchAndRenderList(statusToUse, options);\n    };\n\n    // ---------- EVENTOS DOS BOTÕES ----------\n    statusButtons.forEach(button => {\n      button.addEventListener('click', event => {\n        event.preventDefault();\n        const statusToFilter = button.dataset.status;\n        const nextStatus = (statusToFilter === currentStatus) ? DEFAULT_STATUS : statusToFilter;\n        fetchAndRenderList(nextStatus);\n      });\n    });\n\n    // ---------- POPSTATE ----------\n    window.addEventListener('popstate', event => {\n      const status = event.state?.status;\n      if (status) fetchAndRenderList(status, { updateHistory: false });\n      else window.location.reload();\n    });\n    }) ();\n  </script>\n\n  // AQUI ESTAVA O SCRIPT PARA NOVO ANIMAL\n\n  ${sidebar_script}\n</body>\n\n</html>\n`;\n\n// ---------- SAÍDA ----------\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        -528
      ],
      "id": "0b45aef1-4a1a-4a3c-9f55-c7a445fae9e7",
      "name": "List Page"
    },
    {
      "parameters": {
        "jsCode": "// Gera o html principal da página\n\nconst sidebar_html = $('Sidebar Html').first().json.html;\nconst sidebar_script = $('Sidebar Script').first().json.script;\nconst painel_html = $('Painel Html').first().json.html;\nconst painel_css = $('Painel Css').first().json.css;\n\nconst html = `\n<!DOCTYPE html>\n<html lang=\"pt-br\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Kaniu :: NOME_CANIL</title>\n    \n    <!------------------------------------- Carregar fontes locais ------------------------------------->\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/fontawesome.css\" rel=\"stylesheet\" />\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/solid.css\" rel=\"stylesheet\" />\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/css/details.css\" rel=\"stylesheet\" />\n    \n    <!------------------------------------- CSS do Painel ------------------------------------->\n    ${painel_css}\n</head>\n\n<body>\n  <div class=\"app-shell\">\n  \n    <!------------------------------------- Carregar sidebar  ------------------------------------->\n    ${sidebar_html}\n\n    <!------------------------------------- Conteúdo principal da página ------------------------------------->\n    <div class=\"main-with-sidebar\">\n        <main>\n            <div class=\"content-grid\">\n              ${painel_html}\n            </div>\n        </main>\n    </div>\n    \n    <!------------------------------------- Script da sidebar ------------------------------------->\n    ${sidebar_script}\n  </div>\n</body>\n</html>\n`;\n\nreturn {html};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        -64
      ],
      "id": "05971278-3f86-45f0-97ca-e177f2257716",
      "name": "Painel Page"
    },
    {
      "parameters": {
        "jsCode": "const script = `\n    <script>\n      const sidebar = document.getElementById('sidebar');\n      const toggleBtn = document.getElementById('sidebar-toggle');\n      const mainContent = document.querySelector('.main-with-sidebar');\n    \n      toggleBtn.addEventListener('click', () => {\n        sidebar.classList.toggle('collapsed');\n        mainContent.classList.toggle('expanded');\n      });\n    </script>\n`;\n\nreturn {script};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -928,
        -208
      ],
      "id": "56850d4e-4f23-422b-b451-e22e72d46de0",
      "name": "Sidebar Script"
    },
    {
      "parameters": {
        "jsCode": "const base_url = $('Vars').first().json.url;\nconst current_page = $('Vars').first().json.menu;\n\nconst html = `\n    <aside class=\"sidebar\" id=\"sidebar\">\n      <div class=\"sidebar-header\">\n        <button id=\"sidebar-toggle\" class=\"sidebar-toggle\">\n          <i class=\"fa-solid fa-bars\"></i>\n        </button>\n        <img src=\"${$('Constants').first().json.img_logo}\" alt=\"Kaniu\" class=\"sidebar-logo\" />\n      </div>\n\n      <nav class=\"sidebar-menu\">\n        <button class=\"sidebar-item\" data-target=\"painel\">\n          <i class=\"fa-solid fa-chart-pie\"></i><span>Painel</span>\n        </button>\n        <button class=\"sidebar-item\" data-target=\"animais\">\n          <i class=\"fa-solid fa-paw\"></i><span>Animais</span>\n        </button>\n        <button class=\"sidebar-item\" data-target=\"historico\">\n          <i class=\"fa-solid fa-clock-rotate-left\"></i><span>Histórico</span>\n        </button>\n        <button class=\"sidebar-item\" data-target=\"avaliacoes\">\n          <i class=\"fa-solid fa-stethoscope\"></i><span>Avaliações</span>\n        </button>\n        <button class=\"sidebar-item\" data-target=\"tratamentos\">\n          <i class=\"fa-solid fa-prescription-bottle-medical\"></i><span>Tratamentos</span>\n        </button>\n      </nav>\n\n      <div class=\"sidebar-footer\">\n        <button class=\"sidebar-item\" id=\"toggle-theme\">\n          <i class=\"fa-solid fa-circle-half-stroke\"></i><span>Tema</span>\n        </button>\n        <button class=\"sidebar-item\">\n          <i class=\"fa-solid fa-warehouse\"></i><span>Canil</span>\n        </button>\n        <button class=\"sidebar-item\">\n          <i class=\"fa-solid fa-user\"></i><span>Perfil</span>\n        </button>\n      </div>\n    </aside>\n\n    <script>\n      document.addEventListener('DOMContentLoaded', () => {\n        const buttons = document.querySelectorAll('.sidebar-item[data-target]');\n        const currentPage = '${current_page}';\n        console.log('currentPage :: ',currentPage);\n  \n        // Aplica destaque ao botão da página atual\n        buttons.forEach(btn => {\n          const target = btn.getAttribute('data-target');\n            btn.classList.remove('active');\n          if (target === currentPage) {\n            btn.classList.add('active');\n          }\n  \n          // Redireciona diretamente ao clicar\n          btn.addEventListener('click', () => {\n            end_url = \"${base_url}?pagina=\"+target;\n            console.log('target-->',target);\n            window.location.href = end_url;\n          });\n        });\n      });\n  </script>\n`;\n\nreturn {html};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1136,
        -208
      ],
      "id": "96ce95b6-aea0-476a-a18c-cbde5e4d87c8",
      "name": "Sidebar Html"
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu\n/* Sistema de gestão de abrigos de animais\n/* Página do painel - CSS harmonizado com details.css\n/**********************************************/\n\nconst css = `\n<style>\n/* ===== SOBREPOSIÇÕES ESPECÍFICAS DO PAINEL ===== */\n/* Garante que o main do painel tenha comportamento correto */\nbody.painel-page main {\n  padding: 1rem 1.5rem;\n  margin-top: 0;\n  max-width: 100%;\n}\n\n/* ===== CONTAINER DO CONTEÚDO ===== */\n.content-grid {\n  flex: 1;\n  overflow: hidden; /* 🔹 NÃO rola aqui */\n  min-height: 0;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  margin-top: 1.25rem;\n}\n\n/* ===== GRID DO PAINEL (com scroll) ===== */\n.dashboard-grid {\n  flex: 1;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));\n  gap: 1rem;\n  padding: 0.5rem 0;\n  width: 100%;\n  max-width: 100%;\n  box-sizing: border-box;\n  overflow-y: auto; /* 🔹 ÚNICO scroll vertical */\n  overflow-x: hidden;\n  min-height: 0;\n  align-content: start; /* 🔹 cards começam do topo */\n}\n\n/* ===== CARD DO DASHBOARD ===== */\n.dashboard-card {\n  background: var(--card-background, #fff);\n  border: 1px solid var(--border-color, #E5E7F2);\n  border-radius: var(--radius-lg, 14px);\n  display: flex;\n  flex-direction: column;\n  min-width: 0; /* 🔹 CRÍTICO */\n  max-height: 420px; /* 🔹 altura máxima fixa */\n  min-height: 280px; /* 🔹 altura mínima para consistência */\n  overflow: hidden;\n  box-shadow: 0 8px 25px rgba(15,23,42,.04);\n}\n\n.dashboard-card header {\n  display: flex;\n  align-items: center;\n  gap: .5rem;\n  padding: .85rem 1rem;\n  background: var(--background-soft, #F5F6FB);\n  border-bottom: 1px solid var(--border-color, #E5E7F2);\n  flex-shrink: 0;\n  font-weight: 500;\n  font-size: 0.9rem;\n  color: var(--text-dark, #1e293b);\n}\n\n.dashboard-card header i {\n  color: var(--primary-color, #5A5D7F);\n  font-size: 1rem;\n}\n\n/* ===== WRAPPER DA TABELA (scroll individual) ===== */\n.table-wrapper {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: auto;\n  min-height: 0; /* 🔹 CRÍTICO */\n  max-height: 100%;\n  position: relative;\n}\n\n/* ===== TABELAS ===== */\n.dashboard-card table {\n  width: 100%;\n  border-collapse: collapse;\n  min-width: 100%;\n}\n\n.dashboard-card thead {\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  background: var(--background-soft, #F5F6FB);\n}\n\n.dashboard-card th,\n.dashboard-card td {\n  padding: .65rem 1rem;\n  border-bottom: 1px solid var(--border-color, #E5E7F2);\n  font-size: .85rem;\n  text-align: left;\n}\n\n.dashboard-card th {\n  text-transform: uppercase;\n  font-size: .7rem;\n  color: var(--text-light, #6B7280);\n  font-weight: 600;\n  white-space: nowrap;\n}\n\n.dashboard-card td {\n  color: var(--text-dark, #374151);\n}\n\n.dashboard-card tbody tr:hover {\n  background: var(--background-light, #F9FAFB);\n}\n\n.dashboard-card .empty-message {\n  text-align: center !important;\n  padding: 2rem 1rem !important;\n  color: var(--text-faded, #9CA3AF) !important;\n  font-style: italic;\n}\n\n/* ===== DESTAQUES (mantém as cores originais) ===== */\n.days-red {\n  color: #DC2626 !important;\n  font-weight: 600;\n}\n\n.highlight-loss {\n  color: #DC2626 !important;\n  font-weight: 600;\n}\n\n/* ===== SCROLLBAR CUSTOMIZADA ===== */\n.table-wrapper::-webkit-scrollbar,\n.dashboard-grid::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.table-wrapper::-webkit-scrollbar-track,\n.dashboard-grid::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.table-wrapper::-webkit-scrollbar-thumb,\n.dashboard-grid::-webkit-scrollbar-thumb {\n  background: var(--border-color, #CBD5E1);\n  border-radius: 3px;\n}\n\n.table-wrapper::-webkit-scrollbar-thumb:hover,\n.dashboard-grid::-webkit-scrollbar-thumb:hover {\n  background: var(--primary-color, #94A3B8);\n}\n\n/* Firefox */\n.table-wrapper,\n.dashboard-grid {\n  scrollbar-width: thin;\n  scrollbar-color: var(--border-color, #CBD5E1) transparent;\n}\n\n/* ===== RESPONSIVO ===== */\n@media (max-width: 1400px) {\n  .dashboard-grid {\n    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));\n  }\n  \n  .dashboard-card {\n    max-height: 400px;\n  }\n}\n\n@media (max-width: 1200px) {\n  .dashboard-grid {\n    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));\n  }\n}\n\n@media (max-width: 768px) {\n  .dashboard-grid {\n    grid-template-columns: 1fr;\n    gap: 0.75rem;\n  }\n  \n  main {\n    padding: 0.75rem 1rem;\n    margin: 0;\n  }\n  \n  .dashboard-card {\n    max-height: 380px;\n    min-height: 240px;\n  }\n  \n  .dashboard-card th,\n  .dashboard-card td {\n    padding: .5rem .75rem;\n    font-size: .8rem;\n  }\n  \n  .dashboard-card th {\n    font-size: .65rem;\n  }\n}\n\n@media (max-width: 480px) {\n  .dashboard-grid {\n    grid-template-columns: 1fr;\n  }\n  \n  main {\n    padding: 0.5rem;\n  }\n  \n  .dashboard-card {\n    max-height: 360px;\n    min-height: 220px;\n  }\n  \n  .dashboard-card header {\n    padding: .75rem .85rem;\n    font-size: .85rem;\n  }\n  \n  .dashboard-card th,\n  .dashboard-card td {\n    padding: .45rem .6rem;\n    font-size: .75rem;\n  }\n}\n\n/* ===== AJUSTES PARA SIDEBAR ===== */\n.main-with-sidebar {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  min-width: 0;\n  height: 100vh; /* 🔹 altura total da viewport */\n}\n\n.main-with-sidebar main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  min-height: 0;\n}\n\n/* ===== MODO ESCURO (se aplicado) ===== */\n@media (prefers-color-scheme: dark) {\n  .dashboard-card {\n    background: var(--card-background, #1E293B);\n    border-color: var(--border-color, #334155);\n  }\n  \n  .dashboard-card header {\n    background: var(--background-soft, #0F172A);\n    border-bottom-color: var(--border-color, #334155);\n    color: var(--text-dark, #E2E8F0);\n  }\n  \n  .dashboard-card th {\n    background: var(--background-soft, #0F172A);\n    color: var(--text-light, #94A3B8);\n  }\n  \n  .dashboard-card td {\n    border-bottom-color: var(--border-color, #334155);\n    color: var(--text-dark, #CBD5E1);\n  }\n  \n  .dashboard-card tbody tr:hover {\n    background: var(--background-light, #334155);\n  }\n}\n</style>\n`;\n\nreturn {css};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        -64
      ],
      "id": "d9730e6a-d652-412f-bbe0-1216352a7802",
      "name": "Painel Css"
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu\n/* Sistema de gestão de abrigos de animais\n/* Página do animal\n/**********************************************/\n\nconst css = $('Painel Css').first().json.css;\n\nconst html = `\n  <div class=\"main-container\">\n    <div class=\"tab-nav\">\n        <button class=\"tab-btn active\" data-tab=\"pendencias\">\n            <i class=\"fa-solid fa-clock\"></i>\n            Pendências\n        </button>\n        <button class=\"tab-btn\" data-tab=\"peso\">\n            <i class=\"fa-solid fa-weight-scale\"></i>\n            Peso\n        </button>\n        <button class=\"tab-btn\" data-tab=\"saude\">\n            <i class=\"fa-solid fa-stethoscope\"></i>\n            Saúde\n        </button>\n    </div>\n  </div>\n    <section class=\"dashboard-grid\">\n      <!-- Avaliações antigas -->\n      <div class=\"dashboard-card\" data-category=\"pendencias\">\n        <header><i class=\"fa-solid fa-stethoscope\"></i> Avaliações antigas</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Data</th><th>Dias</th></tr></thead>\n            <tbody id=\"avaliacoes-antigas-body\">\n              <tr><td colspan=\"3\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Avaliações nota baixa -->\n      <div class=\"dashboard-card\" data-category=\"saude\">\n        <header><i class=\"fa-solid fa-heart-circle-xmark\"></i> Avaliações com nota baixa</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Nota</th><th>Condições</th></tr></thead>\n            <tbody id=\"avaliacoes-nota-baixa-body\">\n              <tr><td colspan=\"3\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Score corporal baixo -->\n      <div class=\"dashboard-card\" data-category=\"peso\">\n        <header><i class=\"fa-solid fa-dumbbell\"></i> Score corporal baixo</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Score</th></tr></thead>\n            <tbody id=\"score-baixo-body\">\n              <tr><td colspan=\"2\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Medicações -->\n      <div class=\"dashboard-card\" data-category=\"saude\">\n        <header><i class=\"fa-solid fa-syringe\"></i> Medicações em andamento</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Qtd</th></tr></thead>\n            <tbody id=\"medicacoes-body\">\n              <tr><td colspan=\"2\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Pesagens antigas -->\n      <div class=\"dashboard-card\" data-category=\"pendencias\">\n        <header><i class=\"fa-solid fa-weight-scale\"></i> Pesagens antigas</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Data</th><th>Dias</th></tr></thead>\n            <tbody id=\"pesagens-antigas-body\">\n              <tr><td colspan=\"3\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Perda de peso -->\n      <div class=\"dashboard-card\" data-category=\"peso\">\n        <header><i class=\"fa-solid fa-chart-line\"></i> Perda de peso</header>\n        <div class=\"table-wrapper\">\n          <table>\n            <thead><tr><th>Animal</th><th>Peso</th><th>Variação</th></tr></thead>\n            <tbody id=\"perda-peso-body\">\n              <tr><td colspan=\"3\" class=\"empty-message\">Carregando...</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </section>\n\n<script>\nconst CANIL_ID = 1;\nconst ENDPOINT = \"https://karah-n8n.uzd6db.easypanel.host/webhook/kaniu-pack-panel\";\n\n// Inicializa a navegação por tabs\nfunction initTabNavigation() {\n  const tabButtons = document.querySelectorAll('.tab-btn');\n  const cards = document.querySelectorAll('.dashboard-card');\n  \n  tabButtons.forEach(button => {\n    button.addEventListener('click', () => {\n      const targetTab = button.getAttribute('data-tab');\n      \n      // Atualiza botões ativos\n      tabButtons.forEach(btn => btn.classList.remove('active'));\n      button.classList.add('active');\n      \n      // Mostra/oculta cards conforme categoria\n      cards.forEach(card => {\n        const category = card.getAttribute('data-category');\n        if (category === targetTab) {\n          card.style.display = 'flex';\n        } else {\n          card.style.display = 'none';\n        }\n      });\n    });\n  });\n  \n  // Mostra apenas cards da primeira aba (pendencias) ao carregar\n  cards.forEach(card => {\n    if (card.getAttribute('data-category') !== 'pendencias') {\n      card.style.display = 'none';\n    }\n  });\n}\n\nasync function carregarPainel() {\n  try {\n    const resp = await fetch(ENDPOINT, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ canil_id: CANIL_ID })\n    });\n\n    let data = await resp.json();\n    // pode vir como [ { ... } ]\n    if (Array.isArray(data)) data = data[0] || {};\n    if (!data || typeof data !== \"object\") data = {};\n\n    // mapeamento seguro de listas\n    const getList = (key) => (Array.isArray(data[key]) ? data[key] : []);\n\n    // 1) Avaliações antigas\n    renderTabela(\n      \"avaliacoes-antigas-body\",\n      getList(\"avaliacoes_antigas\"),\n      (item) => {\n        const dias =\n          item.dias_decorridos ??\n          item.dias_passados ??\n          item.dias_transcorridos ??\n          item.prazo_dias ??\n          \"-\";\n        const dataAvaliacao = item.data\n          ? new Date(item.data).toLocaleDateString(\"pt-BR\")\n          : \"-\";\n          const animal_nome = item.animal_nome || '-'; \n          const number_class = Number(dias) > 60 ? \"days-red\" : '';\n        return '<tr><td>' + animal_nome + '</td><td>' + dataAvaliacao + '</td><td class=\"' + number_class+ '\">' + dias + ' dias</td></tr>';\n      }\n    );\n\n    // 2) Avaliações com nota baixa\n    renderTabela(\n      \"avaliacoes-nota-baixa-body\",\n      getList(\"avaliacoes_nota_baixa\"),\n      (item) => {\n        const nota =\n          item.nota_percentual != null\n            ? item.nota_percentual.toFixed(1) + \"%\"\n            : item.nota != null\n              ? (item.nota * 100).toFixed(1) + \"%\"\n              : \"-\";\n        const cond =\n          item.condicoes_identificadas ||\n          (Array.isArray(item.condicoes) && item.condicoes.length\n            ? item.condicoes.join(\", \")\n            : \"-\");\n        const nome = item.animal_nome || \"-\";\n        const numero_classe = (item.nota_percentual || 100) < 95 ? \"days-red\" : \"\";\n        return '<tr><td>' + nome + '</td><td class=\"' + numero_classe + '\">' + nota + '</td><td>' + cond + '</td></tr>';\n      }\n    );\n\n    // 3) Score corporal baixo\n    renderTabela(\n      \"score-baixo-body\",\n      getList(\"score_baixo\"),\n      (item) => '<tr><td>' + (item.animal_nome || '-') + '</td><td>' + (item.score_corporal ?? item.score ?? '-') +'</td></tr>'\n    );\n\n    // 4) Medicações\n    renderTabela(\n      \"medicacoes-body\",\n      getList(\"quantidade_medicacoes\"),\n      (item) => '<tr><td>' + (item.animal_nome || \"-\") + '</td><td>' + (item.quantidade_medicacoes ?? item.quantidade ?? \"-\") + '</td></tr>'\n    );\n\n    // 5) Pesagens antigas\n    renderTabela(\n      \"pesagens-antigas-body\",\n      getList(\"pesagens_antigas\"),\n      (item) => {\n        const dataPesagem = item.data_pesagem\n          ? new Date(item.data_pesagem).toLocaleDateString(\"pt-BR\")\n          : \"-\";\n        const dias =\n          item.dias_transcorridos ??\n          item.dias_passados ??\n          item.prazo_dias ??\n          \"-\";\n        return '<tr><td>' + (item.animal_nome || \"-\") + '</td><td>' + (dataPesagem) + '</td><td class=\"' + (Number(dias) > 180 || Number(dias) < -180 ? \"days-red\" : \"\") + '\">' + (dias) + ' dias</td></tr>';\n      }\n    );\n\n    // 6) Perda de peso\n    renderTabela(\n      \"perda-peso-body\",\n      getList(\"perda_peso\"),\n      (item) => {\n        const dataPesagem = item.data_pesagem\n          ? new Date(item.data_pesagem).toLocaleDateString(\"pt-BR\")\n          : \"-\";\n        const peso =\n          item.pesagem_valor != null\n            ? item.pesagem_valor.toFixed(1) + \" kg\"\n            : \"-\";\n        const variacao =\n          item.variacao_peso_percentual != null\n            ? item.variacao_peso_percentual.toFixed(1) + \"%\"\n            : \"-\";\n        return '<tr><td>' + (item.animal_nome || \"-\") + '</td><td>' + peso + '</td><td class=\"' + (item.variacao_peso_percentual < 0 ? \"highlight-loss\" : \"\") + '\">' + (variacao) + '</td></tr>';\n      }\n    );\n\n    // qualquer tbody que ainda tenha \"Carregando\" e não foi preenchido acima:\n    limparRestantes();\n\n  } catch (err) {\n    console.error(\"Erro ao carregar painel:\", err);\n    // se der erro, troca todos os 'carregando' por erro\n    document.querySelectorAll(\"tbody[id$='-body']\").forEach((tb) => {\n      tb.innerHTML = '<tr><td colspan=\"10\" class=\"empty-message\">Erro ao carregar dados</td></tr>';\n    });\n  }\n}\n\n/**\n * Preenche uma tabela específica.\n * Se a lista vier vazia, mostra \"Nenhum dado encontrado\".\n */\nfunction renderTabela(tbodyId, lista, templateFn) {\n  const tbody = document.getElementById(tbodyId);\n  if (!tbody) return;\n\n  if (!Array.isArray(lista) || lista.length === 0) {\n    tbody.innerHTML = '<tr><td colspan=\"10\" class=\"empty-message\">Nenhum dado encontrado</td></tr>';\n    return;\n  }\n\n  tbody.innerHTML = lista.map(templateFn).join(\"\");\n}\n\n/**\n * Depois de preencher tudo, garante que nenhum \"Carregando.\" fique na tela\n */\nfunction limparRestantes() {\n  document.querySelectorAll(\"tbody[id$='-body']\").forEach((tb) => {\n    if (!tb.innerHTML || tb.innerHTML.toLowerCase().includes(\"carregando\")) {\n      tb.innerHTML = '<tr><td colspan=\"10\" class=\"empty-message\">Nenhum dado encontrado</td></tr>';\n    }\n  });\n}\n\n// Inicializa tudo quando o DOM estiver pronto\ndocument.addEventListener('DOMContentLoaded', () => {\n  initTabNavigation();\n  carregarPainel();\n});\n</script>\n`;\n\nreturn {html};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        -64
      ],
      "id": "abbc72e2-c3ce-45f5-9a0b-88f425bf8d23",
      "name": "Painel Html"
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu\n/* Sistema de gestão de abrigos de animais\n/* Página do histórico de eventos\n/**********************************************/\n\nconst css = $('CSS Historico').first().json.css;\n\nconst html = `\n\n  <div class=\"main-container\">\n    <div class=\"tab-nav\">\n        <button class=\"tab-btn active\" data-tab=\"realizados\">\n            <i class=\"fa-solid fa-check-circle\"></i>\n            Realizados\n        </button>\n        <button class=\"tab-btn\" data-tab=\"programados\">\n            <i class=\"fa-solid fa-calendar-days\"></i>\n            Programados\n        </button>\n        <button class=\"tab-btn\" data-tab=\"atrasados\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n            Atrasados\n        </button>\n    </div>\n  </div>\n  \n  <section class=\"historico-content\">\n    <div class=\"table-card\">\n      <div class=\"table-header\">\n        <div class=\"table-title\">\n          <i class=\"fa-solid fa-list\"></i>\n          <span id=\"table-title\">Eventos Realizados</span>\n        </div>\n        <div class=\"table-info\">\n          <span id=\"records-count\">0 registros</span>\n        </div>\n      </div>\n      \n      <div class=\"table-wrapper\">\n        <table class=\"eventos-table\">\n          <thead>\n            <tr>\n              <th>Data</th>\n              <th>Animal</th>\n              <th>Tipo</th>\n              <th>Descrição</th>\n              <th>Veterinário</th>\n              <th>Clínica</th>\n              <th class=\"actions-col\">Ações</th>\n            </tr>\n          </thead>\n          <tbody id=\"eventos-tbody\">\n            <tr>\n              <td colspan=\"7\" class=\"empty-message\">\n                <i class=\"fa-solid fa-spinner fa-spin\"></i>\n                Carregando eventos...\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"table-pagination\">\n        <button class=\"btn-page\" id=\"prev-page\" disabled>\n          <i class=\"fa-solid fa-chevron-left\"></i>\n          Anterior\n        </button>\n        <span class=\"page-info\">\n          Página <span id=\"current-page\">1</span> de <span id=\"total-pages\">1</span>\n        </span>\n        <button class=\"btn-page\" id=\"next-page\" disabled>\n          Próxima\n          <i class=\"fa-solid fa-chevron-right\"></i>\n        </button>\n      </div>\n    </div>\n  </section>\n\n<script>\nconst CANIL_ID = 1;\nconst ENDPOINT = \"https://karah-n8n.uzd6db.easypanel.host/webhook/canil-eventos\";\nconst ITEMS_PER_PAGE = 50;\n\nlet todosEventos = [];\nlet eventosFiltrados = [];\nlet currentPage = 1;\nlet currentFilter = 'realizados';\n\n// Tipos de evento com ícones\nconst tipoIcons = {\n  'Pesagem': 'fa-weight-scale',\n  'Internação': 'fa-hospital',\n  'Vermifugação': 'fa-pills',\n  'Observação': 'fa-eye',\n  'Vacinação': 'fa-syringe',\n  'Consulta': 'fa-stethoscope',\n  'Cirurgia': 'fa-user-doctor',\n  'Exame': 'fa-flask',\n  'Banho': 'fa-shower',\n  'Tosa': 'fa-scissors'\n};\n\n// Carrega eventos do endpoint\nasync function carregarEventos() {\n  try {\n    const resp = await fetch(ENDPOINT, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ canil_id: CANIL_ID })\n    });\n\n    let data = await resp.json();\n    \n    // Extrai o array de eventos\n    if (Array.isArray(data) && data[0]?.data) {\n      todosEventos = data[0].data;\n    } else if (Array.isArray(data)) {\n      todosEventos = data;\n    } else {\n      todosEventos = [];\n    }\n\n    aplicarFiltro(currentFilter);\n    \n  } catch (err) {\n    console.error(\"Erro ao carregar eventos:\", err);\n    document.getElementById('eventos-tbody').innerHTML = \n      '<tr><td colspan=\"7\" class=\"empty-message error-message\"><i class=\"fa-solid fa-exclamation-circle\"></i> Erro ao carregar eventos</td></tr>';\n  }\n}\n\n// Aplica filtro baseado na aba selecionada\nfunction aplicarFiltro(tipo) {\n  currentFilter = tipo;\n  currentPage = 1;\n  \n  eventosFiltrados = todosEventos.filter(evento => {\n    // Filtro por status\n    if (tipo === 'realizados') {\n      return evento.concluido && !evento.atrasado;\n    } else if (tipo === 'programados') {\n      return evento.programado || (!evento.concluido && !evento.atrasado);\n    } else if (tipo === 'atrasados') {\n      return evento.atrasado;\n    }\n    return false;\n  });\n  \n  // Ordena por data (mais recente primeiro)\n  eventosFiltrados.sort((a, b) => {\n    const dataA = new Date(a.data_exibicao || a.data);\n    const dataB = new Date(b.data_exibicao || b.data);\n    return dataB - dataA;\n  });\n  \n  renderizarTabela();\n}\n\n// Renderiza a tabela com paginação\nfunction renderizarTabela() {\n  const tbody = document.getElementById('eventos-tbody');\n  const totalPages = Math.ceil(eventosFiltrados.length / ITEMS_PER_PAGE);\n  \n  // Atualiza informações\n  document.getElementById('records-count').textContent = eventosFiltrados.length + ' registro' + (eventosFiltrados.length !== 1 ? 's' : '');\n  document.getElementById('current-page').textContent = currentPage;\n  document.getElementById('total-pages').textContent = totalPages || 1;\n  \n  // Atualiza botões de paginação\n  document.getElementById('prev-page').disabled = currentPage <= 1;\n  document.getElementById('next-page').disabled = currentPage >= totalPages;\n  \n  // Se não há eventos\n  if (eventosFiltrados.length === 0) {\n    tbody.innerHTML = '<tr><td colspan=\"7\" class=\"empty-message\"><i class=\"fa-solid fa-inbox\"></i> Nenhum evento encontrado</td></tr>';\n    return;\n  }\n  \n  // Calcula items da página atual\n  const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;\n  const endIdx = startIdx + ITEMS_PER_PAGE;\n  const pageItems = eventosFiltrados.slice(startIdx, endIdx);\n  \n  // Renderiza linhas\n  tbody.innerHTML = pageItems.map(evento => {\n    const data = evento.data_exibicao || evento.data;\n    const dataFormatada = data ? new Date(data).toLocaleDateString('pt-BR') : '-';\n    const icon = tipoIcons[evento.tipo] || 'fa-circle';\n    const statusClass = evento.atrasado ? 'status-atrasado' : evento.concluido ? 'status-concluido' : 'status-programado';\n    \n    return '<tr class=\"'+statusClass+'\"><td class=\"date-col\">'+dataFormatada+'</td><td class=\"animal-col\">'+evento.nome_animal || '-'+'</td><td class=\"tipo-col\"><i class=\"fa-solid '+icon+'\"></i>'+evento.tipo || '-'+'</td><td class=\"desc-col\">'+evento.descricao || '-'+'</td><td>'+evento.nome_veterinario || '-'+'</td><td>'+evento.clinica || '-'+'</td><td class=\"actions-col\"><button class=\"btn-action\" title=\"Ver detalhes\" onclick=\"verDetalhes('+evento.registro_id+')\"><i class=\"fa-solid fa-eye\"></i></button></td></tr>';\n  }).join('');\n}\n\n// Inicializa navegação por tabs\nfunction initTabNavigation() {\n  const tabButtons = document.querySelectorAll('.tab-btn');\n  \n  tabButtons.forEach(button => {\n    button.addEventListener('click', () => {\n      const targetTab = button.getAttribute('data-tab');\n      \n      // Atualiza botões ativos\n      tabButtons.forEach(btn => btn.classList.remove('active'));\n      button.classList.add('active');\n      \n      // Atualiza título da tabela\n      const titulos = {\n        'realizados': 'Eventos Realizados',\n        'programados': 'Eventos Programados',\n        'atrasados': 'Eventos Atrasados'\n      };\n      document.getElementById('table-title').textContent = titulos[targetTab];\n      \n      // Aplica filtro\n      aplicarFiltro(targetTab);\n    });\n  });\n}\n\n// Inicializa paginação\nfunction initPaginacao() {\n  document.getElementById('prev-page').addEventListener('click', () => {\n    if (currentPage > 1) {\n      currentPage--;\n      renderizarTabela();\n    }\n  });\n  \n  document.getElementById('next-page').addEventListener('click', () => {\n    const totalPages = Math.ceil(eventosFiltrados.length / ITEMS_PER_PAGE);\n    if (currentPage < totalPages) {\n      currentPage++;\n      renderizarTabela();\n    }\n  });\n}\n\n// Função para ver detalhes (placeholder)\nfunction verDetalhes(registroId) {\n  console.log('Ver detalhes do registro:', registroId);\n  // TODO: Implementar modal ou redirecionamento\n  alert('Detalhes do evento #' + registroId);\n}\n\n// Inicializa tudo quando o DOM estiver pronto\ndocument.addEventListener('DOMContentLoaded', () => {\n  initTabNavigation();\n  initPaginacao();\n  carregarEventos();\n});\n</script>\n`;\n\nreturn {html};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        96
      ],
      "id": "cc55361d-c061-47e1-942b-d5fcac450f23",
      "name": "Historico Html"
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu - Página de Histórico\n/* HTML Refatorado e Modular\n/*\n/* Este arquivo agora é LIMPO, apenas integrando\n/* os módulos CSS e JS criados separadamente\n/**********************************************/\n\n// ===== IMPORTA MÓDULOS CSS GLOBAIS =====\nconst cssVariables = $('CSS Variables').first().json.css;\nconst cssFontsBase = $('CSS Fonts Base').first().json.css;\nconst cssLayout = $('CSS Layout').first().json.css;\nconst cssComponents = $('CSS Components').first().json.css;\nconst cssSidebar = $('CSS Sidebar').first().json.css;\nconst cssUtilities = $('CSS Utilities').first().json.css;\n\n// ===== IMPORTA CSS DA PÁGINA =====\nconst cssHistorico = $('Historico Css').first().json.css;\n\n// ===== IMPORTA MÓDULOS JAVASCRIPT =====\nconst jsAPI = $('JS API Module').first().json.script;\nconst jsDOMHelpers = $('JS DOM Helpers').first().json.script;\nconst jsStateManager = $('JS State Manager').first().json.script;\n\n// ===== IMPORTA SCRIPT DA PÁGINA =====\nconst jsHistorico = $('Historico Script Refactored').first().json.script;\n\n// ===== IMPORTA COMPONENTES =====\nconst sidebar_html = $('Sidebar Html').first().json.html;\nconst sidebar_script = $('Sidebar Script').first().json.script;\n\nconst html = `\n<!DOCTYPE html>\n<html lang=\"pt-BR\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Kaniu :: Histórico de Eventos</title>\n\n    <!-- ===== FAVICON ===== -->\n    <link rel=\"icon\" type=\"image/png\" href=\"${$('Constants').first().json.fav_icon || ''}\" />\n\n    <!-- ===== FONT AWESOME ===== -->\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/fontawesome.css\" rel=\"stylesheet\" />\n    <link href=\"https://viralatinhaz.uzd6db.easypanel.host/assets/fontawesome/css/solid.css\" rel=\"stylesheet\" />\n\n    <!-- ===== CSS GLOBAL (MODULAR) ===== -->\n    ${cssVariables}\n    ${cssFontsBase}\n    ${cssLayout}\n    ${cssComponents}\n    ${cssSidebar}\n    ${cssUtilities}\n\n    <!-- ===== CSS DA PÁGINA ===== -->\n    ${cssHistorico}\n</head>\n\n<body>\n  <div class=\"app-shell\">\n\n    <!-- ===== SIDEBAR ===== -->\n    ${sidebar_html}\n\n    <!-- ===== CONTEÚDO PRINCIPAL ===== -->\n    <div class=\"main-with-sidebar\">\n        <main>\n            <div class=\"content-grid\">\n\n              <!-- ===== TABS DE FILTRO ===== -->\n              <div class=\"main-container\">\n                <div class=\"tab-nav\">\n                    <button class=\"tab-btn active\" data-tab=\"realizados\">\n                        <i class=\"fa-solid fa-check-circle\"></i>\n                        Realizados\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"programados\">\n                        <i class=\"fa-solid fa-calendar-days\"></i>\n                        Programados\n                    </button>\n                    <button class=\"tab-btn\" data-tab=\"atrasados\">\n                        <i class=\"fa-solid fa-exclamation-triangle\"></i>\n                        Atrasados\n                    </button>\n                </div>\n              </div>\n\n              <!-- ===== TABELA DE EVENTOS ===== -->\n              <section class=\"historico-content\">\n                <div class=\"table-card\">\n\n                  <!-- Header da Tabela -->\n                  <div class=\"table-header\">\n                    <div class=\"table-title\">\n                      <i class=\"fa-solid fa-list\"></i>\n                      <span id=\"table-title\">Eventos Realizados</span>\n                    </div>\n                    <div class=\"table-info\">\n                      <span id=\"records-count\">0 registros</span>\n                    </div>\n                  </div>\n\n                  <!-- Tabela -->\n                  <div class=\"table-wrapper\">\n                    <table class=\"eventos-table\">\n                      <thead>\n                        <tr>\n                          <th>Data</th>\n                          <th>Animal</th>\n                          <th>Tipo</th>\n                          <th>Descrição</th>\n                          <th>Veterinário</th>\n                          <th>Clínica</th>\n                          <th class=\"actions-col\">Ações</th>\n                        </tr>\n                      </thead>\n                      <tbody id=\"eventos-tbody\">\n                        <tr>\n                          <td colspan=\"7\" class=\"empty-message\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i>\n                            Carregando eventos...\n                          </td>\n                        </tr>\n                      </tbody>\n                    </table>\n                  </div>\n\n                  <!-- Paginação -->\n                  <div class=\"table-pagination\">\n                    <button class=\"btn-page\" id=\"prev-page\" disabled>\n                      <i class=\"fa-solid fa-chevron-left\"></i>\n                      Anterior\n                    </button>\n                    <span class=\"page-info\">\n                      Página <span id=\"current-page\">1</span> de <span id=\"total-pages\">1</span>\n                    </span>\n                    <button class=\"btn-page\" id=\"next-page\" disabled>\n                      Próxima\n                      <i class=\"fa-solid fa-chevron-right\"></i>\n                    </button>\n                  </div>\n\n                </div>\n              </section>\n\n            </div>\n        </main>\n    </div>\n  </div>\n\n  <!-- ===== OVERLAY (para modals futuros) ===== -->\n  <div id=\"overlay\" class=\"overlay\"></div>\n\n  <!-- ===== JAVASCRIPT MODULAR ===== -->\n  ${jsAPI}\n  ${jsDOMHelpers}\n  ${jsStateManager}\n\n  <!-- ===== SCRIPT DA PÁGINA ===== -->\n  ${jsHistorico}\n\n  <!-- ===== SCRIPT DA SIDEBAR ===== -->\n  ${sidebar_script}\n</body>\n\n</html>\n`;\n\nreturn { html };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        96
      ],
      "id": "1791a7ce-3454-4999-983b-30d6027e554a",
      "name": "Historico Page"
    },
    {
      "parameters": {
        "jsCode": "/**********************************************\n/* Kaniu\n/* Sistema de gestão de abrigos de animais\n/* Página do histórico - CSS\n/**********************************************/\n\nconst css = `\n<style>\n/* ===== CONTAINER DO CONTEÚDO ===== */\n.content-grid {\n  flex: 1;\n  overflow: hidden;\n  min-height: 0;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  margin-top: 1.25rem;\n}\n\n/* ===== CONTEÚDO DO HISTÓRICO ===== */\n.historico-content {\n  flex: 1;\n  overflow: hidden;\n  min-height: 0;\n}\n\n.table-card {\n  background: var(--card-background, #fff);\n  border: 1px solid var(--border-color, #E5E7F2);\n  border-radius: var(--radius-lg, 14px);\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n  box-shadow: 0 8px 25px rgba(15,23,42,.04);\n}\n\n.table-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: var(--background-soft, #F5F6FB);\n  border-bottom: 1px solid var(--border-color, #E5E7F2);\n  flex-shrink: 0;\n}\n\n.table-title {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 600;\n  font-size: 1rem;\n  color: var(--text-dark, #1e293b);\n}\n\n.table-title i {\n  color: var(--primary-color, #5A5D7F);\n}\n\n.table-info {\n  color: var(--text-light, #6B7280);\n  font-size: 0.875rem;\n}\n\n/* ===== TABELA ===== */\n.table-wrapper {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: auto;\n  min-height: 0;\n}\n\n.eventos-table {\n  width: 100%;\n  border-collapse: collapse;\n  min-width: 900px;\n}\n\n.eventos-table thead {\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  background: var(--background-soft, #F5F6FB);\n}\n\n.eventos-table th {\n  padding: 0.85rem 1rem;\n  text-align: left;\n  text-transform: uppercase;\n  font-size: 0.7rem;\n  font-weight: 600;\n  color: var(--text-light, #6B7280);\n  border-bottom: 2px solid var(--border-color, #E5E7F2);\n  white-space: nowrap;\n}\n\n.eventos-table td {\n  padding: 0.85rem 1rem;\n  border-bottom: 1px solid var(--border-color, #E5E7F2);\n  font-size: 0.875rem;\n  color: var(--text-dark, #374151);\n}\n\n.eventos-table tbody tr {\n  transition: background 0.15s ease;\n}\n\n.eventos-table tbody tr:hover {\n  background: var(--background-light, #F9FAFB);\n}\n\n/* Colunas específicas */\n.date-col {\n  font-weight: 500;\n  white-space: nowrap;\n}\n\n.animal-col {\n  font-weight: 600;\n  color: var(--primary-color, #5A5D7F);\n}\n\n.tipo-col {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  white-space: nowrap;\n}\n\n.tipo-col i {\n  color: var(--primary-color, #5A5D7F);\n}\n\n.desc-col {\n  max-width: 300px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.actions-col {\n  text-align: center;\n  width: 80px;\n}\n\n/* Status das linhas */\n.status-concluido {\n  background: rgba(16, 185, 129, 0.03);\n}\n\n.status-programado {\n  background: rgba(59, 130, 246, 0.03);\n}\n\n.status-atrasado {\n  background: rgba(239, 68, 68, 0.05);\n}\n\n.status-atrasado .date-col {\n  color: #DC2626;\n  font-weight: 600;\n}\n\n/* ===== AÇÕES ===== */\n.btn-action {\n  padding: 0.5rem;\n  background: transparent;\n  border: 1px solid var(--border-color, #E5E7F2);\n  border-radius: var(--radius-sm, 6px);\n  color: var(--text-light, #6B7280);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.btn-action:hover {\n  background: var(--primary-color, #5A5D7F);\n  border-color: var(--primary-color, #5A5D7F);\n  color: white;\n}\n\n/* ===== MENSAGENS VAZIAS ===== */\n.empty-message {\n  text-align: center !important;\n  padding: 3rem 1rem !important;\n  color: var(--text-faded, #9CA3AF) !important;\n  font-style: italic;\n}\n\n.empty-message i {\n  display: block;\n  font-size: 2.5rem;\n  margin-bottom: 1rem;\n  opacity: 0.5;\n}\n\n.error-message {\n  color: #DC2626 !important;\n}\n\n/* ===== PAGINAÇÃO ===== */\n.table-pagination {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  background: var(--background-soft, #F5F6FB);\n  border-top: 1px solid var(--border-color, #E5E7F2);\n  flex-shrink: 0;\n}\n\n.btn-page {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.65rem 1rem;\n  background: var(--card-background, #fff);\n  border: 1px solid var(--border-color, #E5E7F2);\n  border-radius: var(--radius-md, 8px);\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--text-dark, #1e293b);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.btn-page:hover:not(:disabled) {\n  background: var(--primary-color, #5A5D7F);\n  border-color: var(--primary-color, #5A5D7F);\n  color: white;\n}\n\n.btn-page:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.page-info {\n  color: var(--text-light, #6B7280);\n  font-size: 0.875rem;\n}\n\n.page-info span {\n  font-weight: 600;\n  color: var(--text-dark, #1e293b);\n}\n\n/* ===== SCROLLBAR ===== */\n.table-wrapper::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.table-wrapper::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.table-wrapper::-webkit-scrollbar-thumb {\n  background: var(--border-color, #CBD5E1);\n  border-radius: 3px;\n}\n\n.table-wrapper::-webkit-scrollbar-thumb:hover {\n  background: var(--primary-color, #94A3B8);\n}\n\n/* ===== RESPONSIVO ===== */\n@media (max-width: 768px) {\n  .tab-nav {\n    gap: 0.25rem;\n    overflow-x: auto;\n    padding-bottom: 0.75rem;\n  }\n  \n  .tab-btn {\n    padding: 0.65rem 1rem;\n    font-size: 0.875rem;\n    white-space: nowrap;\n  }\n  \n  .table-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n  }\n  \n  .eventos-table th,\n  .eventos-table td {\n    padding: 0.65rem 0.75rem;\n    font-size: 0.8rem;\n  }\n  \n  .desc-col {\n    max-width: 200px;\n  }\n  \n  .table-pagination {\n    flex-wrap: wrap;\n    gap: 0.5rem;\n    justify-content: center;\n  }\n  \n  .page-info {\n    width: 100%;\n    text-align: center;\n  }\n}\n\n@media (max-width: 480px) {\n  .tab-nav {\n    gap: 0.25rem;\n  }\n  \n  .tab-btn {\n    padding: 0.6rem 0.85rem;\n    font-size: 0.8rem;\n  }\n  \n  .tab-btn i {\n    font-size: 0.9rem;\n  }\n  \n  .eventos-table {\n    min-width: 700px;\n  }\n  \n  .desc-col {\n    max-width: 150px;\n  }\n}\n\n/* ===== MODO ESCURO ===== */\n@media (prefers-color-scheme: dark) {\n  .table-card,\n  .filters-bar {\n    background: var(--card-background, #1E293B);\n    border-color: var(--border-color, #334155);\n  }\n  \n  .table-header {\n    background: var(--background-soft, #0F172A);\n    border-bottom-color: var(--border-color, #334155);\n  }\n  \n  .eventos-table thead {\n    background: var(--background-soft, #0F172A);\n  }\n  \n  .eventos-table th {\n    color: var(--text-light, #94A3B8);\n    border-bottom-color: var(--border-color, #334155);\n  }\n  \n  .eventos-table td {\n    border-bottom-color: var(--border-color, #334155);\n    color: var(--text-dark, #CBD5E1);\n  }\n  \n  .eventos-table tbody tr:hover {\n    background: var(--background-light, #334155);\n  }\n}\n</style>\n`;\n\nreturn {css};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        96
      ],
      "id": "f1a3b273-393a-400b-9248-b43613e481fa",
      "name": "CSS Historico"
    },
    {
      "parameters": {
        "path": "kaniu-14",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2080,
        -400
      ],
      "id": "e3c03290-c66b-4957-9fee-d899cbf44a85",
      "name": "Canil14",
      "webhookId": "b9991c57-976d-4532-bde4-663d72bdc2c1"
    }
  ],
  "connections": {
    "Viralatinhaz": {
      "main": [
        [
          {
            "node": "Vars",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vars": {
      "main": [
        [
          {
            "node": "Constants",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ProjetoMeg": {
      "main": [
        [
          {
            "node": "Vars",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Details": {
      "main": [
        [
          {
            "node": "Details Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Combine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Empty": {
      "main": [
        [
          {
            "node": "List Page",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine": {
      "main": [
        [
          {
            "node": "List Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Animal Statuses": {
      "main": [
        [
          {
            "node": "List Style",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Icons": {
      "main": [
        [
          {
            "node": "Sidebar Html",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Constants": {
      "main": [
        [
          {
            "node": "Icons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Details Page": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Details Style": {
      "main": [
        [
          {
            "node": "Get Details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Style": {
      "main": [
        [
          {
            "node": "Get List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get List": {
      "main": [
        [
          {
            "node": "Empty",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Page": {
      "main": [
        [
          {
            "node": "Animal Statuses",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Tables",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Painel Css",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CSS Historico",
            "type": "main",
            "index": 0
          }
        ],
        [],
        []
      ]
    },
    "Get Tables": {
      "main": [
        [
          {
            "node": "Details Style",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Page": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Painel Page": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sidebar Script": {
      "main": [
        [
          {
            "node": "Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sidebar Html": {
      "main": [
        [
          {
            "node": "Sidebar Script",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Painel Css": {
      "main": [
        [
          {
            "node": "Painel Html",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Painel Html": {
      "main": [
        [
          {
            "node": "Painel Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Historico Html": {
      "main": [
        [
          {
            "node": "Historico Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Historico Page": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CSS Historico": {
      "main": [
        [
          {
            "node": "Historico Html",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Canil14": {
      "main": [
        [
          {
            "node": "Vars",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {
    "Viralatinhaz": [
      {
        "headers": {
          "host": "karah-n8n.uzd6db.easypanel.host",
          "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",
          "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
          "accept-encoding": "gzip, deflate, br, zstd",
          "accept-language": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7",
          "cookie": "rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2B5OIRs0zOREdIXZ2O01PfGmIx9NQEer4w%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX19i3FzRlQDwtE0KmWw0OtCgQcUeTIZ0S1k%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BxOaIU0bcIePK1LFMMk%2Bydc8fuATGYoD%2FdiH7Lgdw6BBBGKMYB3Z7vZsmyDxgY1S7UD%2Bhq0kaJYw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2Bo%2BnLQR1oqNOpSwGa7AW2Ieio3TkkW8X1wrJrhdsgpSB%2FSGh1TIetLuHWJhHr6cZh4RM72yCVx7wcQOWjpIiAtN26xawFzWKwRDs2VOcdF5tQ72NgR%2FiB9zMf0R1dzfMXDQBvX4C7R8NS889%2B2CkfZQDtCJLVr6%2FE%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX1%2BRs%2FIwYcLevXGFi5SYjzChe%2FtR7y5nTsUCPAVzKbIpaLL2XVUwf1dEwD%2B8VLcHaEzpLraRkS61pY1dU1gl2t10t9RzeHhtpfRAvZBU2v1N704cY8EYBIP7SdqgacfOMxxwtebgrVeqYNtTTjtJn9I20YDZYLKSmLk%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c241ff24a9ad53940b8c3b07f3121394f2a5667daf04331aaa56a13d92e8e026%2336e98418-cb69-4c27-b2c6-02d98ffe06fd%22%2C%22%24sesid%22%3A%5Bnull%2C%22019a44c4-c5f9-7f4f-a77d-d0c86e8e7c46%22%2C1762090337785%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fkarah-n8n.uzd6db.easypanel.host%2Fsignin%3Fredirect%3D%25252Fhome%25252Fworkflows%22%7D%7D; rl_session=RudderEncrypt%3AU2FsdGVkX1%2BZ6g2GYpjb3rb2qXLKsMWSTgZKYyr7YOjbQFZDA0T4bd3CWGVrBwWy0w1IS392GpyGWzZALPNBbk5YzEGYZkWcKoUPwVTHoTWqQSptm368PlvhqVFepenN9esWs0vL0slPiLKXgnlvUg%3D%3D",
          "dnt": "1",
          "priority": "u=0, i",
          "sec-ch-ua": "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"",
          "sec-ch-ua-mobile": "?0",
          "sec-ch-ua-platform": "\"Windows\"",
          "sec-fetch-dest": "document",
          "sec-fetch-mode": "navigate",
          "sec-fetch-site": "cross-site",
          "sec-fetch-user": "?1",
          "upgrade-insecure-requests": "1",
          "x-forwarded-for": "191.6.254.250",
          "x-forwarded-host": "karah-n8n.uzd6db.easypanel.host",
          "x-forwarded-port": "443",
          "x-forwarded-proto": "https",
          "x-forwarded-server": "03196bb10cdb",
          "x-real-ip": "191.6.254.250"
        },
        "params": {},
        "query": {
          "pagina": "historico"
        },
        "body": {},
        "webhookUrl": "https://karah-n8n.uzd6db.easypanel.host/webhook/kaniu-admin-dev-viralatinhaz",
        "executionMode": "production"
      }
    ]
  },
  "meta": {
    "instanceId": "c241ff24a9ad53940b8c3b07f3121394f2a5667daf04331aaa56a13d92e8e026"
  }
}
